function allorders(e,o){if("Y"==orders_max)return o.disable("down",!1),$(".ui-refresh-down>span:first-child").removeClass(),!1;if("Y"!=orders_max){var r={eshopPromoterId:xigou.getLocalStorage("promoterid"),token:xigou.getToken(),type:"1",curpage:e};xigou.activeUser.allorders({requestBody:r,callback:function(r,t){if(t==xigou.dictionary.success){var s=r||null;if(null==s||0==s.length)return!1;var a=s.code;0==a?(createList(s,e),r.data.curpage>=r.data.totalpagecount&&(o.lock(),$(".dropload-down").hide())):(o.lock(),$(".dropload-down").hide())}}})}}function ordersconfirmReceipt(){$(".orders_btn_pay_sure").off(xigou.events.click),$(".orders_btn_pay_sure")[xigou.events.click](function(){var e=xigou.getToken(),o=$(this).attr("ordercode"),r={token:e,ordercode:o};xigou.activeUser.confirmshipment({requestBody:r,callback:function(e,o){o==xigou.dictionary.success&&(0==e.code?($.tips({content:e.msg||"已确认收货",stayTime:2e3,type:"warn"}),$(this).innerHTML="已收货"):$.tips({content:e.msg||"确认订单失败",stayTime:2e3,type:"warn"}))}})})}function ordersdel(){$(".orders_btn_del").off(xigou.events.click),$(".orders_btn_del")[xigou.events.click](function(){var e=$(this).attr("ordercode");setTimeout(function(){var o=$.dialog({title:"",content:"您是否删除订单？",button:["否","是"]});o.on("dialog:action",function(o){if(1==o.index){var r=xigou.getToken(),t={token:r,ordercode:e,type:"2"};xigou.activeUser.deleteorder({requestBody:t,callback:function(e,o){if(o==xigou.dictionary.success)if(0==e.code){$.tips({content:e.msg||"已删除订单",stayTime:2e3,type:"warn"});var r="orders.html",t=xigou.getQueryString("defaule");t&&(r+="?defaule="+t),window.location.href=r}else $.tips({content:e.msg||"删除订单失败",stayTime:2e3,type:"warn"})}})}})},50)})}function orderscancel(){$(".orders_btn_pay_cancal").off(xigou.events.click),$(".orders_btn_pay_cancal")[xigou.events.click](function(e){e.stopPropagation();var o=$(this).attr("ordercode"),r=this;setTimeout(function(){var e=$.dialog({title:"",content:"您是否取消订单？",button:["否","是"]});e.on("dialog:action",function(e){if(1==e.index){var t=xigou.getToken(),s={token:t,ordercode:o,type:"1"};xigou.activeUser.deleteorder({requestBody:s,callback:function(e,o){if(o==xigou.dictionary.success)if(0==e.code){$.tips({content:e.msg||"已取消订单",stayTime:2e3,type:"warn"}),$(r).first().unbind("ontouchend"in document?"tap":"click");var t="orders.html",s=xigou.getQueryString("defaule");s&&(t+="?defaule="+s),window.location.href=t}else $.tips({content:e.msg||"取消订单失败",stayTime:2e3,type:"warn"})}})}})},250)})}function createList(e,o){for(var r=e,t=r.data.list.length,s=(r.allpage,r.count,r.data.list),a=[],i=0;t>i;i++){a.push('<div class="orders-item" ordercode="'+s[i].ordercode+'">'),a.push('	<div class="order_time_status">'+s[i].ordertime),s[i].statusdesc||(s[i].statusdesc=" "),a.push('		<span class="order_status">'+s[i].statusdesc+"</span></div>");for(var d=0;d<s[i].lines.length;d++){var n=s[i].lines[d];a.push('<div class="order_info" sku="'+n.sku+'" tid = '+n.tid+">"),a.push('	<div class="order_image">'),a.push('		<img src="'+n.imgurl+'">'),a.push("	</div>"),a.push('	<div class="oder_info2">'),a.push('		<div class="order_name_price">'),a.push('			<div class="order_price">¥'+n.price+"</div>"),a.push('			<div class="order_name">'+n.name+"</div>"),a.push("		</div>"),a.push('		<div class="order_size_count">'),a.push('			<div class="order_count">×'+n.count+"</div>"),n.specs.length>0&&a.push("			<div>"+n.specs[0]+"</div>"),a.push("		</div>"),a.push("	</div>"),a.push("</div>")}switch(a.push('	<div class="order_totle_count_price">'),a.push('		<span class="float_right ">共 '+s[i].linecount+' 件 实付：<span class="order_lineprice">¥'+s[i].orderprice+"</span></span>"),a.push("	</div>"),a.push('	<div class="order_btns">'),s[i].status){case"0":a.push('<a class="bottom_btn orders_btn_del" ordercode="'+s[i].ordercode+'" payway="'+n.payway+'">删除订单</a> ');break;case"2":a.push('<a class="bottom_btn orders_btn_pay" price="'+s[i].orderprice+'"  ordercode="'+s[i].ordercode+'">立即支付</a> '),a.push('<a class="bottom_btn orders_btn_pay_cancal" ordercode="'+s[i].ordercode+'">取消订单</a>');break;case"4":s[i].iscancancel&&1==s[i].iscancancel&&a.push('<a class="bottom_btn orders_btn_pay_cancal" ordercode="'+s[i].ordercode+'">取消订单</a>');break;case"5":a.push('<a class="bottom_btn orders_btn_pay_look" ordercode="'+s[i].ordercode+'">订单追踪</a> '),a.push('<a class="bottom_btn orders_btn_pay_sure" ordercode="'+s[i].ordercode+'">确认收货</a> ');break;case"6":a.push('<a class="bottom_btn orders_btn_del" ordercode="'+s[i].ordercode+'" payway="'+n.payway+'">删除订单</a> '),a.push('<a class="bottom_btn orders_btn_pay_look" ordercode="'+s[i].ordercode+'">订单追踪</a> ')}a.push("	</div>"),a.push("</div>")}if((""==e.data.pagesize||0==e.data.pagesize||"0"==e.data.pagesize||e.data.curpage==e.data.totalcount)&&(orders_max="Y"),1==o&&0==a.length){$("#return_list").empty();var c=[];c.push('<div class="order_empty">还木有订单哟~</div>'),$(".orders-list").append(c.join(""))}else $(".orders-list").append(a.join(""));$(".order_info").off(xigou.events.click),$(".order_info")[xigou.events.click](function(){var e=$(event.target).parents(".orders-item"),o=e.attr("ordercode");xigou.setSessionStorage("ordercode",o),xigou.setSessionStorage("orderdetails_backurl","orders.html"),window.location.href="orderdetails.html?ordercode="+o}),orderscancel(),ordersdel(),ordersconfirmReceipt(),ordersgotoPay(),orderpaylook()}function ordersgotoPay(){$(".orders_btn_pay").off(xigou.events.click),$(".orders_btn_pay")[xigou.events.click](function(){var e=xigou.getToken(),o=$(this).attr("ordercode"),r=$(this).attr("payid"),t=$(this).attr("payway"),s=xigou.getLocalStorage("openid"),a=$(this).attr("price"),t="weixin";if(isWeiXin()){var i=encodeURIComponent(xigou.pageHost),d=r+","+o+","+a+","+xigou.getToken()+","+xigou.channelcode+","+i;return void(window.location.href=xigou.xgHost+"paymentbridge.html?param="+d)}isWeiXin()||(t="mergeAlipay");var n={token:e,ordercode:o,payid:r,payway:t,openid:s};xigou.activeHtClearing.payNow({requestBody:n,callback:function(e,s){if(s==xigou.dictionary.success)if(null==e)$.tips({content:xigou.dictionary.chineseTips.server.value_is_null,stayTime:2e3,type:"warn"});else switch(e.code){case"0":if(isWeiXin())onBridgeReady(e.data,r,o);else{var a=$("#submit_pay"),i=xigou.getPaymentForm({el:a,datas:e.data,payway:t});i&&a.submit()}break;case"-1003":window.location.href="payresult.html?pid="+r+"&ordercode="+o;break;default:$.tips({content:e.msg||"支付提交失败",stayTime:2e3,type:"warn"})}else $.tips({content:"请求失败，详见"+e,stayTime:2e3,type:"warn"})}})})}function setdefaulesel(e){order_tab._autoplay(1,e)}function orderpaylook(){$(".orders_btn_pay_look").off(xigou.events.click),$(".orders_btn_pay_look")[xigou.events.click](function(){var e=$(this).attr("ordercode");xigou.setSessionStorage("logisticordercode",e),window.location.href="ordertracking.html?ordercode="+e})}$(function(){xigou.getLoginUserInfo({callback:function(e,o){if(o==xigou.dictionary.success){var r=1;$(".orders-list").dropload({scrollArea:window,loadDownFn:function(e){allorders(r,e),e.resetload(),1==r&&$(".dropload-refresh").hide(),r++}});var t=xigou.getQueryString("defaule");t&&setdefaulesel(t)}else window.location.href="index.html"}})});var orders_max="N";