function init(e,o){xigou.activeUser.allorders({requestBody:{eshopPromoterId:xigou.getLocalStorage("promoterid"),token:xigou.getToken(),type:"3",curpage:e},callback:function(t,i){if(i==xigou.dictionary.success)if(null==t)$.tips({content:xigou.dictionary.chineseTips.server.value_is_null,stayTime:2e3,type:"warn"});else switch(t.code){case"0":setHtml(t,e),t.data.curpage>=t.data.totalpagecount&&(o.lock(),$(".dropload-down").hide());break;case"-100":$.tips({content:t.msg||"用户失效，请重新登录。",stayTime:2e3,type:"warn"}),xigou.removelocalStorage("token"),window.location.href="logon.html";break;default:$.tips({content:t.msg||"获取待收货数据失败",stayTime:2e3,type:"warn"}),o.lock(),$(".dropload-down").hide()}else $.tips({content:"请求失败，详见"+t,stayTime:2e3,type:"warn"})}})}function formatDate(e){var o=new Date(e),t=o.getFullYear(),i=o.getMonth()+1,s=o.getDate(),r=o.getHours(),n=o.getMinutes(),a=o.getSeconds();return t+"-"+addtime(i)+"-"+addtime(s)+" "+addtime(r)+":"+addtime(n)+":"+addtime(a)}function addtime(e){return 10>e?"0"+e:e}function setHtml(e,o){$(".ui-refresh-down").remove();for(var t=(e.data.list,e.data.list),i=t.length,s=[],r=0;i>r;r++){s.push('<div class="orders-item" ordercode="'+t[r].ordercode+'">'),s.push('	<div class="order_time_status">'+t[r].ordertime),s.push('		<span class="order_status">'+t[r].statusdesc+"</span></div>");for(var n=0;n<t[r].lines.length;n++){var a=t[r].lines[n];s.push('<div class="order_info" sku="'+a.sku+'" tid = '+a.tid+">"),s.push('	<div class="order_image">'),s.push('		<img src="'+a.imgurl+'">'),s.push("	</div>"),s.push('	<div class="oder_info2">'),s.push('		<div class="order_name_price">'),s.push('			<div class="order_price">¥'+a.price+"</div>"),s.push('			<div class="order_name">'+a.name+"</div>"),s.push("		</div>"),s.push('		<div class="order_size_count">'),s.push('			<div class="order_count">×'+a.count+"</div>"),a.specs.length>0&&s.push("			<div>"+a.specs[0]+"</div>"),s.push("		</div>"),s.push("	</div>"),s.push("</div>")}s.push('	<div class="order_totle_count_price">'),s.push('		<span class="float_right ">共 '+t[r].linecount+' 件 实付：<span class="order_lineprice">¥'+t[r].orderprice+"</span></span>"),s.push("	</div>"),s.push('	<div class="order_btns">'),s.push('<a class="bottom_btn ship_btn_pay_look" ordercode="'+t[r].ordercode+'" id="ship_btn_pay_look">订单追踪</a> '),s.push('<a class="bottom_btn ship_btn_pay_sure" ordercode="'+t[r].ordercode+'" id="ship_btn_pay_sure">确认收货</a> '),s.push("	</div>"),s.push("</div>")}var d=!1;if(e.allpage>o&&(d=!0),1==o&&0==s.length){$("#return_list").empty();var c=[];c.push('<div class="order_empty">还木有订单哟~</div>'),$(".orders-ship").append(c.join(""))}else $(".orders-ship").append(s.join(""));setTimeout(function(){var e=xigou.getQueryString("st")||"0";window.scrollTo(0,parseInt(e))},100),$(".order_info").off(xigou.events.click),$(".order_info")[xigou.events.click](function(){var e=$(event.target).parents(".orders-item"),o=e.attr("ordercode");xigou.setSessionStorage("ordercode",o),xigou.setSessionStorage("orderdetails_backurl","orders.html"),window.location.href="orderdetails.html?ordercode="+o}),shipconfirmReceipt(),shippaylook()}function gotoOrderDetails(e,o){o=o||"",xigou.setSessionStorage("orderdetails_backurl","inbound.html?st="+$(window).scrollTop()),window.location.href="orderdetails.html?ordernum="+e}function receiving(e,o){xigou.confirm({text:"您是否确认收货?",callback:function(t){"ok"==t&&xigou.activeUser.confirmshipment({requestBody:{token:xigou.getToken(),ordernum:o},callback:function(o,t){if(t==xigou.dictionary.success)if(null==o)$.tips({content:xigou.dictionary.chineseTips.server.value_is_null,stayTime:2e3,type:"warn"});else switch(o.code){case"0":if(o.ordernum){var i=$(e).parent().parent().parent();i.hide(),i.parent().find(".ready_receiving").text("已完成").addClass("completed"),$.tips({content:o.msg||"确认收货成功",stayTime:2e3,type:"warn"})}else $.tips({content:o.msg||"确认收货失败",stayTime:2e3,type:"warn"});break;case"-100":$.tips({content:o.msg||"用户失效，请重新登录。",stayTime:2e3,type:"warn"}),xigou.removelocalStorage("token"),window.location.href="logon.html";break;default:$.tips({content:o.msg||"确认收货失败",stayTime:2e3,type:"warn"})}else $.tips({content:"请求失败，详见"+o,stayTime:2e3,type:"warn"})}})}})}function shipconfirmReceipt(){$(".ship_btn_pay_sure").off(xigou.events.click),$(".ship_btn_pay_sure")[xigou.events.click](function(){var e=xigou.getToken(),o=$(this).attr("ordercode"),t={token:e,ordercode:o};xigou.activeUser.confirmshipment({requestBody:t,callback:function(e,o){o==xigou.dictionary.success&&(0==e.code?($.tips({content:e.msg||"已确认收货",stayTime:2e3,type:"warn"}),$(this).innerHTML="已收货",window.location.href="orders.html?defaule=2"):$.tips({content:e.msg||"确认订单失败",stayTime:2e3,type:"warn"}))}})})}function shippaylook(){$(".ship_btn_pay_look").off(xigou.events.click),$(".ship_btn_pay_look")[xigou.events.click](function(){var e=$(this).attr("ordercode");xigou.setSessionStorage("logisticordercode",e),window.location.href="ordertracking.html?ordercode="+e})}$(function(){var e=1;xigou.getLoginUserInfo({callback:function(o,t){t==xigou.dictionary.success?$(".orders-ship").dropload({scrollArea:window,loadDownFn:function(o){init(e,o),o.resetload(),1==e&&$(".dropload-refresh").hide(),e++}}):window.location.href="index.html"}})});