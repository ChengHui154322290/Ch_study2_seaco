function InitPage(i){$(".ui-tab-content").show(),$("form").submit(function(){return!1}),Initcategories(i.categories),Initbrands(i.brands),InitSearchHistory()}function Initbrands(i){for(var t=[],e=0;e<i.length;e++)if(t.push('<div class="div_brands_name">'+i[e].name+"</div>"),t.push('<div class="div_brands_child">'),i[e].child){for(var a=0;a<i[e].child.length;a++){t.push('<div class="div_brands_child_item_box">');var n=i[e].child[a].name||" ";t.push(' <div class="div_brands_child_item" brandid="'+i[e].child[a].brandid+'" name="'+n+'">'),t.push('     <img src="'+i[e].child[a].imgurl+'">'),t.push(" </div>"),t.push("</div>")}t.push("</div>")}$(".div_brands").append(t.join(" "));var c=$(".div_brands_child_item_box");if(c&&c.length>0){var h=c[0].offsetWidth||60;$(".div_brands_child_item_box").css("height",h)}$(".div_brands_child_item").click(function(){window.location.href="search.html?brandid="+$(this).attr("brandid")+"&name="+$(this).attr("name")})}function Initcategories(i){for(var t=document.body.clientWidth-30,e=2*Math.floor(t/13),a=0,n=[],c=0;c<i.length;c++)if(i[c].name||(i[c].name=" "),n.push('<div class="div_img" categoryid="'+i[c].categoryid+'" + name="'+i[c].name+'">'),n.push(' <img src="'+i[c].imgurl+'">'),n.push("</div>"),i[c].child){var h=[];h.push(0);for(var a=0,d=0;d<i[c].child.length;d++)a+=GetStrLen(i[c].child[d].name),a>=e?(h.push(d),a=GetStrLen(i[c].child[d].name)+6):a+=6;h.push(i[c].child.length),n.push('<div class="div_child">');for(var d=0;d<h.length-1;d++){n.push('<div class="div_child_item">');for(var r=h[d];r<h[d+1]-1;r++)n.push(1==i[c].child[r].ishighlight?'<div class="div_child_item_name highlight" categoryid="'+i[c].child[r].categoryid+'">'+i[c].child[r].name+"</div>":'<div class="div_child_item_name" categoryid="'+i[c].child[r].categoryid+'">'+i[c].child[r].name+"</div>"),n.push('<div class="div_child_item_split"></div>');n.push(1==i[c].child[h[d+1]-1].ishighlight?'<div class="div_child_item_name highlight" categoryid="'+i[c].child[h[d+1]-1].categoryid+'">'+i[c].child[h[d+1]-1].name+"</div>":'<div class="div_child_item_name" categoryid="'+i[c].child[h[d+1]-1].categoryid+'">'+i[c].child[h[d+1]-1].name+"</div>"),n.push("</div>")}n.push("</div>")}$(".div_categories").append(n.join(" ")),$(".div_img").click(function(){window.location.href="search.html?categoryid="+$(this).attr("categoryid")+"&name="+$(this).attr("name")}),$(".div_child_item_name").click(function(){window.location.href="search.html?categoryid="+$(this).attr("categoryid")+"&name="+this.innerHTML})}function GetStrLen(i){for(var t=0,e=0;e<i.length;e++){var a=i.charCodeAt(e);a>=1&&126>=a||a>=65376&&65439>=a?t++:t+=2}return t}function InitSearchHistory(){"index"==fromPage?$(".div_search_history").show():$(".div_search_history").hide();var i=xigou.getLocalStorage("searchHistory"),t=[];if(""!=i&&(t=JSON.parse(i)),0==t.length)$(".div_history_list").hide(),$(".div_noHistory").show();else{$(".div_history_list").show(),$(".div_noHistory").hide();for(var e=0;e<t.length;e++)$("#id_ul_history").append('<li class="li_history_item"></li>'),$("#id_ul_history li").eq(e).text(t[e]);$(".li_history_item")[xigou.events.click](function(){Search(this.innerHTML,t)})}$(".div_search")[xigou.events.click](function(){$(".ui-tab-content").hide(),$("#input_search")[0].value="",$(".div_search_history").show(),$("#input_search").focus().select()}),$(".cancal_search")[xigou.events.click](function(){$(".ui-tab-content").show(),$("#input_search")[0].value="",$(".div_search_history").hide(),$("#input_search").blur()}),$("#input_search").keyup(function(i){var e=$(this).val();e&&e.length>0?($(".div_clear_input").show(),13==i.keyCode&&(e=e.replace(/(^\s*)|(\s*$)/g,""),e.length>0&&($(".ui-tab-content").show(),Search(e,t)))):$(".div_clear_input").hide()}),$(".div_clear_input")[xigou.events.click](function(){$(".div_clear_input").hide(),$("#input_search")[0].value=""}),$(".div_clear_history")[xigou.events.click](function(){var i=$.dialog({title:"",content:"确认清空输入的搜索历史吗？ ",button:["取消","确认"]});i.on("dialog:action",function(i){1==i.index&&($("#id_ul_history").empty(),$(".div_history_list").hide(),$(".div_noHistory").show())}),t=[],xigou.removelocalStorage("searchHistory")})}function Search(i,t){var e=t.indexOf(i);-1!=e&&t.splice(e,1),t.unshift(i),t.length>10&&t.pop(),xigou.setLocalStorage("searchHistory",JSON.stringify(t)),$(".div_search_history").hide();var a=$(".div_group").attr("data");window.location.href="index"==fromPage?"search.html?key="+i+"&fromPage=index&sp="+a:"search.html?key="+i+"&sp="+a}var fromPage=xigou.getQueryString("fromPage");$(function(){xigou.classify.navigation({callback:function(i,t){t==xigou.dictionary.success?0==i.code?InitPage(i.data):$.tips({content:i.msg||"请求导航失败,请检测网络连接!",stayTime:2e3,type:"warn"}):$.tips(i?{content:i.msg||"请求导航失败,请检测网络连接!",stayTime:2e3,type:"warn"}:{content:"请求导航失败,请检测网络连接!",stayTime:2e3,type:"warn"})}})}),$(".li1").click(function(){$(".choose").hide(),$(".div_group").html($(this).children("span").html()),$(".div_group").attr("data",""),$(".input_search").attr("placeholder","请输入相关产品名称")}),$(".li2").click(function(){$(".choose").hide(),$(".div_group").html($(this).children("span").html()),$(".div_group").attr("data",9),$(".input_search").attr("placeholder","请输入您想要团购的商品")});