function orderinfo(){var e=xigou.getQueryString("ordercode"),t={token:xigou.getToken(),ordercode:e};xigou.activeUser.orderinfo({requestBody:t,callback:function(e,t){if(t==xigou.dictionary.success)if(null==e)$.tips({content:xigou.dictionary.chineseTips.server.value_is_null,stayTime:2e3,type:"warn"});else switch(e.code){case"0":setHtml(e);break;default:$.tips({content:e.msg||"获取订单信息失败",stayTime:2e3,type:"warn"})}else $.tips({content:e.msg||"获取订单信息失败",stayTime:2e3,type:"warn"})}})}function setHtml(e){function t(e){var t=new Date(e);return t.getFullYear()+"-"+(t.getMonth()+1)+"-"+t.getDate()}var i=e.data,o=i.orderRedeemItemList;if(o.length<=0)$(".coupon_code").hide(),$(".div_add_info").show(),$(".div_name").html("收货人："+i.name),$(".div_tel").html(i.tel),$(".div_add").html("收货地址："+i.address);else if(o.length>0){$(".div_add_info").hide(),$(".coupon_code").show();var a=o[0].effectTimeEnd,r=new Date(a),n=t(r);$(".couponcode_message_name").html(o[0].shopName),$(".couponcode_message_time").html(n);for(var s=[],c=0;c<o.length;c++)s.push('<li><p><span class="redeem_name">'+o[c].redeemName+'</span><span class="redeem_code_nub">'+o[c].redeemCode+"</p></li>");$("#redeem_code").html(s.join(""));var d=new Date,l=d.getTime();l>r&&$(".redeem_code_nub").css("text-decoration","line-through"),$(".couponcode_message_judge").css("display","none")}$("#ordercode").html(i.ordercode),$("#statusdesc").html(i.statusdesc),$("#orderprice").html(i.orderprice),$("#paywaydesc").html(i.paywaydesc);var u=i.lines,p=[];p.push('<div class="div_time">下单时间：'+i.ordertime+"</div>");for(var c=0;c<u.length;c++){var m=u[c];p.push('<div class="div_items">'),p.push('	<div class="item-img">');var g="item.htm?sku="+m.sku+"&tid="+m.tid;p.push('		<a href="'+g+'">'),p.push('			<img class="item-img-img" src="'+m.imgurl+' ">'),p.push("		</a>"),p.push("	</div>"),p.push('	<div class="item_info">'),p.push('		<span class="item_price">'+createPriceHTML(m.price,"item_price_yuan")+"</span>"),p.push('		<div class="item_name_price">'),p.push('			<div class="item_name">'+m.name+"</div>"),p.push("		</div>"),p.push('		<div class="item_count">×'+m.count+"</div>"),p.push('		<div class="item_lineprice">'+createPriceHTML(m.lineprice,"item_lineprice_yuan")+"</div>"),0==m.isreturn&&p.push('		<div class="item_aftersale" index = "'+c+'">申请售后</div>'),p.push("	</div>"),p.push("</div>")}$(".items_info").html(p.join(" ")),$("#freight").html("¥"+i.freight),$("#disprice").html("-¥"+i.disprice),$("#taxes").html("¥"+i.taxes),$("#points").html("-¥"+i.totalpoint),$(".totle_price_fen").html(createPriceHTML(i.baseprice,"totle_price_yuan"));var _=[];switch(i.status){case"0":_.push('<a class="bottom_btn orders_btn_del" ordercode="'+i.ordercode+'" payid="'+i.payid+'">删除订单</a>');break;case"2":_.push('<a class="bottom_btn detail_btn_pay" ordercode="'+i.ordercode+'" payid="'+i.payid+'">立即支付</a>'),_.push('<a class="bottom_btn detail_btn_pay_cancal" ordercode="'+i.ordercode+'" payid="'+i.payid+'">取消订单</a>');break;case"4":i.iscancancel&&1==i.iscancancel&&_.push('<a class="bottom_btn detail_btn_pay_cancal" ordercode="'+i.ordercode+'" payid="'+i.payid+'">取消订单</a>');break;case"5":_.push('<a class="bottom_btn orders_btn_pay_look" ordercode="'+i.ordercode+'" payid="'+i.payid+'">订单追踪</a>'),_.push('<a class="bottom_btn orders_btn_pay_sure" ordercode="'+i.ordercode+'" payid="'+i.payid+'">确认收货</a>');break;case"6":_.push('<a class="bottom_btn orders_btn_del" ordercode="'+i.ordercode+'" payid="'+i.payid+'">删除订单</a>'),_.push('<a class="bottom_btn orders_btn_pay_look" ordercode="'+i.ordercode+'" payid="'+i.payid+'">订单追踪</a>')}$(".div_bottom").html(_.join(" ")),detailgotoPay(),ordersdel(),detailcancel(),orderpaylook(),ordersconfirmReceipt(),aftersales(i)}function detailgotoPay(){$(".detail_btn_pay")[xigou.events.click](function(){var e=xigou.getToken(),t=$(this).attr("ordercode"),i=$(this).attr("payid"),o=xigou.getLocalStorage("openid"),a="weixin";isWeiXin()||(a="mergeAlipay");var r={token:e,ordercode:t,payid:i,payway:a,openid:o};xigou.activeHtClearing.payNow({requestBody:r,callback:function(e,o){if(o==xigou.dictionary.success)if(null==e)$.tips({content:xigou.dictionary.chineseTips.server.value_is_null,stayTime:2e3,type:"warn"});else switch(e.code){case"0":if(isWeiXin()){var r=$("#orderprice").html(),n=encodeURIComponent(xigou.pageHost),s=i+","+t+","+r+","+xigou.getToken()+","+xigou.channelcode+","+n;return void(window.location.href=xigou.xgHost+"paymentbridge.html?param="+s)}var c=$("#submit_pay"),d=xigou.getPaymentForm({el:c,datas:e.data,payway:a});d&&c.submit();break;case"-1003":window.location.href="payresult.html?pid="+i+"&ordercode="+t;break;default:$.tips({content:e.msg||"支付提交失败",stayTime:2e3,type:"warn"})}else $.tips({content:e.msg||"支付提交失败",stayTime:2e3,type:"warn"})}})})}function ordersdel(){$(".orders_btn_del")[xigou.events.click](function(){var e=$(this).attr("ordercode"),t=$.dialog({title:"",content:"您是否删除订单？",button:["否","是"]});t.on("dialog:action",function(t){if(1==t.index){var i=xigou.getToken(),o={token:i,ordercode:e,type:"2"};xigou.activeUser.deleteorder({requestBody:o,callback:function(e,t){t==xigou.dictionary.success&&(0==e.code?($.tips({content:e.msg||"已删除订单",stayTime:2e3,type:"warn"}),$(".orders_btn_del").text("已删除"),$(".orders_btn_del").off(xigou.events.click),setTimeout(function(){var e="orders.html",t=xigou.getQueryString("defaule");t&&(e+="?defaule="+t),window.location.href=e},"2000")):$.tips({content:e.msg||"删除订单失败",stayTime:2e3,type:"warn"}))}})}})})}function detailcancel(){$(".detail_btn_pay_cancal")[xigou.events.click](function(){var e=$(this).attr("ordercode"),t=$.dialog({title:"",content:"您是否取消订单？",button:["否","是"]});t.on("dialog:action",function(t){if(1==t.index){var i=xigou.getToken(),o={token:i,ordercode:e,type:"1"};xigou.activeUser.deleteorder({requestBody:o,callback:function(e,t){t==xigou.dictionary.success&&(0==e.code?($.tips({content:e.msg||"已取消订单",stayTime:2e3,type:"warn"}),$(".detail_btn_pay_cancal").text("已取消"),$(".detail_btn_pay_cancal").off(xigou.events.click),setTimeout(function(){var e="orders.html",t=xigou.getQueryString("defaule");t&&(e+="?defaule="+t),window.location.href=e},"2000")):$.tips({content:e.msg||"取消订单失败",stayTime:2e3,type:"warn"}))}})}})})}function orderpaylook(){$(".orders_btn_pay_look")[xigou.events.click](function(){var e=$(this).attr("ordercode");xigou.setSessionStorage("logisticordercode",e),window.location.href="ordertracking.html?ordercode="+e})}function ordersconfirmReceipt(){$(".orders_btn_pay_sure")[xigou.events.click](function(){var e=xigou.getToken(),t=$(this).attr("ordercode"),i={token:e,ordercode:t};xigou.activeUser.confirmshipment({requestBody:i,callback:function(e,t){t==xigou.dictionary.success&&(0==e.code?($.tips({content:e.msg||"已确认收货",stayTime:2e3,type:"warn"}),$(".orders_btn_pay_sure").text("已收货"),$(".orders_btn_pay_sure").off(xigou.events.click)):$.tips({content:e.msg||"确认订单失败",stayTime:2e3,type:"warn"}))}})})}function solveNull(e,t){return null==e||"undefined"==typeof e?t:e}function createPriceHTML(e,t){var i="",o="00",a="00",r=e.split(".");return r.length>0&&(o=r[0],r.length>1&&(a=r[1])),i='¥<span class="'+t+'">'+o+"</span>."+a}function aftersales(e){$(".item_aftersale")[xigou.events.click](function(){var t=this.getAttribute("index"),i={};i.lineid=e.lines[t].lineid,i.itemname=e.lines[t].name,i.itemprice=e.lines[t].lineprice,i.buycount=e.lines[t].count,i.maxcount=e.lines[t].count,i.imgurl=e.lines[t].imgurl,i.ordercode=e.ordercode,xigou.setLocalStorage("aftersalesparam",JSON.stringify(i)),window.location.href="customerservice.html"})}var ordercode=xigou.getQueryString("ordercode");null==ordercode&&(window.location.href="home.html"),$(function(){xigou.getLoginUserInfo({callback:function(e,t){t==xigou.dictionary.success?orderinfo():window.location.href="index.html"}})});