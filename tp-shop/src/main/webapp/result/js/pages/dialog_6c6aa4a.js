!function(t,i){"function"==typeof define&&define.amd?define(["$"],i):"object"==typeof exports?module.exports=i():t.Dialog=i(window.Zepto||window.jQuery||$)}(this,function(t){t.fn.Dialog=function(s){var e=[];return t(this).each(function(){var n=new i,o=t.extend({trigger:t(this)},s);n.init(o),e.push(n)}),e},t.Dialog=function(s){if("alert"===s.type){var e=new i,n='<div class="ui-alert-title">'+s.content+"</div>",o="",a="ui-alert";s.button?("boolean"==typeof s.button&&(s.button="确定"),o='<p class="ui-dialog-action"><button class="ui-alert-submit  js-dialog-close">'+s.button+"</button></p>"):s.timer||(a+=" ui-alert-tip"),n+=o;var h=t.extend({target:n,animate:!0,show:!0,mask:!0,className:a,afterHide:function(){this.dispose(),s.callback&&s.callback()}},s);e.init(h),s.timer&&setTimeout(function(){e.dispose(),s.callback&&s.callback()},s.timer),e.touch(e.mask,function(){e.hide(),s.callback&&s.callback()})}if("confirm"===s.type){var l=new i,n='<div class="ui-confirm-title">'+s.content+"</div>",o="";s.buttons||(s.buttons=[{yes:"确定"},{no:"取消"}]);for(var d="",r=0,c=s.buttons.length;c>r;r++){var g=s.buttons[r];g.yes&&(d+='<td><button class="ui-confirm-submit " data-type="yes">'+g.yes+"</button></td>"),g.no&&(d+='<td><button class="ui-confirm-no" data-type="no">'+g.no+"</button></td>"),g.close&&(d+='<td><button class="ui-confirm-close js-dialog-close" data-type="close">'+g.close+"</button></td>")}o='<table class="ui-dialog-action"><tr>'+d+"</tr></table>","bottom"==s.position?n=o+n:n+=o;var u=t.extend({target:n,animate:!0,show:!0,fixed:!0,mask:!0,className:"ui-alert",afterHide:function(){this.dispose()},beforeShow:function(i){l.touch(t(".ui-confirm-submit",i),function(){s.callback&&s.callback.call(l,"yes",i)}),l.touch(t(".ui-confirm-no",i),function(){s.callback&&s.callback.call(l,"no",i)}),l.touch(t(".ui-confirm-close",i),function(){s.callback&&s.callback.call(l,"close",i)})}},s);l.init(u)}},t.alert=function(i,s,e,n,o){var a={},h={zIndex:100,type:"alert"};a="object"==typeof i?t.extend(h,i):t.extend(h,{content:i,button:s,timer:n,callback:e,width:283,height:"auto"}),t.Dialog(t.extend(a,o))},t.confirm=function(i,s,e,n){var o={},a={zIndex:100,type:"confirm"};o="object"==typeof i?t.extend(a,i):t.extend(a,{content:i,buttons:s,width:283,callback:e}),t.Dialog(t.extend(o,n))};var i=function(){var i=Math.random().toString().replace(".","");this.id="dialog_"+i,this.settings={},this.settings.closeTpl=t('<span class="ui-dialog-close js-dialog-close">x</span>'),this.settings.titleTpl=t('<div class="ui-dialog-title"></div>'),this.timer=null,this.showed=!1,this.mask=t()};return i.prototype={init:function(i){this.settings=t.extend({fixed:!1},this.settings,i),this.settings.mask&&(this.mask=t('<div class="ui-dialog-mask"/>'),t("body").append(this.mask)),t("body").append('<div class="ui-dialog ui-dialog_bg" id="'+this.id+'"></div>'),this.dialogContainer=t("#"+this.id);var s=this.settings.zIndex||10;this.dialogContainer.css({zIndex:s}),this.settings.className&&this.dialogContainer.addClass(this.settings.className),this.mask.css({zIndex:s-1}),this.settings.closeTpl&&this.dialogContainer.append(this.settings.closeTpl),this.settings.title&&(this.dialogContainer.append(this.settings.titleTpl),this.settings.titleTpl.html(this.settings.title)),this.bindEvent(),this.settings.show&&this.show()},touch:function(i,s){function e(t){return s.call(this,t)}var n;t(i).on("click",e),t(i).on("touchmove",function(){n=!0}).on("touchend",function(t){if(t.preventDefault(),!n){var i=s.call(this,t,"touch");i||(t.preventDefault(),t.stopPropagation())}n=!1})},bindEvent:function(){var i=this;this.settings.trigger&&(t(this.settings.trigger).click(function(){i.show()}),i.touch(t(this.settings.trigger),function(){i.show()})),t(this.dialogContainer).on("click",".js-dialog-close",function(){return i.hide(),!1}),t(document).keydown(function(t){27===t.keyCode&&i.showed&&i.hide()}),t(this.dialogContainer).on("hide",function(){i.hide()})},dispose:function(){this.dialogContainer.remove(),this.mask.remove(),this.timer&&clearInterval(this.timer)},hide:function(){var i=this;i.settings.beforeHide&&i.settings.beforeHide.call(i,i.dialogContainer),this.showed=!1,this.mask.hide(),this.timer&&clearInterval(this.timer),this.settings.animate?(this.dialogContainer.removeClass("zoomIn").addClass("zoomOut"),setTimeout(function(){i.dialogContainer.hide(),"object"==typeof i.settings.target&&t("body").append(i.dialogContainer.hide()),i.settings.afterHide&&i.settings.afterHide.call(i,i.dialogContainer)},500)):(this.dialogContainer.hide(),"object"==typeof this.settings.target&&t("body").append(this.dialogContainer),this.settings.afterHide&&this.settings.afterHide.call(this,this.dialogContainer))},show:function(){this.dailogContent="string"==typeof this.settings.target?t(/^(\.|\#\w+)/gi.test(this.settings.target)?this.settings.target:"<div>"+this.settings.target+"</div>"):this.settings.target,this.mask.show(),this.dailogContent.show(),this.height=this.settings.height||"auto",this.width=this.settings.width||"auto",this.dialogContainer.append(this.dailogContent).show().css({height:this.height,width:this.width}),this.settings.beforeShow&&this.settings.beforeShow.call(this,this.dialogContainer),this.showed=!0,t(this.settings.trigger).blur(),this.setPosition();var i=this;this.timer&&clearInterval(this.timer),this.settings.fixed&&(this.timer=setInterval(function(){i.setPosition()},1e3)),this.settings.animate&&this.dialogContainer.addClass("zoomIn").removeClass("zoomOut").addClass("animated")},setPosition:function(){if(this.showed){var i=this;this.dialogContainer.show(),this.height=this.settings.height,this.width=this.settings.width,isNaN(this.height)&&(this.height=this.dialogContainer.outerHeight&&this.dialogContainer.outerHeight()||this.dialogContainer.height()),isNaN(this.width)&&(this.width=this.dialogContainer.outerWidth&&this.dialogContainer.outerWidth()||this.dialogContainer.width());var s=t(window).height(),e=t(window).width(),n=this.width/2,o=this.height/2,a=e/2-n,h=s/2-o;a=Math.floor(Math.max(0,a)),h=Math.floor(Math.max(0,h));var l="absolute";i.settings.fixed&&(l="fixed");var d="auto";"bottom"==i.settings.position&&(h="auto",d=0),i.dialogContainer.css({position:l,top:h,left:a,bottom:d})}}},i});