function initUnUse(e,o){xigou.activeUser.allorders({requestBody:{eshopPromoterId:xigou.getLocalStorage("promoterid"),token:xigou.getToken(),type:"7",curpage:e},callback:function(t,i){if(i==xigou.dictionary.success)if(null==t)$.tips({content:xigou.dictionary.chineseTips.server.value_is_null,stayTime:2e3,type:"warn"});else switch(t.code){case"0":setUseHtml(t,e),t.data.curpage>=t.data.totalpagecount&&(o.lock(),$(".dropload-down").hide());break;case"-100":$.tips({content:t.msg||"用户失效，请重新登录。",stayTime:2e3,type:"warn"}),xigou.removelocalStorage("token"),window.location.href="logon.html";break;default:$.tips({content:t.msg||"获取待使用数据失败",stayTime:2e3,type:"warn"}),o.lock(),$(".dropload-down").hide()}else $.tips({content:"请求失败，详见"+t,stayTime:2e3,type:"warn"})}})}function formatDate(e){var o=new Date(e),t=o.getFullYear(),i=o.getMonth()+1,s=o.getDate(),n=o.getHours(),r=o.getMinutes(),d=o.getSeconds();return t+"-"+addtime(i)+"-"+addtime(s)+" "+addtime(n)+":"+addtime(r)+":"+addtime(d)}function addtime(e){return 10>e?"0"+e:e}function setUseHtml(e,o){$(".ui-refresh-down").remove();for(var t=(e.data.list,e.data.list),i=t.length,s=[],n=0;i>n;n++){s.push('<div class="orders-item" ordercode="'+t[n].ordercode+'">'),s.push('	<div class="order_time_status">'+t[n].ordertime),s.push('		<span class="order_status">'+t[n].statusdesc+"</span></div>");for(var r=0;r<t[n].lines.length;r++){var d=t[n].lines[r];s.push('<div class="order_info" sku="'+d.sku+'" tid = '+d.tid+">"),s.push('	<div class="order_image">'),s.push('		<img src="'+d.imgurl+'">'),s.push("	</div>"),s.push('	<div class="oder_info2">'),s.push('		<div class="order_name_price">'),s.push('			<div class="order_price">¥'+d.price+"</div>"),s.push('			<div class="order_name">'+d.name+"</div>"),s.push("		</div>"),s.push('		<div class="order_size_count">'),s.push('			<div class="order_count">×'+d.count+"</div>"),d.specs.length>0&&s.push("			<div>"+d.specs[0]+"</div>"),s.push("		</div>"),s.push("	</div>"),s.push("</div>")}s.push('	<div class="order_totle_count_price">'),s.push('		<span class="float_right ">共 '+t[n].linecount+' 件 实付：<span class="order_lineprice">¥'+t[n].orderprice+"</span></span>"),s.push("	</div>"),s.push('	<div class="order_btns">'),s.push('<a class="bottom_btn pending_btn_pay_cancal" ordercode="'+t[n].ordercode+'" id="pending_btn_pay_cancal">取消订单</a>'),s.push("	</div>"),s.push("</div>")}var a=!1;if(e.allpage>o&&(a=!0),1==o&&0==s.length){$("#return_list").empty();var c=[];c.push('<div class="order_empty">还木有订单哟~</div>'),$(".orders-use").append(c.join(""))}else $(".orders-use").append(s.join(""));setTimeout(function(){var e=xigou.getQueryString("st")||"0";window.scrollTo(0,parseInt(e))},100),$(".order_info").off(xigou.events.click),$(".order_info")[xigou.events.click](function(){var e=$(event.target).parents(".orders-item"),o=e.attr("ordercode");xigou.setSessionStorage("ordercode",o),xigou.setSessionStorage("orderdetails_backurl","orders.html"),window.location.href="orderdetails.html?ordercode="+o}),UnUsependingcancel()}function gotoOrderDetails(e,o){o=o||"",xigou.setSessionStorage("orderdetails_backurl","inbound.html?st="+$(window).scrollTop()),window.location.href="orderdetails.html?ordernum="+e}function UnUsependingcancel(){$(".pending_btn_pay_cancal").off(xigou.events.click),$(".pending_btn_pay_cancal")[xigou.events.click](function(){var e=$(this).attr("ordercode"),o=this;setTimeout(function(){var t=$.dialog({title:"",content:"您是否取消订单？",button:["否","是"]});t.on("dialog:action",function(t){if(1==t.index){var i=xigou.getToken(),s={token:i,ordercode:e,type:"1"};xigou.activeUser.deleteorder({requestBody:s,callback:function(e,t){t==xigou.dictionary.success&&(0==e.code?($.tips({content:e.msg||"已取消订单",stayTime:2e3,type:"warn"}),o.innerHTML="已取消",$(o).first().unbind("ontouchend"in document?"tap":"click"),window.location.href="orders.html?defaule=3"):$.tips({content:e.msg||"取消订单失败",stayTime:2e3,type:"warn"}))}})}})},50)})}$(function(){var e=1;xigou.getLoginUserInfo({callback:function(o,t){t==xigou.dictionary.success?$(".orders-use").dropload({scrollArea:window,loadDownFn:function(o){initUnUse(e,o),o.resetload(),1==e&&$(".dropload-refresh").hide(),e++}}):window.location.href="index.html"}})});