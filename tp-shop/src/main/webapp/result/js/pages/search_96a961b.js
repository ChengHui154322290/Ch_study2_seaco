function InitSearchEdid(e){if(Key&&Key.length>0)$("#input_search")[0].value=Key,$(".div_clear_input").show(),$(".div_clear_input")[xigou.events.click](function(){$(".div_search_history").show(),$("#input_search_history")[0].value=" ",$("#input_search_history").focus()}),$("title").html("搜索结果"),InitSearchHistory(e);else{$("#id_input_search_box").hide();var r=xigou.getQueryString("name");$("title").html(r),$(".div_search_head").hide()}}function Search(e,r){var t="curpage="+CurPage;Key?t=t+"&key="+Key:categoryid?t=t+"&categoryid="+categoryid:brandid&&(t=t+"&brandid="+brandid),r&&(t=t+"&sort="+r),sp&&(t=t+"&salespattern="+sp),xigou.classify.search({p:t,callback:function(r,t){return!t==xigou.dictionary.success?void $.tips({content:"收索失败,请检测网络连接",stayTime:2e3,type:"warn"}):void InitPage(e,r)}})}function InitPage(e,r){if("index"==fromPage&&$(".goBack").parent("a").attr("href","index.html"),!r)return void $.tips({content:"收索失败,请检测网络连接",stayTime:2e3,type:"warn"});if(0!=r.code)return void $.tips({content:r.msg||"收索失败,请检测网络连接",stayTime:2e3,type:"warn"});if(r.data.sp&&0!=r.data.sp.length||($(".search_shop").hide(),$(".div_search_list").css(Key&&Key.length>0?{"margin-top":"91px","border-top":"none"}:{"margin-top":"40px","border-top":"none"}),$(".div_search_sort").css({"border-top":"none"})),r.data.curpage&&r.data.totalpagecount&&r.data.curpage!=r.data.totalpagecount||(bMaxPage=!0,e.lock(),$(".dropload-down").hide()),1==r.data.curpage){if($(".ul_search_list").empty(),!r.data.list||0==r.data.list.length)return $(".div_search_list").addClass("div_search_list_none"),bMaxPage=!0,e.lock(),void $(".dropload-down").hide();$(".div_search_list").removeClass("div_search_list_none")}var t=[];for(var s in r.data.list){var i=r.data.list[s],a="item.htm";9==i.salespattern&&(a="group_detail.html"),a=a+"?tid="+i.tid+"&amp;sku="+i.sku,t.push('<li class="li_search_item">'),t.push('    <div class="div_img">'),t.push('        <a href="'+a+'">'),t.push('            <img src="'+i.imgurl+'">'),t.push("        </a>"),t.push("    </div>"),t.push('    <div class="div_item_name">'+i.name+"</div>");var o=i.price.split(".")[0]||"00",n=i.price.split(".")[1]||"00";t.push('    <div class="div_item_price"><span class="price">¥<span>'+o+"</span>."+n+'</span><span class="old_price">¥'+i.oldprice+"</span></div>"),t.push("</li>")}$(".ul_search_list").append(t.join(" "))}function InitSearchHistory(e){var r=xigou.getLocalStorage("searchHistory"),t=[];if(""!=r&&(t=JSON.parse(r)),0==t.length)$(".div_history_list").hide(),$(".div_noHistory").show();else{$(".div_history_list").show(),$(".div_noHistory").hide();for(var s=0;s<t.length;s++)$("#id_ul_history").append('<li class="li_history_item"></li>'),$("#id_ul_history li").eq(s).text(t[s]);$(".li_history_item")[xigou.events.click](function(){resetKeyAndSearch(this.innerHTML,t,e)})}$(".div_search_input_box").click(function(){$(".div_search_list").hide(),$(".div_search_history").show(),$("#input_search_history")[0].value=$("#input_search")[0].value,$("#input_search_history").focus(),$(".div_clear_input_history").show()}),$(".cancal_search")[xigou.events.click](function(){setTimeout(function(){$("#input_search_history").blur(),$(".div_search_history").hide(),$(".div_search_list").show()},150)}),$("#input_search_history").keyup(function(r){var s=$(this).val();s&&s.length>0?($(".div_clear_input_history").show(),13==r.keyCode&&(s=s.replace(/(^\s*)|(\s*$)/g,""),s.length>0&&resetKeyAndSearch(s,t,e))):$(".div_clear_input_history").hide()}),$("#input_search_history").keydown(function(){$(".div_clear_input_history").show()}),$(".div_clear_input_history")[xigou.events.click](function(){$("#input_search_history")[0].value="",$(".div_clear_input_history").hide()}),$(".div_clear_history")[xigou.events.click](function(){var e=$.dialog({title:"",content:"确认清空输入的搜索历史吗？ ",button:["取消","确认"]});e.on("dialog:action",function(e){1==e.index&&(t=[],xigou.removelocalStorage("searchHistory"),$("#id_ul_history").empty(),$(".div_history_list").hide(),$(".div_noHistory").show())})})}function resetKeyAndSearch(e,r){if(e&&e.length>0){var t=r.indexOf(e);-1!=t&&r.splice(t,1),r.unshift(e),r.length>10&&r.pop();var s=$(".div_group").attr("data");xigou.setLocalStorage("searchHistory",JSON.stringify(r)),window.location.href="search.html?key="+e+"&sp="+s}}function selectSortType(e){$(".div_search_sort_item")[xigou.events.click](function(){var r=this.getAttribute("id");if("sortByPrice"==r)$(this).hasClass("current_sort")?$(this).children("u").hasClass("up")?($(this).children("u").removeClass("up"),$(this).children("u").addClass("down"),searchSortType=1):($(this).children("u").removeClass("down"),$(this).children("u").addClass("up"),searchSortType=2):($(".div_search_sort_item").removeClass("current_sort"),$(this).addClass("current_sort"),$(this).children("u").removeClass("down"),$(this).children("u").addClass("up"),searchSortType=2);else{if($(this).hasClass("current_sort"))return;$(".div_search_sort_item").removeClass("current_sort"),$(this).addClass("current_sort");var r=this.getAttribute("id");"sortByDefoule"==r?searchSortType="":"sortBySales"==r?searchSortType=3:"sortByNew"==r&&(searchSortType=5)}research(e)})}function research(e){CurPage=1,bMaxPage=!1,$(".ul_search_list").empty(),e.unlock(),e.resetload(),Search(e,searchSortType),CurPage++}var CurPage=1,bMaxPage=!1,searchSortType=xigou.getQueryString("sort")||"",Key=xigou.getQueryString("key"),categoryid=xigou.getQueryString("categoryid"),brandid=xigou.getQueryString("brandid"),fromPage=xigou.getQueryString("fromPage"),Key=xigou.getQueryString("key"),name=xigou.getQueryString("name"),sp=xigou.getQueryString("sp");$(function(){$(".dropload-refresh").hide();var e=$(".div_search_list").dropload({scrollArea:window,loadDownFn:function(e){bMaxPage||(e.resetload(),Search(e,searchSortType),CurPage++)}});switch(searchSortType){case 1:$(".div_search_sort_item").removeClass("current_sort"),$("#sortBySales").addClass("current_sort"),$("#sortBySales").children("u").addClass("down"),$("#sortBySales").children("u").removeClass("up");break;case 2:$(".div_search_sort_item").removeClass("current_sort"),$("#sortBySales").addClass("current_sort"),$("#sortBySales").children("u").removeClass("down"),$("#sortBySales").children("u").addClass("up");break;case 3:$(".div_search_sort_item").removeClass("current_sort"),$("#sortByPrice").addClass("current_sort");break;case 5:$(".div_search_sort_item").removeClass("current_sort"),$("#sortByNew").addClass("current_sort")}window.onbeforeunload=function(){var e=[];searchSortType&&e.push("sort="+searchSortType),Key&&e.push("key="+Key),searchSortType&&e.push("sort="+searchSortType),categoryid&&e.push("categoryid="+categoryid),brandid&&e.push("brandid="+brandid),name&&e.push("name="+name),console.log(sp),sp&&e.push("sp="+sp),xigou.setSessionStorage("productdetails_backurl","search.html?"+e.join("&"))},onbeforeunload(),$("form").submit(function(){return!1}),$(".dropload-down").hide(),InitSearchEdid(e),selectSortType(e)}),$(".div_group").click(function(){$(".choose").show()}),$(".li1").click(function(){$(".choose").hide(),$(".div_group").html($(this).children("span").html()),$(".div_group").attr("data",""),$(".input_search").attr("placeholder","请输入相关产品名称")}),$(".li2").click(function(){$(".choose").hide(),$(".div_group").html($(this).children("span").html()),$(".div_group").attr("data",9),$(".input_search").attr("placeholder","请输入您想要团购的商品")});