function payinit(e,t){xigou.activeUser.allorders({requestBody:{eshopPromoterId:xigou.getLocalStorage("promoterid"),token:xigou.getToken(),type:"2",curpage:e},callback:function(i,o){if(o==xigou.dictionary.success)if(null==i)$.tips({content:xigou.dictionary.chineseTips.server.value_is_null,stayTime:2e3,type:"warn"});else switch(i.code){case"0":setPayHtml(i,e),i.data.curpage>=i.data.totalpagecount&&(t.lock(),$(".dropload-down").hide());break;case"-100":$.tips({content:i.msg||"用户失效，请重新登录",stayTime:2e3,type:"warn"}),xigou.removelocalStorage("token"),window.location.href="logon.html";break;default:$.tips({content:i.msg||"获取待付款订单失败",stayTime:2e3,type:"warn"}),t.lock(),$(".dropload-down").hide()}else $.tips({content:"请求失败，详见"+i,stayTime:2e3,type:"warn"})}})}function formatDate(e){var t=new Date(e),i=t.getFullYear(),o=t.getMonth()+1,n=t.getDate(),a=t.getHours(),r=t.getMinutes(),s=t.getSeconds();return i+"-"+addtime(o)+"-"+addtime(n)+"　"+addtime(a)+":"+addtime(r)+":"+addtime(s)}function addtime(e){return 10>e?"0"+e:e}function setPayHtml(e,t){$(".ui-refresh-down").remove();for(var i=(e.data.list,e.data.list),o=i.length,n=[],a=0;o>a;a++){n.push('<div class="orders-item" ordercode="'+i[a].ordercode+'">'),n.push('	<div class="order_time_status">'+i[a].ordertime),n.push('		<span class="order_status">'+i[a].statusdesc+"</span></div>");for(var r=0;r<i[a].lines.length;r++){var s=i[a].lines[r];n.push('<div class="order_info" sku="'+s.sku+'" tid = '+s.tid+">"),n.push('	<div class="order_image">'),n.push('		<img src="'+s.imgurl+'">'),n.push("	</div>"),n.push('	<div class="oder_info2">'),n.push('		<div class="order_name_price">'),n.push('			<div class="order_price">¥'+s.price+"</div>"),n.push('			<div class="order_name">'+s.name+"</div>"),n.push("		</div>"),n.push('		<div class="order_size_count">'),n.push('			<div class="order_count">×'+s.count+"</div>"),s.specs.length>0&&n.push("			<div>"+s.specs[0]+"</div>"),n.push("		</div>"),n.push("	</div>"),n.push("</div>")}n.push('	<div class="order_totle_count_price">'),n.push('		<span class="float_right ">共 '+i[a].linecount+' 件 实付：<span class="order_lineprice">¥'+i[a].orderprice+"</span></span>"),n.push("	</div>"),n.push('	<div class="order_btns">'),n.push('<a class="bottom_btn pending_btn_pay" ordercode="'+i[a].ordercode+'" orderprice="'+i[a].orderprice+'" id="pending_btn_pay">立即支付</a> '),n.push('<a class="bottom_btn pending_btn_pay_cancal" ordercode="'+i[a].ordercode+'" id="pending_btn_pay_cancal">取消订单</a>'),n.push("	</div>"),n.push("</div>")}var d=!1;if(e.allpage>t&&(d=!0),1==t&&0==n.length){$("#return_list").empty();var c=[];c.push('<div class="order_empty">还木有订单哟~</div>'),$(".orders-pending").append(c.join(""))}else $(".orders-pending").append(n.join(""));$(".order_info").off(xigou.events.click),$(".order_info")[xigou.events.click](function(){var e=$(event.target).parents(".orders-item"),t=e.attr("ordercode");xigou.setSessionStorage("ordercode",t),xigou.setSessionStorage("orderdetails_backurl","orders.html"),window.location.href="orderdetails.html?ordercode="+t}),pendingcancel(),pendinggotoPay()}function gotoPendingPay(e){xigou.setSessionStorage("orderdetails_backurl","pendingpay.html"),window.location.href="orderdetails.html?ordernum="+e}function go_payment(e,t,i,o){var n="payagain.html?tuntype="+t+"&ordernum="+e;i&&(n+="&ordertype="+i),o&&(n+="&channelid="+o),window.location.href=n}function pendinggotoPay(){$(".pending_btn_pay").off(xigou.events.click),$(".pending_btn_pay")[xigou.events.click](function(){var e=xigou.getToken(),t=$(this).attr("ordercode"),i=$(this).attr("payid"),o=$(this).attr("payway"),n=xigou.getLocalStorage("openid"),a=$(this).attr("orderprice"),o="weixin";if(isWeiXin()){var r=encodeURIComponent(xigou.pageHost),s=i+","+t+","+a+","+xigou.getToken()+","+xigou.channelcode+","+r;return void(window.location.href=xigou.xgHost+"paymentbridge.html?param="+s)}isWeiXin()||(o="mergeAlipay");var d={token:e,ordercode:t,payid:i,payway:o,openid:n};xigou.activeHtClearing.payNow({requestBody:d,callback:function(e,n){if(n==xigou.dictionary.success)if(null==e)$.tips({content:xigou.dictionary.chineseTips.server.value_is_null,stayTime:2e3,type:"warn"});else switch(e.code){case"0":if(isWeiXin())onBridgeReady(e.data,i,t);else{var a=$("#submit_pay"),r=xigou.getPaymentForm({el:a,datas:e.data,payway:o});r&&a.submit()}break;case"-1003":window.location.href="payresult.html?pid="+i+"&ordercode="+t;break;default:$.tips({content:e.msg||"支付提交失败",stayTime:2e3,type:"warn"})}else $.tips({content:"请求失败，详见"+e,stayTime:2e3,type:"warn"})}})})}function pendingcancel(){$(".pending_btn_pay_cancal").off(xigou.events.click),$(".pending_btn_pay_cancal")[xigou.events.click](function(){var e=$(this).attr("ordercode"),t=this;setTimeout(function(){var i=$.dialog({title:"",content:"您是否取消订单？",button:["否","是"]});i.on("dialog:action",function(i){if(1==i.index){var o=xigou.getToken(),n={token:o,ordercode:e,type:"1"};xigou.activeUser.deleteorder({requestBody:n,callback:function(e,i){i==xigou.dictionary.success&&(0==e.code?($.tips({content:e.msg||"已取消订单",stayTime:2e3,type:"warn"}),t.innerHTML="已取消",$(t).first().unbind("ontouchend"in document?"tap":"click"),window.location.href="orders.html?defaule=1"):$.tips({content:e.msg||"取消订单失败",stayTime:2e3,type:"warn"}))}})}})},50)})}$(function(){var e=1;xigou.getLoginUserInfo({callback:function(t,i){i==xigou.dictionary.success?$(".orders-pending").dropload({scrollArea:window,loadDownFn:function(t){payinit(e,t),t.resetload(),1==e&&$(".dropload-refresh").hide(),e++}}):window.location.href="index.html"}})});