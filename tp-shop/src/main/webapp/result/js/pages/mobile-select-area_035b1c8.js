!function(t,e){"function"==typeof define&&define.amd?define(["$","dialog"],e):"function"==typeof define&&define.cmd?define(function(t){var i=t("$"),s=t("dialog");return e(i,s)}):"object"==typeof exports?module.exports=e():t.MobileSelectArea=e(window.Zepto||window.jQuery||$)}(this,function(t){var e=function(){var t=Math.random().toString().replace(".","");this.id="scroller_"+t,this.scroller,this.data,this.index=0,this.value=[0,0,0],this.oldvalue,this.oldtext=[],this.text=["","",""],this.level=3,this.mtop=30,this.separator=" "};return e.prototype={init:function(e){this.settings=t.extend({eventName:"click"},e),this.trigger=t(this.settings.trigger),this.default=void 0==this.settings.default?1:0,level=parseInt(this.settings.level),this.level=level>0?level:3,this.trigger.attr("readonly","readonly"),this.value=this.settings.value&&this.settings.value.split(",")||[0,0,0],this.text=this.settings.text||this.trigger.val().split(" ")||["","",""],this.oldvalue=this.value.concat([]),this.oldtext=this.text.concat([]),this.clientHeight=document.documentElement.clientHeight||document.body.clientHeight,this.clientWidth=document.documentElement.clientWidth||document.body.clientWidth,this.bindEvent()},getData:function(){var e=this,i=t.Deferred();return"object"==typeof this.settings.data?i.resolve():t.ajax({dataType:"json",cache:!0,url:this.settings.data,type:"GET",success:function(t){e.data=t,i.resolve()},accepts:{json:"application/json, text/javascript, */*; q=0.01"}}),i},bindEvent:function(){var e=this;this.trigger[e.settings.eventName](function(){for(var i="",s=0;s<e.level;s++)i+="<div></div>";var a,l;if("bottom"==e.settings.position){a={position:"bottom",width:"100%",className:"ui-dialog-bottom",animate:!1};var l=[{no:"取消"},{yes:"确定"}]}t.confirm('<div class="ui-scroller-mask"><div id="'+e.id+'" class="ui-scroller">'+i+"<p></p></div></div>",l,function(t){"yes"==t&&e.submit(),"no"==t&&e.cancel(),this.dispose()},t.extend({width:320,height:215},a)),e.scroller=t("#"+e.id),e.getData().done(function(){e.format()});var n=0,o=0;return e.scroller.children().bind("touchstart",function(t){n=(t.changedTouches||t.originalEvent.changedTouches)[0].pageY}),e.scroller.children().bind("touchmove",function(e){o=(e.changedTouches||e.originalEvent.changedTouches)[0].pageY;var i=o-n,s=t(e.target).parent();if("DL"==s[0].nodeName){var a=parseInt(s.css("top")||0)+i;return s.css("top",a),n=o,!1}}),e.scroller.children().bind("touchend",function(i){o=(i.changedTouches||i.originalEvent.changedTouches)[0].pageY;var s=o-n,a=t(i.target).parent();if("DL"==a[0].nodeName){var l=t(a.parent()).index(),r=parseInt(a.css("top")||0)+s;r>e.mtop&&(r=e.mtop),r<-t(a).height()+60&&(r=-t(a).height()+60);var d=r/e.mtop,c=Math.round(d),h=Math.abs(c)+1;1==c&&(h=0),e.value[l]=t(a.children().get(h)).attr("ref");var v=t(a.children().get(h)).attr("level");if(e.text[l]=0==e.value[l]?"":t(a.children().get(h)).html(),!t(a.children().get(h)).hasClass("focus")){for(var u=e.level-1;u>l;u--)e.value[u]=0,e.text[u]="";e.format(e.value[l],parseInt(v)+1)}return t(a.children().get(h)).addClass("focus").siblings().removeClass("focus"),a.css("top",c*e.mtop),!1}}),!1})},format:function(e,i){var s=this;if(i>s.level-1)return void(i>1&&(streetArea.value=[],streetArea.text=[],t.ajax({dataType:"json",cache:!0,url:this.settings.data+"?id="+e,type:"GET",success:function(e){streetArea.data=e,t.Deferred().resolve()},accepts:{json:"application/json, text/javascript, */*; q=0.01"}})));var a=(s.scroller.children(),{});a.data=this.data,a.pid=e,a.level=i,null==e||void 0==e?(a.pid=0,a.level=0,this.f(a)):t.ajax({dataType:"json",cache:!0,url:this.settings.data+"?id="+e,type:"GET",success:function(e){a.data=e,s.f(a),t.Deferred().resolve()},accepts:{json:"application/json, text/javascript, */*; q=0.01"}})},f:function(e){var i=this,s=e.data,a=e.level;s||(s=[]);var l='<dl><dd ref="0" level="'+e.level+'">——</dd>',n=0,o=i.mtop;if(0!==a&&"0"==i.value[a-1]&&0==this.default)l='<dl><dd ref="0" class="focus" level="'+e.level+'">——</dd>',i.value[a]=0,i.text[a]="",n=0;else{if("0"==i.value[a]&&(l='<dl><dd ref="0" class="focus" level="'+e.level+'">——</dd>',n=0),s.length>0&&1==this.default){l="<dl>";var r=s[0].pid||e.pid||0,d=s[0].code||0;n=s[0].code,i.value[a]||(i.value[a]=d,i.text[a]=s[0].name),l+='<dd pid="'+r+'" class="'+v+'" ref="'+d+'" level="'+e.level+'">'+s[0].name+"</dd>"}for(var c=i.default,h=s.length;h>c;c++){var r=s[c].pid||e.pid||0,d=s[c].code||0,v="";i.value[a]==d&&(v="focus",n=d,o=i.mtop*-(c-i.default)),l+='<dd pid="'+r+'" class="'+v+'" ref="'+d+'" level="'+e.level+'">'+s[c].name+"</dd>"}}l+="</dl>";var u=t(l);u.css("top",o);var f=i.scroller.children();return t(f[a]).html(u),a>i.level-1?void(a=0):void i.format(n,a+1)},submit:function(){this.oldvalue=this.value.concat([]),this.oldtext=this.text.concat([]),1==this.trigger[0].nodeType&&(this.trigger.val(this.text.join(this.separator)),this.trigger.attr("data-value",this.value.join(","))),this.trigger.next(":hidden").val(this.value.join(",")),this.settings.callback&&this.settings.callback.call(this,this.scroller,this.text,this.value)},cancel:function(){this.value=this.oldvalue.concat([]),this.text=this.oldtext.concat([])}},e});