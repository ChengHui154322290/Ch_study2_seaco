function bindpay(){$(".xg_pay").bind("touchend",function(){$(".xg_pay").unbind("touchend");var t=xigou.getLocalStorage("seagoor_pay_sign");null!=t&&""!=t&&($(".pay_content").hide(),$(".pay_content_code").show(),paycodegen()),$(".xg_pay").hide(),$(".content").hide(),$(".cart-body").hide(),$(".coin_pay").show(),$(".coin_pay").removeClass("out"),$(".xg_pay").addClass("xg_pay_change1").removeClass("xg_pay_change")})}function paycodegen(){getpaycode(),codeInterval=setInterval("getpaycode()",6e4),statusInterval=setInterval("querypaystatus()",3e3)}function clearIntervals(){clearInterval(codeInterval),clearInterval(statusInterval)}function getpaycode(){var t={token:xigou.getToken()};xigou.seagoorpay.code({showLoading:!1,requestBody:t,callback:function(t,e){e==xigou.dictionary.success?"0"==t.code?($(".bar_code_nub").html("<label   '>"+t.data.code+"</labe>"),$(".qr_code").html("<img width='100%'　 src='data:image/png;base64,"+t.data.qrcode+"'/>"),$(".bar_code").html("<img width='100%'　 src='data:image/png;base64,"+t.data.barcode+"'/>")):$.tips({content:"获取支付码失败!",stayTime:2e3,type:"info"}):$.tips({content:"系统异常!",stayTime:2e3,type:"info"})}})}function querypaystatus(){var t=$(".bar_code_nub").find("label").text(),e={token:xigou.getToken(),code:t};xigou.seagoorpay.querypaystatus({showLoading:!1,requestBody:e,callback:function(e,a){a==xigou.dictionary.success&&"0"==e.code&&"1"!=e.data.status&&"-1"!=e.data.status&&(xigou.setSessionStorage(t,JSON.stringify(e)),window.location.href="transaction_details.html?code="+t)}})}function pointinfolist(){var t={token:xigou.getToken(),curpage:page};0==totalpagecount||page>totalpagecount+1||xigou.activeUser.pointlist({requestBody:t,callback:function(t,e){if(e==xigou.dictionary.success)if(null==t)$.tips({content:xigou.dictionary.chineseTips.server.value_is_null,stayTime:2e3,type:"warn"});else switch(t.code){case"0":setHtml(t);break;default:$.tips({content:t.msg||"获取西客币信息失败",stayTime:2e3,type:"warn"})}else $.tips({content:t.msg||"获取西客币信息失败",stayTime:2e3,type:"warn"})}})}function setHtml(t){var e=t.data,a=e.pointDetailPage;if(null!=a){var o=a.list;if(null!=o&&o.length>=0)if(totalpagecount=e.pointDetailPage.totalpagecount,totalpagecount>0||$(".pointdetaillist .product-item").length>0){if(o.length>0){$(".div_xgcoin_nmb").text(e.count),$("div.cartnull").remove();for(var n=[],i=0;i<o.length;i++)n.push('<div class="product-item">'),n.push('<div class="product-left-name">'+o[i].title+"</div>"),n.push('<div><span class="product-left-nmb">'+o[i].bizTypeName+"&nbsp;&nbsp;"+o[i].bizId+'</span><span class="'+("+"==o[i].pointTypeName?"xg_plus":"xg_minus")+'">'+o[i].pointTypeName+o[i].point+"</span></div>"),n.push('<div class="product-left-date">'+o[i].createTime+"</div>"),n.push("</div>");$(".pointdetaillist").append(n.join("")),$(".dropload-down").hide()}}else{$(".pointdetaillist").empty();var s=[];s.push('<div class="cartnull">'),s.push('<img src="img/xgcoin2.png" style="width: 27%;margin: 0 auto;display: block;margin-top: 70px;" />'),s.push('<p  style="font-size:14px;text-align: center;color: #ccc;margin-top: 25px;" >还没有使用过西客币哟~</p>'),s.push("</div>"),$(".pointdetaillist").append(s.join(""))}}}var page=1,totalpagecount=1,codeInterval,statusInterval,num_status=xigou.getLocalStorage("num");$(function(){xigou.getLoginUserInfo({callback:function(t,e){e==xigou.dictionary.success?pointinfolist():window.location.href="index.html"}}),xigou.switches.swt({callback:function(t,e){var a=!0;if(e==xigou.dictionary.success&&"0"==t.code&&null!=t.data)for(var o=t.data,n=0;n<o.length;n++)if("sgp"==o[n].code&&"0"==o[n].value){a=!1;break}a?$(".xg_pay").show():$(".xg_pay").hide()}}),$(".pointdetaillist").dropload({scrollArea:window,loadDownFn:function(t){t.resetload(),pointinfolist(page++,t)}});var t=$(window).width()/2-80,e=$(window).width()/2-18,a=$(window).width()/2-11;$(".xg_coinshow").css({left:e+"px"}),$(".xg_pay").css({left:t+"px"}),$(".seagoor").css({left:a+"px"}),isWeiXin()&&($(".cart-body").hide(),$(".header_wx").show(),$("title").html("西客币")),$(".xg_pay").bind("touchstart",function(){$(".xg_pay").addClass("xg_pay_change").removeClass("xg_pay_change1")}),bindpay(),$(".go_Back").click(function(){$(".coin_pay").addClass("out"),$(".coin_pay").hide(),$(".xg_pay").show(),$(".content").show(),$(".cart-body").show(),$("body").css({"overflow-y":"visible"}),clearIntervals(),bindpay()}),$(".close").bind("touchstart",function(){$(".close > img").addClass("close_change").removeClass("close_change1"),clearIntervals(),bindpay()}),$(".close").bind("touchend",function(){$(".close > img").addClass("close_change1").removeClass("close_change"),$(".coin_pay").addClass("out"),$(".coin_pay").hide(),$(".xg_pay").show(),$(".content").show(),$(".cart-body").show(),$("body").css({"overflow-y":"visible"})}),$(".btn").bind("touchstart",function(){$(".btn > img").addClass("btn_change").removeClass("btn_change1")}),$(".btn").bind("touchend",function(){$(".btn > img").addClass("btn_change1").removeClass("btn_change"),$(".pay_content").hide(),$(".pay_content_code").show(),paycodegen(),xigou.setLocalStorage("seagoor_pay_sign","1234")})});