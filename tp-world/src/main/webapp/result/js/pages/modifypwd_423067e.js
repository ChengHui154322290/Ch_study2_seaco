function getImgCode(){$("input#name").change(function(){xigou.valiformdata.checkSingleNode($("#name"),valiDataCallBack)&&$("#codeImg").attr("src","../../mobile/init/captchaimage.htm?telephone="+$("input#name").val()+"&typeimage=1&time="+(new Date).getTime())}),$("#codeImg").click(function(){xigou.valiformdata.checkSingleNode($("#name"),valiDataCallBack)&&($("#codeImg").attr("src","../../mobile/init/captchaimage.htm?telephone="+$("input#name").val()+"&typeimage=1&time="+(new Date).getTime()),$("#imgcode").val(""))})}function setCodeTime(e){var t=$(".h5");t.text(e);var i=setInterval(function(){return 0>=e?(clearInterval(i),t.text("获取验证码"),void(allowGetTheCode=!0)):void t.text(--e)},1e3)}function modify(){var e=$("body").height(),t=$(window).height();$(".logo").css("top",.92*Math.max(e,t)-42+"px"),$(".modifypwd-modifypwd")[xigou.events.click](function(){var e={loginname:$("#telnum").html(),captcha:$("#input-code").val(),pwd:$("#input-pwd").val()},t={requestBody:e,callback:function(e,t){if(t==xigou.dictionary.success)if(null==e)$.tips({content:xigou.dictionary.chineseTips.server.value_is_null,stayTime:2e3,type:"warn"});else{var i=e.code;switch(xigou.debugPrint("修改成功返回的code值："+i),i){case"0":{xigou.getSessionStorage("loginjump_url")}xigou.setLocalStorage("login_name",$("#telnum").html());var a={token:e.data.token,telephone:e.data.tel,name:e.data.name},n=$.dialog({title:"",content:e.msg||"修改成功",button:["确认"]});n.on("dialog:action",function(t){console.log(t.index),xigou.removeSessionStorage("realname"),xigou.removeSessionStorage("realnum"),xigou.setSessionStorage("userinfo",a,!0),xigou.setLocalStorage("login_name",$("#telnum").html()),xigou.setLocalStorage("show_name",e.data.tel||e.data.name),xigou.setLocalStorage("token",e.data.token),window.location.href="home.html"});break;case"-2":$.tips({content:e.msg||"验证码错误",stayTime:2e3,type:"warn"});break;default:$.tips({content:e.msg||"修改失败",stayTime:2e3,type:"warn"})}}else xigou.alert("请求失败，详见"+e)}};xigou.activeUser.modifypassword(t)})}function valiDataCallBack(e,t){$.tips({content:e,stayTime:2e3,type:"warn"}),$("#"+t).focus()}function initValiData(){var e={methods:{code:{required:"required"},pwd:{required:"required",password:!0},imgcode:{required:"required"}},errors:{code:{required:"请输入验证码"},pwd:{required:"请输入密码",password:"请输入6-30位密码，可以为数字、字母和下划线"},imgcode:{required:"请输入验证码"}}};return xigou.valiformdata.initValiData(e)}function getCode(){$(".wx")[xigou.events.click](function(){var e={tel:$("#telnum").text(),randid:$("#randid").val(),type:"2"},t={requestBody:e,callback:function(e,t){t==xigou.dictionary.success?null==e?$.tips({content:xigou.dictionary.chineseTips.server.value_is_null,stayTime:2e3,type:"warn"}):"0"==e.code?($(".modifypwd-modifypwd").show(),$(".input_info1").hide(),$.tips({content:e.msg,stayTime:2e3,type:"warn"})):$.tips({content:e.msg||"获取验证码失败",stayTime:2e3,type:"warn"}):xigou.alert("请求失败，详见"+e)}};xigou.activeUser.getCaptcha(t)})}$(function(){isWeiXin()||initgeetest(),modify(),isWeiXin()?($(".ui-header").hide(),$(".input_info_list").css({"margin-top":"0"}),$("title").html("修改密码"),$(".hide").hide(),$(".forgetpwd-btn").addClass("wx"),$(".forgetpwd-btn").removeClass("h5"),$("#hide-div").show(),getCode()):($(".forgetpwd-btn").addClass("h5"),$(".forgetpwd-btn").removeClass("wx"));var userinfo=xigou.getSessionStorage("userinfo");$(".telnum").html(eval("("+userinfo+")").telephone)});var handlerEmbed=function(e){$(".h5,#achieve")[xigou.events.click](function(){var t=e.getValidate();if(t){var i={geetest_challenge:$("[name=geetest_challenge]").val(),geetest_validate:$("[name=geetest_validate]").val(),geetest_seccode:$("[name=geetest_seccode]").val(),tel:$("#telnum").html(),randid:$("#randid").val(),type:"2"},a={requestBody:i,callback:function(e,t){t==xigou.dictionary.success?null==e?$.tips({content:xigou.dictionary.chineseTips.server.value_is_null,stayTime:2e3,type:"warn"}):"0"==e.code?($(".modifypwd-modifypwd").show(),$("#hide-div").show(),$(".input_info1").hide(),$.tips({content:e.msg,stayTime:2e3,type:"warn"})):$.tips({content:e.msg||"获取验证码失败",stayTime:2e3,type:"warn"}):xigou.alert("请求失败，详见"+e)}};xigou.activeUser.sendGeeCode(a)}else $.tips({content:"请先完成验证",stayTime:2e3,type:"warn"})}),e.appendTo("#embed-captcha"),e.onReady(function(){})},allowGetTheCode=!0,uuid="",fanli=xigou.getQueryString("fanli");