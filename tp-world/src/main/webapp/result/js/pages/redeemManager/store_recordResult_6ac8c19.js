function initPageList(e,i){if("Y"==orders_max)return i.disable("down",!1),$(".ui-refresh-down>span:first-child").removeClass(),!1;var o=initParams();o.curpage=e,xigou.redeemManager.list({requestBody:o,callback:function(o,t){if(t==xigou.dictionary.success)if(null==o)$.tips({content:xigou.dictionary.chineseTips.server.value_is_null,stayTime:2e3,type:"warn"});else switch(o.code){case"0":initHtml(o.data,e),o.data.page>=o.data.total&&(i.lock(),$(".dropload-down").hide());break;default:i.lock(),$(".dropload-down").hide(),$.tips({content:o.msg||"支付提交失败",stayTime:2e3,type:"warn"})}else $.tips({content:"请求失败，详见"+o,stayTime:2e3,type:"warn"})}})}function initParams(){var e=xigou.getSessionStorage("skucode"),i=2,o=xigou.getSessionStorage("redeemcode"),t=xigou.getSessionStorage("beginquerydate"),s=xigou.getSessionStorage("endquerydate");""==$.trim(e)&&(e=null),""==$.trim(o)&&(o=null);var a={token:UserToken,skuCode:e,redeemCodeState:i,redeemCode:o,beginDate:t,endDate:s};return a}function initHtml(e,i){var o=e,t=o.rows.length,s=(o.allpage,o.page,o.rows),a=[];if(null!=o&&t>0)for(var n=0;t>n;n++){{parseFloat(s[n].salesPrice).toFixed(2),s[n].redeemCodeState}a.push('<div class="history_record">'),a.push('<div class="date">核销时间  '+s[n].updateTimeCn.replace(/(.*):\d{2}$/,"$1")+"</div>"),a.push('<div class="history_item">'),a.push('<div class="goods_name">'+s[n].spuName+"</div>"),a.push('<div class="goods_num">券号 '+s[n].redeemCode+'<span class="cust">操作账号  '+s[n].updateUser+"</span></div>"),a.push("</div>"),a.push("</div>")}(0==t||e.page==e.total)&&(orders_max="Y"),1==i&&0==a.length?($(".nothing").show(),$(".histroy").empty().hide()):($(".nothing").hide(),$(".histroy").append(a.join("")))}var UserToken=xigou.getToken(),page=1,orders_max="N";$(function(){isWeiXin()||($("header").show(),$(".histroy").css({"margin-top":"65px"})),xigou.getLoginUserInfo({callback:function(e,i){i==xigou.dictionary.success?$(".histroy").dropload({scrollArea:window,loadDownFn:function(e){initPageList(page,e),e.resetload(),1==page&&$(".dropload-refresh").hide(),page++}}):window.location.href="store_record.html"}}),$(".title")[xigou.events.click](function(){window.location.href="store_record.html"})});