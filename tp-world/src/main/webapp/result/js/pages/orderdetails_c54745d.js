function orderinfo(){var e=xigou.getQueryString("ordercode"),t={token:xigou.getToken(),ordercode:e};xigou.activeUser.orderinfo({requestBody:t,callback:function(e,t){if(t==xigou.dictionary.success)if(null==e)$.tips({content:xigou.dictionary.chineseTips.server.value_is_null,stayTime:2e3,type:"warn"});else switch(e.code){case"0":setHtml(e);break;default:$.tips({content:e.msg||"获取订单信息失败",stayTime:2e3,type:"warn"})}else $.tips({content:e.msg||"获取订单信息失败",stayTime:2e3,type:"warn"})}})}function setHtml(e){function t(e){var t=new Date(e);return t.getFullYear()+"-"+(t.getMonth()+1)+"-"+t.getDate()}var o=!1,i=e.data,r=i.orderRedeemItemList;if(orderType=i.ordertype,8!=i.ordertype)$(".coupon_code").hide(),$(".div_add_tel").hide(),$(".div_add_info").show(),$(".div_name").html("收货人："+i.name),$(".div_tel").html(i.tel),$(".div_add").html("收货地址："+i.address);else if(8==i.ordertype){if($(".div_add_info").hide(),(5==i.status||6==i.status||0==i.status)&&r.length>0){$(".div_add_tel").hide(),$(".coupon_code").show();var a=r[0].effectTimeEnd,d=new Date(a),s=t(d);$(".couponcode_message_name").html(r[0].spuName),$(".couponcode_message_time").html(s),Initkf();for(var n=[],c=0;c<r.length;c++)3==r[c].redeemCodeState&&(o=!0),n.push("1"!=r[c].redeemCodeState?'<li><p><span class="redeem_name">'+r[c].redeemName+'</span><span class="redeem_code_nub" style="text-decoration:line-through">'+r[c].redeemCode+"</span></p></li>":'<li><p><span class="redeem_name">'+r[c].redeemName+'</span><span class="redeem_code_nub">'+r[c].redeemCode+'</span><span qr_code="'+r[c].qrCode+'" class="redeem_qrcode" ></span></p></li>');$("#redeem_code").html(n.join("")),$(".redeem_qrcode")[xigou.events.click](function(){var e=$(this).attr("qr_code");$(".redeem_qrcode_img").css("background-image","url('data:image/png;base64,"+e+"')"),$(".redeem_qrcode_popup").show()}),$(".redeem_qrcode_closeBtn")[xigou.events.click](function(){$(".redeem_qrcode_popup").hide()});var l=new Date,u=l.getTime();u>d&&($(".redeem_code_nub").css("text-decoration","line-through"),$(".redeem_qrcode").hide(),o=!0)}else(2==i.status||0==i.status)&&r.length<=0&&($(".coupon_code").hide(),$(".div_add_tel").show(),$("#telephone").html(i.receiveTel),isOverType=!0);$(".couponcode_message_judge").css("display","none")}$("#ordercode").html(i.ordercode),$("#statusdesc").html(0==o?i.statusdesc:"劵过期已退款"),$("#orderprice").html(i.orderprice),$("#paywaydesc").html(i.paywaydesc);var p=i.lines,m=[];m.push('<div class="div_time">下单时间：'+i.ordertime+"</div>");for(var c=0;c<p.length;c++){var _=p[c];if(m.push('<div class="div_items">'),m.push('	<div class="item-img">'),8!=i.ordertype)var g="item.htm?sku="+_.sku+"&tid="+_.tid;else var g="group_detail.html?sku="+_.sku+"&tid="+_.tid;m.push('		<a href="'+g+'">'),m.push('			<img class="item-img-img" src="'+_.imgurl+' ">'),m.push("		</a>"),m.push("	</div>"),m.push('	<div class="item_info">'),m.push('		<span class="item_price">'+createPriceHTML(_.price,"item_price_yuan")+"</span>"),m.push('		<div class="item_name_price">'),m.push('			<div class="item_name">'+_.name+"</div>"),m.push("		</div>"),m.push('		<div class="order_size_count">'),_.specs.length>0?(m.push('		<div class="item_count">×'+_.count+"</div>"),m.push('			<div style="width: 185px;">'+_.specs+"</div>")):m.push('		<div class="item_count1">×'+_.count+"</div>"),m.push("		</div>"),m.push('		<div class="item_lineprice">'+createPriceHTML(_.lineprice,"item_lineprice_yuan")+"</div>"),0==_.isreturn&&6==i.status&&8!=i.ordertype&&m.push('		<div class="item_aftersale" index = "'+c+'">申请售后</div>'),m.push("	</div>"),m.push("</div>")}$(".items_info").html(m.join(" ")),$("#freight").html("¥"+i.freight),$("#disprice").html("-¥"+i.disprice),$("#taxes").html("¥"+i.taxes),$("#points").html("-¥"+i.totalpoint),$(".totle_price_fen").html(createPriceHTML(i.baseprice,"totle_price_yuan"));var y=[];switch(i.status){case"0":y.push('<a class="bottom_btn orders_btn_del" ordercode="'+i.ordercode+'" payid="'+i.payid+'">删除订单</a>');break;case"2":y.push('<a class="bottom_btn detail_btn_pay" ordercode="'+i.ordercode+'" payid="'+i.payid+'">立即支付</a>'),y.push('<a class="bottom_btn detail_btn_pay_cancal" ordercode="'+i.ordercode+'" payid="'+i.payid+'">取消订单</a>');break;case"4":i.iscancancel&&1==i.iscancancel&&y.push('<a class="bottom_btn detail_btn_pay_cancal" ordercode="'+i.ordercode+'" payid="'+i.payid+'">取消订单</a>');break;case"5":8!=i.ordertype?(y.push('<a class="bottom_btn orders_btn_pay_look" ordercode="'+i.ordercode+'">订单追踪</a> '),y.push('<a class="bottom_btn orders_btn_pay_sure" ordercode="'+i.ordercode+'">确认收货</a> ')):y.push(0==o?'<a class="bottom_btn detail_btn_pay_cancal" ordercode="'+i.ordercode+'" payid="'+i.payid+'">取消订单</a>':'<a class="bottom_btn orders_btn_del" ordercode="'+i.ordercode+'" payid="'+i.payid+'">删除订单</a>');break;case"6":8!=i.ordertype?(y.push('<a class="bottom_btn orders_btn_del" ordercode="'+i.ordercode+'" payid="'+i.payid+'">删除订单</a>'),y.push('<a class="bottom_btn orders_btn_pay_look" ordercode="'+i.ordercode+'" payid="'+i.payid+'">订单追踪</a>')):y.push('<a class="bottom_btn orders_btn_del" ordercode="'+i.ordercode+'" payid="'+i.payid+'">删除订单</a>')}$(".div_bottom").html(y.join(" ")),detailgotoPay(),ordersdel(),detailcancel(i),orderpaylook(),ordersconfirmReceipt(),aftersales(i)}function detailgotoPay(){$(".detail_btn_pay")[xigou.events.click](function(){var e=xigou.getToken(),t=$(this).attr("ordercode"),o=$(this).attr("payid"),i=xigou.getLocalStorage("openid"),r="weixin";isWeiXin()||(r="mergeAlipay");var a={token:e,ordercode:t,payid:o,payway:r,openid:i};xigou.activeHtClearing.payNow({requestBody:a,callback:function(e,i){if(i==xigou.dictionary.success)if(null==e)$.tips({content:xigou.dictionary.chineseTips.server.value_is_null,stayTime:2e3,type:"warn"});else switch(e.code){case"0":if(isWeiXin()){var a=$("#orderprice").html(),d=encodeURIComponent(xigou.pageHost),s=o+","+t+","+a+","+xigou.getToken()+",world,"+d;return void(window.location.href=xigou.xgHost+"paymentbridge.html?param="+s)}var n=$("#submit_pay"),c=xigou.getPaymentForm({el:n,datas:e.data,payway:r});c&&n.submit();break;case"-1003":window.location.href="payresult.html?pid="+o+"&ordercode="+t;break;default:$.tips({content:e.msg||"支付提交失败",stayTime:2e3,type:"warn"})}else $.tips({content:e.msg||"支付提交失败",stayTime:2e3,type:"warn"})}})})}function ordersdel(){$(".orders_btn_del")[xigou.events.click](function(){var e=$(this).attr("ordercode"),t=$.dialog({title:"",content:"是否删除订单？",button:["否","是"]});t.on("dialog:action",function(t){if(1==t.index){var o=xigou.getToken(),i={token:o,ordercode:e,type:"2"};xigou.activeUser.deleteorder({requestBody:i,callback:function(e,t){t==xigou.dictionary.success&&(0==e.code?($.tips({content:e.msg||"已删除订单",stayTime:2e3,type:"warn"}),$(".orders_btn_del").text("已删除"),$(".orders_btn_del").off(xigou.events.click),setTimeout(function(){var e="orders.html",t=xigou.getQueryString("defaule");t&&(e+="?defaule="+t),window.location.href=e},"2000")):$.tips({content:e.msg||"删除订单失败",stayTime:2e3,type:"warn"}))}})}})})}function detailcancel(e){$(".detail_btn_pay_cancal")[xigou.events.click](function(){var t=$(this).attr("ordercode");if(8==e.ordertype)if(5==e.status)var o=$.dialog({title:"",content:"小西将会为你退款，在一至七天内返还到您的支付账户！",button:["取消","确认"]});else var o=$.dialog({title:"",content:"是否取消订单？",button:["否","是"]});else var o=$.dialog({title:"",content:"是否取消订单？",button:["否","是"]});o.on("dialog:action",function(e){if(1==e.index){var o=xigou.getToken(),i={token:o,ordercode:t,type:"1"};xigou.activeUser.deleteorder({requestBody:i,callback:function(e,t){t==xigou.dictionary.success&&(0==e.code?($.tips({content:e.msg||"已取消订单",stayTime:2e3,type:"warn"}),$(".detail_btn_pay_cancal").text("已取消"),$(".detail_btn_pay_cancal").off(xigou.events.click),setTimeout(function(){var e="orders.html",t=xigou.getQueryString("defaule");t&&(e+="?defaule="+t),window.location.href=e},"2000")):$.tips({content:e.msg||"取消订单失败",stayTime:2e3,type:"warn"}))}})}})})}function orderpaylook(){$(".orders_btn_pay_look")[xigou.events.click](function(){var e=$(this).attr("ordercode");xigou.setSessionStorage("logisticordercode",e),window.location.href="ordertracking.html?ordercode="+e})}function ordersconfirmReceipt(){$(".orders_btn_pay_sure")[xigou.events.click](function(){var e=xigou.getToken(),t=$(this).attr("ordercode"),o={token:e,ordercode:t};xigou.activeUser.confirmshipment({requestBody:o,callback:function(e,t){t==xigou.dictionary.success&&(0==e.code?($.tips({content:e.msg||"已确认收货",stayTime:2e3,type:"warn"}),$(".orders_btn_pay_sure").text("已收货"),$(".orders_btn_pay_sure").off(xigou.events.click)):$.tips({content:e.msg||"确认订单失败",stayTime:2e3,type:"warn"}))}})})}function solveNull(e,t){return null==e||"undefined"==typeof e?t:e}function createPriceHTML(e,t){var o="",i="00",r="00",a=e.split(".");return a.length>0&&(i=a[0],a.length>1&&(r=a[1])),o='¥<span class="'+t+'">'+i+"</span>."+r}function aftersales(e){$(".item_aftersale")[xigou.events.click](function(){var t=this.getAttribute("index"),o={};o.lineid=e.lines[t].lineid,o.itemname=e.lines[t].name,o.itemprice=e.lines[t].lineprice,o.buycount=e.lines[t].count,o.maxcount=e.lines[t].count,o.imgurl=e.lines[t].imgurl,o.ordercode=e.ordercode,xigou.setLocalStorage("aftersalesparam",JSON.stringify(o)),window.location.href="customerservice.html"})}function Initkf(){var e=xigou.getLocalStorage("show_name")||xigou.getLocalStorage("login_name")||"西客会员";if(e){var t=document.createElement("script");t.type="text/javascript",t.src="https://qiyukf.com/script/6e39dddabff63d902f55df3961c2793d.js?name="+e+"&mobile="+e,$("body")[0].appendChild(t)}$("div.coupon_code").append('<div class="kf_btn" onclick="ysf.open();return false;"></div>')}var orderType,ordercode=xigou.getQueryString("ordercode");null==ordercode&&(window.location.href="home.html"),$(function(){xigou.getLoginUserInfo({callback:function(e,t){t==xigou.dictionary.success?orderinfo():window.location.href="index.html"}}),isWeiXin()&&($("header").hide(),$(".top_nav_list").css({top:"0"}),$("title").html("我的订单"))});var isOverType=!1;