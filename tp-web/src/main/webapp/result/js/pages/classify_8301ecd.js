function InitPage(i){$(".ui-tab-content").show(),$("form").submit(function(){return!1}),Initcategories(i.categories),Initbrands(i.brands),sidebar(i.categories),InitSearchHistory()}function Initbrands(i){for(var d=[],s=0;s<i.length;s++)if(d.push(0==s?'<div class="div_brands_name" style="padding:0;"><img src="'+i[s].imgurl+'"/></div>':'<div class="div_brands_name"><img src="'+i[s].imgurl+'"/></div>'),d.push('<div class="div_brands_child">'),i[s].child){for(var e=0;e<i[s].child.length;e++){d.push('<div class="div_brands_child_item_box">');var c=i[s].child[e].name||" ";d.push(' <div class="div_brands_child_item" brandid="'+i[s].child[e].brandid+'" name="'+c+'">'),d.push(null==i[s].child[e].imgurl||void 0==i[s].child[e].imgurl||""==i[s].child[e].imgurl?'     <img src="modifiable/img/loading_bg.png" />':'     <img src="'+i[s].child[e].imgurl+'">'),d.push(" </div>"),d.push('<div class="div_brands_child_item_name">'+i[s].child[e].name+"</div>"),d.push("</div>")}var a=i[s].child.length/4,a=a.toString(),n=a.split(".");5==n[1]?(d.push('<div class="div_brands_child_item_box">'),d.push(' <div class="div_brands_child_item_forbidden">'),d.push('     <img src="img/classify/ggct.png">'),d.push(" </div>"),d.push('<div class="div_brands_child_item_name">正品保证</div>'),d.push("</div>"),d.push('<div class="div_brands_child_item_box">'),d.push(' <div class="div_brands_child_item_forbidden">'),d.push('     <img src="img/classify/free_delivery.png">'),d.push(" </div>"),d.push('<div class="div_brands_child_item_name">全场包邮</div>'),d.push("</div>")):75==n[1]?(d.push('<div class="div_brands_child_item_box">'),d.push(' <div class="div_brands_child_item_forbidden">'),d.push('     <img src="img/classify/ggct.png">'),d.push(" </div>"),d.push('<div class="div_brands_child_item_name">正品保证</div>'),d.push("</div>")):25==n[1]&&(d.push('<div class="div_brands_child_item_box">'),d.push(' <div class="div_brands_child_item_forbidden">'),d.push('     <img src="img/classify/ggct.png">'),d.push(" </div>"),d.push('<div class="div_brands_child_item_name">正品保证</div>'),d.push("</div>"),d.push('<div class="div_brands_child_item_box">'),d.push(' <div class="div_brands_child_item_forbidden">'),d.push('     <img src="img/classify/free_delivery.png">'),d.push(" </div>"),d.push('<div class="div_brands_child_item_name">全场包邮</div>'),d.push("</div>"),d.push('<div class="div_brands_child_item_box">'),d.push(' <div class="div_brands_child_item_forbidden">'),d.push('     <img src="img/classify/free_sale.png">'),d.push(" </div>"),d.push('<div class="div_brands_child_item_name">无忧售后</div>'),d.push("</div>")),d.push("</div>")}$(".div_brands").append(d.join(" "));var t=$(".div_brands_child_item_box");if(t&&t.length>0){var l=t[0].offsetWidth||60;$(".div_brands_child_item_box").css("height",l+38)}$(".div_brands_child_item").click(function(){window.location.href="search.html?brandid="+$(this).attr("brandid")+"&name="+$(this).attr("name")})}function sidebar(i){var d=[];d.push(' <div class="sidebar">');for(var s=0;s<i.length;s++)i[s].name||(i[s].name=" "),d.push(0==s?' <a style="font-size:15px;" class="link'+s+' current_color link" onclick=linkClick('+s+");>"+i[s].name+'<div class="line" style="display:block;"></div></a>':' <a class="link'+s+' link"  onclick=linkClick('+s+"); >"+i[s].name+'<div class="line"></div></a>');d.push("</div>"),$("body").append(d.join(" ")),$(".link").click(function(){$(this).addClass("current_color").siblings().removeClass("current_color"),$(this).children(".line").show(),$(this).siblings().children(".line").hide(),$(this).css({"font-size":"15px"}).siblings().css({"font-size":"13px"})})}function linkClick(i){var d=getsidebarHeight(i);$("body").scrollTop(d)}function getsidebarHeight(i){for(var d=0,s=0;i>s;s++){var e=2*parseInt($("#href"+s).css("margin-top").replace("px",""))+parseInt($("#href"+s).css("margin-bottom").replace("px",""))+parseInt($("#href_content"+s).css("margin-top").replace("px",""))+parseInt($("#href_content"+s).css("margin-bottom").replace("px",""));d+=$("#href"+s).height()+$("#href_content"+s).height()+e}return d}function Initcategories(i){var d=document.body.clientWidth-30,s=(2*Math.floor(d/13),[]);s.push('<div class="div_content">');for(var e=0;e<i.length;e++)if(i[e].name||(i[e].name=" "),s.push('<div class="div_img" id="href'+e+'" categoryid="'+i[e].categoryid+'" + name="'+i[e].name+'">'),s.push(' <div class="div_child_name" >'+i[e].name+"</div>"),s.push("</div>"),i[e].child){for(var c=[],a=i[e].child.length,n=0;a>n;)c.push(n),n+=3;c.push(i[e].child.length),s.push('<div class="div_child" id=href_content'+e+">");for(var t=0;t<c.length-1;t++){s.push('<div class="div_child_item">');for(var l=c[t];l<c[t+1]-1;l++)s.push(1==i[e].child[l].ishighlight?null==i[e].child[l].imgurl||void 0==i[e].child[l].imgurl||""==i[e].child[l].imgurl?'<div class="div_child_item_name highlight" categoryid="'+i[e].child[l].categoryid+' " name="'+i[e].child[l].name+'"><div class="item_img"><img src="modifiable/img/loading_bg.png"/></div><div class="item_name">'+i[e].child[l].name+"</div></div>":'<div class="div_child_item_name highlight" categoryid="'+i[e].child[l].categoryid+' " name="'+i[e].child[l].name+'"><div class="item_img"><img src="'+i[e].child[l].imgurl+'"/></div><div class="item_name">'+i[e].child[l].name+"</div></div>":null==i[e].child[l].imgurl||void 0==i[e].child[l].imgurl||""==i[e].child[l].imgurl?'<div class="div_child_item_name" categoryid="'+i[e].child[l].categoryid+' " name="'+i[e].child[l].name+'"><div class="item_img"><img src="modifiable/img/loading_bg.png"/></div><div class="item_name">'+i[e].child[l].name+"</div></div>":'<div class="div_child_item_name" categoryid="'+i[e].child[l].categoryid+' " name="'+i[e].child[l].name+'"><div class="item_img"><img src="'+i[e].child[l].imgurl+'" /></div><div class="item_name">'+i[e].child[l].name+"</div></div>"),s.push('<div class="div_child_item_split"></div>');s.push(1==i[e].child[c[t+1]-1].ishighlight?null==i[e].child[l].imgurl||void 0==i[e].child[l].imgurl||""==i[e].child[l].imgurl?'<div class="div_child_item_name highlight" categoryid="'+i[e].child[c[t+1]-1].categoryid+' " name="'+i[e].child[c[t+1]-1].name+'"><div class="item_img"><img src="modifiable/img/loading_bg.png"/></div><div class="item_name">'+i[e].child[c[t+1]-1].name+"</div></div>":'<div class="div_child_item_name highlight" categoryid="'+i[e].child[c[t+1]-1].categoryid+' " name="'+i[e].child[c[t+1]-1].name+'"><div class="item_img"><img src="'+i[e].child[l].imgurl+'" /></div><div class="item_name">'+i[e].child[c[t+1]-1].name+"</div></div>":null==i[e].child[l].imgurl||void 0==i[e].child[l].imgurl||""==i[e].child[l].imgurl?'<div class="div_child_item_name" categoryid="'+i[e].child[c[t+1]-1].categoryid+' " name="'+i[e].child[c[t+1]-1].name+'"><div class="item_img"><img src="modifiable/img/loading_bg.png"/></div><div class="item_name">'+i[e].child[c[t+1]-1].name+"</div></div>":'<div class="div_child_item_name" categoryid="'+i[e].child[c[t+1]-1].categoryid+' " name="'+i[e].child[c[t+1]-1].name+'"><div class="item_img"><img src="'+i[e].child[l].imgurl+'" /></div><div class="item_name">'+i[e].child[c[t+1]-1].name+"</div></div>"),s.push("</div>")}s.push("</div>")}s.push("</div>"),$(".div_categories").append(s.join(" ")),$(".div_img").click(function(){window.location.href="search.html?categoryid="+$(this).attr("categoryid")+"&name="+$(this).attr("name")}),$(".div_child_item_name").click(function(){window.location.href="search.html?categoryid="+$(this).attr("categoryid")+"&name="+$(this).attr("name")})}function GetStrLen(i){for(var d=0,s=0;s<i.length;s++){var e=i.charCodeAt(s);e>=1&&126>=e||e>=65376&&65439>=e?d++:d+=2}return d}function InitSearchHistory(){"index"==fromPage?$(".div_search_history").show():$(".div_search_history").hide();var i=xigou.getLocalStorage("searchHistory"),d=[];if(""!=i&&(d=JSON.parse(i)),0==d.length)$(".div_history_list").hide(),$(".div_noHistory").show();else{$(".div_history_list").show(),$(".div_noHistory").hide();for(var s=0;s<d.length;s++)$("#id_ul_history").append('<li class="li_history_item"></li>'),$("#id_ul_history li").eq(s).text(d[s]);$(".li_history_item")[xigou.events.click](function(){Search(this.innerHTML,d)})}$(".div_search")[xigou.events.click](function(){$(".ui-tab-content").hide(),$("#input_search")[0].value="",$(".div_search_history").show(),$(".content").hide(),$("#input_search").focus().select()}),$(".cancal_search")[xigou.events.click](function(){$(".ui-tab-content").show(),$("#input_search")[0].value="",$(".div_search_history").hide(),$("#input_search").blur(),$(".content").show()}),$("#input_search").keyup(function(i){var s=$(this).val();s&&s.length>0?($(".div_clear_input").show(),13==i.keyCode&&(s=s.replace(/(^\s*)|(\s*$)/g,""),s.length>0&&($(".ui-tab-content").show(),Search(s,d)))):$(".div_clear_input").hide()}),$(".div_clear_input")[xigou.events.click](function(){$(".div_clear_input").hide(),$("#input_search")[0].value=""}),$(".div_clear_history")[xigou.events.click](function(){var i=$.dialog({title:"",content:"确认清空输入的搜索历史吗？ ",button:["取消","确认"]});i.on("dialog:action",function(i){1==i.index&&($("#id_ul_history").empty(),$(".div_history_list").hide(),$(".div_noHistory").show())}),d=[],xigou.removelocalStorage("searchHistory")})}function Search(i,d){var s=d.indexOf(i);-1!=s&&d.splice(s,1),d.unshift(i),d.length>10&&d.pop(),xigou.setLocalStorage("searchHistory",JSON.stringify(d)),$(".div_search_history").hide();var e=$(".div_group").attr("data");window.location.href="index"==fromPage?"search.html?key="+i+"&fromPage=index&sp="+e:"search.html?key="+i+"&sp="+e}var fromPage=xigou.getQueryString("fromPage");$(function(){xigou.classify.navigation({callback:function(i,d){d==xigou.dictionary.success?0==i.code?InitPage(i.data):$.tips({content:i.msg||"请求导航失败,请检测网络连接!",stayTime:2e3,type:"warn"}):$.tips(i?{content:i.msg||"请求导航失败,请检测网络连接!",stayTime:2e3,type:"warn"}:{content:"请求导航失败,请检测网络连接!",stayTime:2e3,type:"warn"})}})}),$(".sidebar_show").click(function(){$(".sidebar").show(),$(".div_categories").show()}),$(".sidebar_hide").click(function(){$(".sidebar").hide(),$(".div_brands").show()}),$(".list_left").click(function(){$(this).addClass("current"),$(".list_right").removeClass("current1"),$(".tab-content li:first-child").show().siblings().hide()}),$(".list_right").click(function(){$(this).addClass("current1"),$(".list_left").removeClass("current"),$(".tab-content li:last-child").show().siblings().hide()}),$(window).scroll(function(){for(var i=$(".div_content").children().length/2,d=0,s=0;i>s;s++){var e=document.documentElement.scrollTop||document.body.scrollTop;if(d+=$("#href"+s).height()+$("#href_content"+s).height(),d>e)return $(".link"+s).addClass("current_color").siblings().removeClass("current_color"),$(".link"+s).children(".line").show(),$(".link"+s).siblings().children(".line").hide(),void $(".link"+s).css({"font-size":"15px"}).siblings().css({"font-size":"13px"})}}),$(".div_group").click(function(){$(".choose").show()}),$(".li1").click(function(){$(".choose").hide(),$(".div_group").html($(this).children("span").html()),$(".div_group").attr("data",""),$(".input_search").attr("placeholder","请输入相关产品或店铺名称")}),$(".li2").click(function(){$(".choose").hide(),$(".div_group").html($(this).children("span").html()),$(".div_group").attr("data",9),$(".input_search").attr("placeholder","请输入您想要团购的商品")});