function login(){var e=$("body").height(),o=$(window).height();$(".logo").css("top",.92*Math.max(e,o)-42+"px"),xigou.getLocalStorage("login_name")&&$("input.name").val(xigou.getLocalStorage("login_name")),$("#loginBtnID")[xigou.events.click](function(){if($("#loginBtnID").focus(),xigou.valiformdata.check(null,valiDataCallBack)){var e={token:"",loginname:$("input.name").val(),pwd:$("input.pwd").val()};if(isWeiXin()){var o=xigou.getLocalStorage("openid");o&&(e.uniontype=1,e.unionval=o)}var t={requestBody:e,callback:function(o,t){if(t==xigou.dictionary.success)if(null==o)$.tips({content:xigou.dictionary.chineseTips.server.value_is_null,stayTime:2e3,type:"warn"});else{var i=o.code;switch(i){case"0":if(o.data.promoterinfo&&"{}"!=o.data.promoterinfo){var a=JSON.parse(o.data.promoterinfo);a.token=o.data.token,xigou.setLocalStorage("dssUser",a,!0)}var n=xigou.getSessionStorage("loginjump_url"),r={token:o.data.token,telephone:o.data.tel,name:o.data.name};if(xigou.removeSessionStorage("realname"),xigou.removeSessionStorage("realnum"),xigou.setSessionStorage("userinfo",r,!0),xigou.setLocalStorage("login_name",$("input.name").val()),xigou.setLocalStorage("show_name",o.data.tel||o.data.name),xigou.setLocalStorage("token",o.data.token),xigou.getSessionStorage("refer_data"))e=xigou.getSessionStorage("refer_data",!0),e.token=o.data.token,xigou.activeUser.addshopping({requestBody:e,callback:function(e,o){xigou.removeSessionStorage("refer_data"),o==xigou.dictionary.success||$.tips({content:"添加购物车失败！",stayTime:2e3,type:"warn"}),window.location.href="cart.html"}});else if(xigou.getSessionStorage("buy_now_refer_data"))e=xigou.getSessionStorage("buy_now_refer_data",!0),e.token=o.data.token,xigou.activeUser.buynow({requestBody:e,callback:function(e,o){xigou.getSessionStorage("buy_now_tun_type");if(xigou.removeSessionStorage("buy_now_refer_data"),xigou.removeSessionStorage("buy_now_tun_type"),o==xigou.dictionary.success){var t=e||null;if(null==t||0==t.length)return!1;xigou.setSessionStorage("buy_now_uuid",t.data.uuid),window.location.href="settle.html"}else window.location.href=xigou.getSessionStorage("buy_now_details_url")}});else if(n)xigou.setSessionStorage("loginjump_url",""),window.location.href=decodeURIComponent(n);else if(xigou.getSessionStorage("refer",!1).indexOf("login.html")>-1||xigou.getSessionStorage("refer",!1).indexOf("logon.html")>-1)window.location.href="home.html";else{if(xigou.getSessionStorage("refer",!1).indexOf("/wxhb")>-1||xigou.getSessionStorage("refer",!1).indexOf("/wxhb.html")>-1)return void(window.location.href="home.html");window.location.href="index.html"}break;case"-99":var r={token:o.data.token,telephone:o.data.tel,name:o.data.name};xigou.setSessionStorage("userinfo",r,!0),xigou.setLocalStorage("login_name",$("input#name").val()),xigou.setLocalStorage("token",o.token),window.location.href="binding.html";break;default:$("input#name").unbind("change"),$.tips({content:o.msg||"登录失败",stayTime:2e3,type:"warn"})}}else $.tips({content:"请求失败，详见"+o,stayTime:2e3,type:"warn"})}};xigou.activeUser.logon(t)}}),$("#registerBtnClass")[xigou.events.click](function(){window.location.href="register.html"})}function valiDataCallBack(e,o){$.tips({content:e,stayTime:2e3,type:"warn"}),$("#"+o).focus()}function initValiData(){var e={methods:{name:{required:"required",emailormobile:"emailormobile"}},errors:{name:{required:"请输入用户账号",emailormobile:"请填写正确的手机号或者邮箱地址"}}};return $("#name").focus(function(){var e=$(this).val();e&&e.length>0?$(".div_clear_input1").show():$(".div_clear_input1").hide()}),$("#name").blur(function(){$(".div_clear_input1").hide()}),$(".div_clear_input1")[xigou.events.click](function(){$(".div_clear_input1").hide(),$("#name")[0].value=""}),$("#pwd").focus(function(){var e=$(this).val();e&&e.length>0?$(".div_clear_input2").show():$(".div_clear_input2").hide()}),$("#pwd").blur(function(){$(".div_clear_input2").hide()}),$(".div_clear_input1")[xigou.events.click](function(){$(".div_clear_input2").hide(),$("#pwd")[0].value=""}),xigou.valiformdata.initValiData(e)}function getopenid(){var e=xigou.getSessionStorage("weixin_code");xigou.activeUser.openid({requestBody:{code:e},callback:function(e){xigou.setLocalStorage("openid",e.data.openid),window.location.href=window.location.href}})}$(function(){login(),initValiData(),isWeiXin()&&($(".ui-header").hide(),$(".input_info_list").css({"margin-top":"0"}),$("title").html("登录"))});var backurl=xigou.getQueryString("backurl"),buy_now_details_url=xigou.getSessionStorage("buy_now_details_url"),details_url=xigou.getSessionStorage("details_url"),fanli=xigou.getQueryString("fanli"),_try=xigou.getQueryString("try"),game=xigou.getQueryString("game"),topicid=xigou.getQueryString("topicid"),mtoapp=xigou.getQueryString("mtoapp");"1"==fanli&&$(".registr").attr("href","registr.html?fanli=1"),null!=backurl&&(buy_now_details_url&&($(".back").attr("href","javascript:void(0)"),$(".back")[xigou.events.click](function(){xigou.removeSessionStorage("buy_now_details_url"),window.location.href=decodeURIComponent(buy_now_details_url)})),details_url?($(".back").attr("href","javascript:void(0)"),$(".back")[xigou.events.click](function(){xigou.removeSessionStorage("details_url"),window.location.href=decodeURIComponent(details_url)})):$(".back").attr("href",decodeURIComponent(backurl)));var ua=window.navigator.userAgent.toLowerCase();if("micromessenger"==ua.match(/MicroMessenger/i)){var openid=xigou.getLocalStorage("openid");if(openid){var params={uniontype:"1",unionval:openid,signature:"af288db869b27f21cc1440385d63d4d5",curtime:(new Date).valueOf().toString()},dssUser=xigou.getLocalStorage("dssUser");dssUser&&"{}"!=dssUser&&(dssUser=JSON.parse(dssUser),dssUser&&dssUser.mobile&&(params.shopMobile=dssUser.mobile)),xigou.activeUser.unionlogon({requestBody:params,callback:function(e,o){if(o==xigou.dictionary.success){if(null==e)return;var t=e.code;switch(t){case"0":if(e.data.promoterinfo&&"{}"!=e.data.promoterinfo){var i=JSON.parse(e.data.promoterinfo);i.token=e.data.token,xigou.setLocalStorage("dssUser",i,!0)}var a=xigou.getSessionStorage("loginjump_url"),n={token:e.data.token,telephone:e.data.tel,name:e.data.name};xigou.removeSessionStorage("realname"),xigou.removeSessionStorage("realnum"),xigou.setSessionStorage("userinfo",n,!0),xigou.setLocalStorage("show_name",e.data.tel||e.data.name),xigou.setLocalStorage("token",e.data.token),xigou.getSessionStorage("refer_data")?(params=xigou.getSessionStorage("refer_data",!0),params.token=e.data.token,xigou.activeUser.addshopping({requestBody:params,callback:function(e,o){xigou.removeSessionStorage("refer_data"),o==xigou.dictionary.success||$.tips({content:"添加购物车失败！",stayTime:2e3,type:"warn"}),setTimeout(function(){window.location.href="cart.html"},250)}})):xigou.getSessionStorage("buy_now_refer_data")?(params=xigou.getSessionStorage("buy_now_refer_data",!0),params.token=e.data.token,xigou.activeUser.buynow({requestBody:params,callback:function(e,o){xigou.getSessionStorage("buy_now_tun_type");if(xigou.removeSessionStorage("buy_now_refer_data"),xigou.removeSessionStorage("buy_now_tun_type"),o==xigou.dictionary.success){var t=e||null;if(null==t||0==t.length)return!1;xigou.setSessionStorage("buy_now_uuid",t.data.uuid),setTimeout(function(){window.location.href="settle.html"},250)}else setTimeout(function(){window.location.href=xigou.getSessionStorage("buy_now_details_url")},250)}})):a?(xigou.setSessionStorage("loginjump_url",""),setTimeout(function(){window.location.href=decodeURIComponent(a)},250)):xigou.getSessionStorage("refer",!1).indexOf("login.html")>-1||xigou.getSessionStorage("refer",!1).indexOf("logon.html")>-1?setTimeout(function(){window.location.href="home.html"},250):xigou.getSessionStorage("refer",!1).indexOf("/wxhb")>-1||xigou.getSessionStorage("refer",!1).indexOf("/wxhb.html")>-1?setTimeout(function(){window.location.href="home.html"},250):setTimeout(function(){window.location.href="index.html"},250);break;default:return}}}})}else xigou.getwxOpenid(1,!0)}