function expired(e,i){var n={token:xigou.getToken(),type:"1",status:"2",curpage:e};xigou.activeUser.haved({requestBody:n,callback:function(e,n){if(n==xigou.dictionary.success)if(null==e)$.tips({content:xigou.dictionary.chineseTips.server.value_is_null,stayTime:2e3,type:"warn"});else switch(e.code){case"0":expiredsetHtmlView(e);break;case"-100":var o=$.dialog({title:"",content:e.msg||"用户失效，请重新登录。",button:["确认"]});o.on("dialog:action",function(e){console.log(e.index),xigou.removelocalStorage("token"),window.location.href="logon.html"});break;default:$.tips({content:e.msg||"获取优惠券信息失败",stayTime:2e3,type:"warn"}),i.lock(),$(".dropload-down").hide()}else $.tips({content:"请求失败，详见"+e,stayTime:2e3,type:"warn"}),i.lock(),$(".dropload-down").hide()}})}function expiredsetHtmlView(e){var i={coupon0:[],coupon1:[],coupon2:[]};if(e&&e.data.list)for(var n in e.data.list){var o=e.data.list[n];i["coupon"+o.status].push(o)}for(var d='<div class="empty_box">没有可使用的优惠券</div>',a='<div class="ui-flex ui-flex-ver ui-flex-pack-center ui-flex-align-start"><div class="coupon-item" ><div class="coupon-expired-info"><div class="item_price"><span>¥</span><%=price%></div><div class="coupon-introduce"><div class="coupon-name"><%=name%></div><ul><li><%=validtime%></li><li><%=rule%></li></ul></div></div></div></div>',l='<div class="ui-flex ui-flex-ver ui-flex-pack-center ui-flex-align-start"><div class="card-item" ><div class="card-expired-info"><div class="item_price"><span>¥</span><%=price%></div><div class="card-introduce"><div class="card-name"><%=name%></div><ul><li><%=validtime%></li><li>可直接兑换成西客币</li></ul></div></div></div></div>',c=0;c<i.coupon2.length;c++){var t=[],r=i.coupon2[c];if("0"==r.type){var s=$.tpl(a,r);t.push(s),0==t.length?$(".coupon-expired").html(d):$(".coupon-expired").append(t.join(""))}else if("1"==r.exchangeXgMoney){var s=$.tpl(l,r);t.push(s),0==t.length?$(".card-expired").html(d):$(".card-expired").append(t.join(""))}else{var s=$.tpl(a,r);t.push(s),0==t.length?$(".card-expired").html(d):$(".card-expired").append(t.join(""))}}0==i.coupon0.length&&0==$(".card-unused").find(".ui-flex").length&&0==$(".coupon-unused").find(".ui-flex").length?$(".nocard0").show():$(".nocard0").hide(),0==i.coupon1.length&&0==$(".card-unused").find(".ui-flex").length&&0==$(".coupon-unused").find(".ui-flex").length?$(".nocard1").show():$(".nocard1").hide(),0==i.coupon2.length&&0==$(".card-expired").find(".ui-flex").length&&0==$("coupon-expired").find(".ui-flex").length?$(".nocard2").show():$(".nocard2").hide()}$(function(){var e=1;xigou.getLoginUserInfo({callback:function(i,n){n==xigou.dictionary.success?$(".coupon-expired").dropload({scrollArea:window,loadDownFn:function(i){expired(e,i),i.resetload(),1==e&&$(".dropload-refresh").hide(),e++}}):window.location.href="index.html"}})});