function lookrule(){var i="1.本券可与红包叠加使用<br>2.本券不可与其他优惠券叠加使用<br>3.本券使用后不可找零<br>4.本券不可抵扣运费及税金";$(".list .r>span:last-child")[xigou.events.click](function(){xigou.alert({message:'<p style="text-align:left;margin-left:15px;color: #333;font-size: 1.4rem;">'+i+"</p>",params:{title:"使用规则"}})})}function exCoupon(i){var e={token:xigou.getToken(),ccode:$("input.input-exchange").val(),cid:i,point:"point"};xigou.activeUser.exchangCoupon({requestBody:e,callback:function(i,e){if(e==xigou.dictionary.success)if(null==i)$.tips({content:xigou.dictionary.chineseTips.server.value_is_null,stayTime:2e3,type:"warn"});else switch(i.code){case"0":if("EXCHANGE_SUCCESS"==i.data.type){var o=$.dialog({title:"",content:i.msg||"兑换成功",button:["确认"]});o.on("dialog:action",function(){window.location.reload()})}else if("EXCHANGE_POINT_SUCCESS"==i.data.type){var o=$.dialog({title:"",content:"你的优惠券已经兑换成西客币，<br>请到“我的西客币”查看",button:["去查看","知道了"]});o.on("dialog:action",function(i){1==i.index?window.location.reload():window.location.href="xgcoin.html"})}break;case"-100":var o=$.dialog({title:"",content:i.msg||"用户失效，请重新登录。",button:["确认"]});o.on("dialog:action",function(i){console.log(i.index),xigou.removelocalStorage("token"),window.location.href="logon.html"});break;default:$.tips({content:i.msg||"获取优惠券信息失败",stayTime:2e3,type:"warn"})}else $.tips({content:"请求失败，详见"+i,stayTime:2e3,type:"warn"})}})}function unused(i,e){var o={token:xigou.getToken(),type:"1",status:"0",curpage:i};xigou.activeUser.haved({requestBody:o,callback:function(i,o){if(o==xigou.dictionary.success)if(null==i)$.tips({content:xigou.dictionary.chineseTips.server.value_is_null,stayTime:2e3,type:"warn"});else switch(i.code){case"0":setHtmlView(i);break;case"-100":var n=$.dialog({title:"",content:i.msg||"用户失效，请重新登录。",button:["确认"]});n.on("dialog:action",function(i){console.log(i.index),xigou.removelocalStorage("token"),window.location.href="logon.html"});break;default:$.tips({content:i.msg||"获取优惠券信息失败",stayTime:2e3,type:"warn"}),e.lock(),$(".dropload-down").hide()}else $.tips({content:"请求失败，详见"+i,stayTime:2e3,type:"warn"}),e.lock(),$(".dropload-down").hide()}})}function setHtmlView(i){var e={coupon0:[],coupon1:[],coupon2:[]};if(i&&i.data.list)for(var o in i.data.list){var n=i.data.list[o];e["coupon"+n.status].push(n)}for(var s='<div class="empty_box nocard"><img src="./img/coupon/nocart.png"/>没有可使用的优惠券</div>',t=0;t<e.coupon0.length;t++){var a=[],c=e.coupon0[t];if("0"==c.type){if(a.push('<div class="ui-flex ui-flex-ver ui-flex-pack-center ui-flex-align-start">'),a.push('   <div class="coupon-item" >'),a.push('       <div class="coupon-unused-info">'),a.push('           <div class="item_price"><span>¥</span>'+c.price+"</div>"),a.push('           <a class="ImmediatelyUse" href="search.html?couponid='+c.cid+'">立即使用</a>'),a.push('           <div class="coupon-introduce">'),a.push('               <div class="coupon-name">'+c.name+"</div>"),a.push("               <ul>"),c.validtime&&""!=c.validtime&&a.push("                   <li>"+c.validtime+"</li>"),c.rule&&""!=c.rule&&a.push("                   <li>"+c.rule+"</li>"),a.push("               </ul>"),a.push('               <div class="application_scope">适用范围'),a.push('                   <div class="show_application_scope"></div>'),a.push("               </div>"),a.push("           </div>"),a.push('           <div class="item_bottom_line" id="info_bottom_line"></div>'),a.push("       </div>"),a.push('       <div class="application_scope_info" style="display: none">'),a.push('           <div class="application_scope_info_bg">'),a.push("               <ul>"),c.scope)for(var l=0;l<c.scope.length;l++)a.push("                   <li>"+c.scope[l]+"</li>");a.push("               </ul>"),a.push("           </div>"),a.push('           <div class="item_bottom_line"></div>'),a.push("       </div>"),a.push("   </div>"),a.push("</div>"),0==a.length||void 0==a?$(".coupon-unused").html(s):$(".coupon-unused").append(a.join(""))}else{if("1"==c.exchangeXgMoney)a.push('<div class="ui-flex ui-flex-ver ui-flex-pack-center ui-flex-align-start">'),a.push('   <div class="card-item" >'),a.push('       <div class="card-unused-info">'),a.push('           <div class="item_price"><span>¥</span>'+c.price+"</div>"),a.push('           <a class="change" onclick="exCoupon('+c.cid+')">立即兑换</a>'),a.push('           <div class="card-introduce">'),a.push('               <div class="card-name">'+c.name+"</div>"),a.push("               <ul>"),c.validtime&&""!=c.validtime&&a.push("                   <li>"+c.validtime+"</li>"),a.push("                   <li>可直接兑换成西客币</li>"),a.push("               </ul>"),a.push('               <div class="application_scope application_scope_card">使用条件'),a.push('                   <div class="show_application_scope"></div>'),a.push("               </div>"),a.push("           </div>"),a.push('           <div class="item_bottom_line" id="info_bottom_line"></div>'),a.push("       </div>"),a.push('       <div class="application_scope_info" style="display: none">'),a.push('           <div class="application_scope_info_bg">'),a.push("               <ul>"),a.push("                   <li>1、100西客币抵扣1人民币，每单可用西客币进行抵扣，但是海外订单支付金额不能全由西客币抵扣；</li>"),a.push("                   <li>2、消费时可使用的西客币的数量必须是自然数。</li>"),a.push("               </ul>"),a.push("           </div>"),a.push('           <div class="item_bottom_line"></div>'),a.push("       </div>"),a.push("   </div>"),a.push("</div>");else{if(a.push('<div class="ui-flex ui-flex-ver ui-flex-pack-center ui-flex-align-start">'),a.push('   <div class="coupon-item" >'),a.push('       <div class="coupon-unused-info">'),a.push('           <div class="item_price"><span>¥</span>'+c.price+"</div>"),a.push('           <a class="ImmediatelyUse" href="search.html?couponid='+c.cid+'">立即使用</a>'),a.push('           <div class="coupon-introduce">'),a.push('               <div class="coupon-name">'+c.name+"</div>"),a.push("               <ul>"),c.validtime&&""!=c.validtime&&a.push("                   <li>"+c.validtime+"</li>"),a.push("               </ul>"),a.push('               <div class="application_scope application_scope_card">使用条件'),a.push('                   <div class="show_application_scope"></div>'),a.push("               </div>"),a.push("           </div>"),a.push('           <div class="item_bottom_line item_bottom_line1" id="info_bottom_line"></div>'),a.push("       </div>"),a.push('       <div class="application_scope_info" style="display: none">'),a.push('           <div class="application_scope_info_bg">'),a.push("               <ul>"),c.scope)for(var l=0;l<c.scope.length;l++)a.push("                   <li>"+c.scope[l]+"</li>");a.push("               </ul>"),a.push("           </div>"),a.push('           <div class="item_bottom_line item_bottom_line1"></div>'),a.push("       </div>"),a.push("   </div>"),a.push("</div>")}0==a.length?$(".card-unused").html(s):$(".card-unused").append(a.join(""))}}0==e.coupon0.length&&0==$(".card-unused").find(".ui-flex").length&&0==$(".coupon-unused").find(".ui-flex").length?$(".nocard0").show():$(".nocard0").hide(),0==e.coupon1.length&&0==$(".card-unused").find(".ui-flex").length&&0==$(".coupon-unused").find(".ui-flex").length?$(".nocard1").show():$(".nocard1").hide(),0==e.coupon2.length&&0==$(".card-expired").find(".ui-flex").length&&0==$("coupon-expired").find(".ui-flex").length?$(".nocard2").show():$(".nocard2").hide(),$(".application_scope").unbind("click"),$(".application_scope").bind("click",function(){var i=$(this).parents(".coupon-item"),e=i.find("#info_bottom_line"),o=i.find(".application_scope_info"),n=$(this).attr("show");1==n?($(this).attr("show",0),e.show(),o.hide()):($(this).attr("show",1),e.hide(),o.show())}),$(".application_scope_card").unbind("click"),$(".application_scope_card").bind("click",function(){var i=$(this).parents(".card-item"),e=$(this).parents(".coupon-item"),o=i.find("#info_bottom_line"),n=i.find(".application_scope_info"),s=e.find("#info_bottom_line"),t=e.find(".application_scope_info");$("#info_bottom_line").hasClass("show")?(o.hide(),n.show(),s.hide(),t.show(),$("#info_bottom_line").removeClass("show")):(o.show(),n.hide(),s.show(),t.hide(),$("#info_bottom_line").addClass("show"))}),exchangecode()}function exchangecode(){$("#search_btn").on(xigou.events.click,bindClick),$("#search_code").on("input propertychange",function(){$("#search_btn").unbind(),$("#search_code").val().length>0?($("#search_btn").on(xigou.events.click,bindClick),$(".btn-exchange").addClass("onSearch")):$(".btn-exchange").removeClass("onSearch")}),$("#clear_input")[xigou.events.click](function(){$("#search_code").val(""),$(".btn-exchange").removeClass("onSearch"),$("#search_btn").unbind()})}function bindClick(){var i=$(".input-exchange").val();return void 0==typeof i||""==i?($.tips({content:"兑换码不能为空哦~",stayTime:2e3,type:"warn"}),!1):void exCoupon()}$(function(){isWeiXin()&&($("header").hide(),$("title").html("我的优惠券"));var i=1;xigou.getLoginUserInfo({callback:function(e,o){o==xigou.dictionary.success?$(".coupon-unused").dropload({scrollArea:window,loadDownFn:function(e){unused(i,e),e.resetload(),1==i&&$(".dropload-refresh").hide(),i++}}):window.location.href="index.html"}})}),$("#search_code").blur(function(){$("#clear_input").hide()}),$("#search_code").focus(function(){$("#clear_input").show()});