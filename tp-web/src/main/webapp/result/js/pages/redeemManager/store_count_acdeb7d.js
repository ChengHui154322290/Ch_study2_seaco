function initStatics(){var e=initParams();xigou.redeemManager.count({requestBody:e,callback:function(e,t){if(t==xigou.dictionary.success)if(null==e)$.tips({content:xigou.dictionary.chineseTips.server.value_is_null,stayTime:2e3,type:"warn"});else switch(e.code){case"0":var i=e.data;$(".expectincome").text("+"+i.expectIncome),$(".refunedamount").text("-"+i.refunedAmount),$(".actualincome").text("+"+i.actualIncome);break;default:$.tips({content:e.msg||"支付提交失败",stayTime:2e3,type:"warn"})}else $.tips({content:"请求失败，详见"+e,stayTime:2e3,type:"warn"})}})}function initPageList(e,t){if("Y"==orders_max)return t.disable("down",!1),$(".ui-refresh-down>span:first-child").removeClass(),!1;var i=initParams();i.curpage=e,xigou.redeemManager.list({requestBody:i,callback:function(i,s){if(s==xigou.dictionary.success)if(null==i)$.tips({content:xigou.dictionary.chineseTips.server.value_is_null,stayTime:2e3,type:"warn"});else switch(i.code){case"0":initHtml(i.data,e),i.data.page>=i.data.total&&(t.lock(),$(".dropload-down").hide());break;default:t.lock(),$(".dropload-down").hide(),$.tips({content:i.msg||"支付提交失败",stayTime:2e3,type:"warn"})}else $.tips({content:"请求失败，详见"+i,stayTime:2e3,type:"warn"})}})}function initParams(){var e=xigou.getSessionStorage("skucode"),t=xigou.getSessionStorage("redeemstatus"),i=xigou.getSessionStorage("redeemcode"),s=xigou.getSessionStorage("beginquerydate"),o=xigou.getSessionStorage("endquerydate");""==$.trim(e)&&(e=null),""==$.trim(i)&&(i=null);var a={token:UserToken,skuCode:e,redeemCodeState:t,redeemCode:i,beginDate:s,endDate:o};return a}function initHtml(e,t){var i=e,s=i.rows.length,o=(i.total,i.page,i.rows);if(html=[],s>0)for(var a=0;s>a;a++){var n=parseFloat(o[a].salesPrice).toFixed(2),l=o[a].redeemCodeState,d="",r="+"+n;html.push('<div class="content_items">'),html.push('<div class="date">'+o[a].createTimeCn.replace(/(.*):\d{2}$/,"$1")+"</div>"),html.push('<div class="goods_info">'),html.push('<div class="goods_info_left">'),html.push('<h3 class="goods_name">'+o[a].spuName+"</h3>"),html.push('<div class="goods_price">¥'+n+"</div>"),html.push('<div class="goods_num">券号 '+o[a].redeemCode+"</div>"),html.push('<div class="goods_state">'+o[a].redeemCodeStateCn+"　"+o[a].updateTimeCn.replace(/\d{4}\-(.*):\d{2}$/,"$1")+"</div>"),html.push("</div>"),html.push('<div class="goods_info_right">'),html.push("<ul>"),html.push('<li class="li">+'+n+"<i></i></li>"),1!=l&&2!=l&&(d=n,r="-"),html.push('<li class="li li2">-'+d+"</li>"),html.push("<li>"+r+"</li>"),html.push("</ul>"),html.push("</div>"),html.push("</div>"),html.push("</div>")}if((0==s||e.page==e.total)&&(orders_max="Y"),1==t&&0==html.length){$(".contents").empty();var c=[];c.push('<div class="nothing"><div class="nothing_img"><img src="img/store/sales_no.png"></div><div class="nothing_word">还没有销量数据哟</div></div>'),$(".contents").append(c.join("")),$(".nothing").show()}else $(".contents").append(html.join(""))}var UserToken=xigou.getToken(),page=1,orders_max="N";$(function(){xigou.getLoginUserInfo({callback:function(e,t){t==xigou.dictionary.success?(initStatics(),$(".contents").dropload({scrollArea:window,loadDownFn:function(e){initPageList(page,e),e.resetload(),1==page&&$(".dropload-refresh").hide(),page++}})):window.location.href="store_sales.html"}}),$(".title")[xigou.events.click](function(){window.location.href="store_sales.html"})});