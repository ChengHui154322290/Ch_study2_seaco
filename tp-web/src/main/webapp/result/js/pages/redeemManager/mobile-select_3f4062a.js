!function(t,e){"function"==typeof define&&define.amd?define(["$","dialog"],e):"function"==typeof define&&define.cmd?define(function(t){var i=t("$"),s=t("dialog");return e(i,s)}):"object"==typeof exports?module.exports=e():t.MobileSelectArea=e(window.Zepto||window.$||$)}(this,function(t){var e=function(){var t=Math.random().toString().replace(".","");this.id="scroller_"+t,this.scroller,this.data,this.index=0,this.value=[0,0,0],this.oldvalue,this.oldtext=[],this.text=["","",""],this.level=3,this.mtop=30,this.separator=" "};return e.prototype={init:function(e){this.events={click:function(){return"ontouchend"in document?"tap":"click"}(),change:"change"},this.settings=t.extend({eventName:this.events.click},e),this.trigger=t(this.settings.trigger),this.default=void 0==this.settings.default?1:0,level=parseInt(this.settings.level),this.level=level>0?level:3,this.trigger.attr("readonly","readonly"),this.value=this.settings.value&&this.settings.value.split(",")||[0,0,0],this.text=this.settings.text||this.trigger.attr("value").split(" ")||["","",""],this.oldvalue=this.value.concat([]),this.oldtext=this.text.concat([]),this.clientHeight=document.documentElement.clientHeight||document.body.clientHeight,this.clientWidth=document.documentElement.clientWidth||document.body.clientWidth,this.bindEvent()},getData:function(){var e=this,i=t.Deferred();return"object"==typeof this.settings.data?(this.data=this.settings.data,i.resolve()):t.ajax({dataType:"json",cache:!0,url:this.settings.data,type:"GET",success:function(t){e.data=t.data,i.resolve()},accepts:{json:"application/json, text/javascript, */*; q=0.01"}}),i},bindEvent:function(){var e=this;this.trigger[e.settings.eventName](function(){for(var i="",s=0;s<e.level;s++)i+="<div></div>";var n,a;if("bottom"==e.settings.position){n={position:"bottom",width:"100%",className:"ui-dialog-bottom",animate:!1};var a=[{no:"取消"},{yes:"确定"}]}t.confirm('<div class="ui-scroller-mask"><div id="'+e.id+'" class="ui-scroller">'+i+"<p></p></div></div>",a,function(t){"yes"==t&&e.submit(),"no"==t&&e.cancel(),this.dispose()},t.extend({width:320,height:215},n)),e.scroller=t("#"+e.id),e.getData().done(function(){e.format()});var l=0,o=0;return e.scroller.children().bind("touchstart",function(t){l=(t.changedTouches||t.originalEvent.changedTouches)[0].pageY}),e.scroller.children().bind("touchmove",function(e){o=(e.changedTouches||e.originalEvent.changedTouches)[0].pageY;var i=o-l,s=t(e.target).parent();if("DL"==s[0].nodeName){var n=parseInt(s.css("top")||0)+i;return s.css("top",n),l=o,!1}}),e.scroller.children().bind("touchend",function(i){o=(i.changedTouches||i.originalEvent.changedTouches)[0].pageY;var s=o-l,n=t(i.target).parent();if("DL"==n[0].nodeName){var a=t(n.parent()).index(),d=parseInt(n.css("top")||0)+s;d>e.mtop&&(d=e.mtop),d<-t(n).height()+60&&(d=-t(n).height()+60);var r=d/e.mtop,c=Math.round(r),h=Math.abs(c)+1;1==c&&(h=0),e.value[a]=t(n.children().get(h)).attr("ref"),e.text[a]=0==e.value[a]?"":t(n.children().get(h)).html();for(var u=e.level-1;u>a;u--)e.value[u]=0,e.text[u]="";return t(n.children().get(h)).hasClass("focus")||e.format(),t(n.children().get(h)).addClass("focus").siblings().removeClass("focus"),n.css("top",c*e.mtop),!1}}),!1})},format:function(){{var t=this;t.scroller.children()}this.f(this.data),console.log(t.text)},f:function(e){var i=this,s=e;s||(s=[]);var n,a='<dl><dd ref="0">——</dd>',l=0,o=i.mtop;if(0!==i.index&&"0"==i.value[i.index-1]&&0==this.default)a='<dl><dd ref="0" class="focus">——</dd>',i.value[i.index]=0,i.text[i.index]="",l=0;else{if("0"==i.value[i.index]&&(a='<dl><dd ref="0" class="focus">——</dd>',l=0),s.length>0&&1==this.default){a="<dl>";var d=s[0].pid||0,r=s[0].id||0;l=s[0].id,n=s[0].child,i.value[this.index]||(i.value[this.index]=r,i.text[this.index]=s[0].name),a+='<dd pid="'+d+'" class="'+u+'" ref="'+r+'">'+s[0].name+"</dd>"}for(var c=i.default,h=s.length;h>c;c++){var d=s[c].pid||0,r=s[c].id||0,u="";i.value[i.index]==r&&(u="focus",l=r,n=s[c].child,o=i.mtop*-(c-i.default)),a+='<dd pid="'+d+'" class="'+u+'" ref="'+r+'">'+s[c].name+"</dd>"}}a+="</dl>";var v=t(a);v.css("top",o);var g=i.scroller.children();return t(g[i.index]).html(v),i.index++,i.index>i.level-1?void(i.index=0):void i.f(n)},submit:function(){this.oldvalue=this.value.concat([]),this.oldtext=this.text.concat([]),1==this.trigger[0].nodeType&&(this.trigger.text(this.text.slice(0,this.level).join(this.separator)),this.trigger.attr("data-value",this.value.slice(0,this.level).join(","))),this.trigger.next().val(this.value.slice(0,this.level).join(",")),this.settings.callback&&this.settings.callback.call(this,this.scroller,this.text,this.value)},cancel:function(){this.value=this.oldvalue.concat([]),this.text=this.oldtext.concat([])}},e});