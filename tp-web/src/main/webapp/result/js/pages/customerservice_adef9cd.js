function InitPage(e){$("#id_item_img").attr("src",e.imgurl),$(".ui_list_name").text(e.itemname),e.returninfo&&($(".return_desc")[0].value=e.returninfo),InitTotlePrice(e.buycount,aftersalesparam.maxcount,e.itemprice),e.reasonCodeDesc&&$(".span_return_reson").text(e.reasonCodeDesc),$(".cart_shop_opt").cartshopopt(function(t){editNumFun(t,e.itemprice)}),OnTextChange()}function InitTotlePrice(e,t,a){$(".lineprice").text("¥"+a),$(".cart_shop_opt").attr("maxnum",t),1==e&&$(".quantity_decrease").addClass("disabled"),e==t&&$(".quantity_increase").addClass("disabled"),$(".car_item").text(e),SetTotalCountPrice(e,a)}function SetTotalCountPrice(e,t){var a=parseFloat(t);a||(a=0),a*=e;var i=String(a).split(".")[0]||"00",r=String(a).split(".")[1]||"00";$(".ui_price_info").text("¥"+i+"."+r),$(".total_price_info").html("共"+e+'件 退款金额：<span class="price_fen">¥<span class="price_yuan">'+i+".</span>"+r+"</span>")}function editNumFun(e,t){SetTotalCountPrice(e,t)}function SelectReturnReson(e){$(".return_reson")[xigou.events.click](function(){e.buycount=$(".car_item").text(),xigou.setLocalStorage("aftersalesparam",JSON.stringify(e)),window.location.href="returnreson.html"})}function InitUpdataphoto(e){var t=document.getElementById("upload_itme1").offsetWidth||60;$(".div_updata_photo_item").css("height",t);var a=1;if(e.imgList)for(;6>=a&&e.imgList[a-1];a++)$("#upload_itme"+a).css("visibility","visible"),$("#upload_img_itme"+a).attr("src",e.imgList[a-1]);$("#upload_itme"+a).css("visibility","visible"),OnSeletPhoto()}function OnSeletPhoto(){$(".div_updata_photo_item")[xigou.events.click](function(){var e=this.getAttribute("index");$("#file_photo_"+e)[0].click()}),$(".input_photo").change(function(){for(var e=event.target.files,t=0;t<e.length;t++){var a=e[t];if(!a.type.match("image.*"))return void $.tips({content:"请选择图片文件",stayTime:2e3,type:"warn"});if(a.size>2097152)return void $.tips({content:"请选择小于2M的图片",stayTime:2e3,type:"warn"});var i=new FileReader,r=this.getAttribute("id"),n=r[r.length-1];i.onload=function(){var e=this.result;uploadImageUrl(e,n)},i.readAsDataURL(a)}})}function uploadImageUrl(e,t){var a={imgstream:e.toString().split(",")[1],token:xigou.getToken()};xigou.activeUser.uploadimage({requestBody:a,callback:function(a,i){if(i==xigou.dictionary.success){if(!a||!a.data||!a.data.path||0!=a.code)return void $.tips({content:a.msg||"上传图片失败,请检查网络连接",stayTime:2e3,type:"warn"});$("#upload_img_itme"+t).attr("src",e),aftersalesparam.imgList||(aftersalesparam.imgList={}),aftersalesparam.imgList[t]=a.data.path,$("#upload_itme"+(parseInt(t)+1)).css("visibility","visible")}else $.tips({content:a.msg||"上传图片失败,请检查网络连接",stayTime:2e3,type:"warn"})}})}function OnTextChange(){var e=document.getElementById("input_name").value,t=document.getElementById("input_way").value;e&&t?$(".confirm").addClass("confirm_enable"):$(".confirm").removeClass("confirm_enable")}function ClickConfirm(){$(".confirm")[xigou.events.click](function(){if($(".confirm").hasClass("confirm_enable")){var e={token:xigou.getLocalStorage("token"),returncount:$(".car_item").text(),ordercode:aftersalesparam.ordercode,returnreason:aftersalesparam.reasonCode,returninfo:$(".return_desc")[0].value,linkname:document.getElementById("input_name").value,linktel:document.getElementById("input_way").value,lineid:aftersalesparam.lineid};aftersalesparam.imgList&&(e.imageone=aftersalesparam.imgList[1]||"",e.imagetwo=aftersalesparam.imgList[2]||"",e.imagethree=aftersalesparam.imgList[3]||"",e.imagefour=aftersalesparam.imgList[4]||"",e.imagefive=aftersalesparam.imgList[5]||""),xigou.aftersales.apply({requestBody:e,callback:function(e,t){if(t==xigou.dictionary.success){if(0!=e.code)return void $.tips({content:e.msg||"提交售后申请失败",stayTime:2e3,type:"warn"});xigou.removelocalStorage("aftersalesparam"),window.location.href="orders.html"}else $.tips({content:e.msg||"提交售后申请失败",stayTime:2e3,type:"warn"})}})}})}var _aftersalesparam=xigou.getLocalStorage("aftersalesparam"),aftersalesparam={};""!=_aftersalesparam&&(aftersalesparam=JSON.parse(_aftersalesparam)),$(function(){return aftersalesparam&&aftersalesparam.itemname?(InitPage(aftersalesparam),InitUpdataphoto(aftersalesparam),SelectReturnReson(aftersalesparam),void ClickConfirm()):void history.go(-1)});