function lists(){var e={token:xigou.getToken()};xigou.activeUser.lists({requestBody:e,callback:function(e,t){if(t==xigou.dictionary.success)if(null==e)$.tips({content:xigou.dictionary.chineseTips.server.value_is_null,stayTime:2e3,type:"warn"});else switch(e.code){case"0":addressData=e.data,"undefined"!=typeof addressData&&5==addressData.length&&($(".add").attr("href","javascript:void(0)"),$(".add")[xigou.events.click](function(){$.tips({content:"收货地址已满，无法添加",stayTime:2e3,type:"warn"})})),setHtml(e);break;default:$.tips({content:e.msg||"获取收货地址失败",stayTime:2e3,type:"warn"})}else $.tips({content:"请求失败，详见"+e,stayTime:2e3,type:"warn"})}})}function del(e){var t={token:xigou.getToken(),aid:e};xigou.activeUser.del({requestBody:t,callback:function(e,t){if(t==xigou.dictionary.success)if(null==e)$.tips({content:xigou.dictionary.chineseTips.server.value_is_null,stayTime:2e3,type:"warn"});else switch(e.code){case"0":$.tips({content:e.msg||"删除成功",stayTime:2e3,type:"warn"}),history.go(0);break;default:$.tips({content:e.msg||"删除失败",stayTime:2e3,type:"warn"})}else $.tips({content:"请求失败，详见"+e,stayTime:2e3,type:"warn"})}})}function edit(e){var t=getAddData(e);t&&(t.token=xigou.getToken(),t.isdefault="1",xigou.activeUser.edit({requestBody:t,callback:function(e,t){if(t==xigou.dictionary.success)if(null==e)$.tips({content:xigou.dictionary.chineseTips.server.value_is_null,stayTime:2e3,type:"warn"});else switch(e.code){case"0":$.tips({content:e.msg||"设置成功",stayTime:2e3,type:"warn"});break;case"-100":var i=$.dialog({title:"",content:e.msg||"用户失效，请重新登录。",button:["确认"]});i.on("dialog:action",function(e){console.log(e.index),xigou.removelocalStorage("token"),window.location.href="logon.html"});break;default:$.tips({content:e.msg||"设置失败",stayTime:2e3,type:"warn"})}else $.tips({content:"请求失败，详见"+e,stayTime:2e3,type:"warn"})}}))}function setHtml(e){var t='<li class="ui-border-t clearfix" aid="#aid#"><div class="ui-list-info recvaddress-item" aid="#num#"><div class="recvaddress-item-top" style = "font-size: 16px;"><span>#name#</span><b>#phone#</b></div><div class="recvaddress-item-idnum"><div class="#certified#"></div><div style="display: inline-block;">身份证号码：#identityCard#</div></div><div class="recvaddress-item-top"><i>#address#</i></div><div class="recvaddress-item-bottom"><div class="recvadress-set"><p><label class="ui-checkbox-s"><input class="recvadress-set-icon" aid="#num#" type="radio" name="checkbox" #default#></label>设为默认地址</p></div><div class="recvadress-edit"><a n="#num#" class="edit">编辑</a><a href="javascript:void(0);" n="#num#" class="delete">删除</a>&nbsp;&nbsp;</div></div></div></li>',i=[];if(e&&e.data)for(var a in e.data){var s=e.data[a],n=s.fullinfo;void 0==s.identityCard&&(s.identityCard=""),i.push(t.replace("#name#",s.name).replace("#phone#",s.tel).replace("#address#",n).replace("#aid#",s.aid).replace("#default#","1"==s.isdefault?'checked=""':"").replace("#identityCard#",s.identityCard).replace(/#num#+/g,s.aid).replace("#certified#","1"==s.iscertificated?"certified":"notcertified"))}i.length<1?$(".recvaddress-none").show():($("#recvaddress-list-id").html(i.join("")),$(".recvaddress-none").hide(),bindEdit()),setSetRecvaddress(e.data)}function getAddData(e){var t=null;for(var i in addressData)if(addressData[i].aid==e){t=addressData[i];break}return t}function bindEdit(){$(".recvaddress-data a.edit")[xigou.events.click](function(){var e=$(this).attr("n");xigou.setSessionStorage("edit_address",getAddData(e),!0),xigou.removelocalStorage("my_address"),window.location.href="editaddress.html"})}function setSetRecvaddress(e){var t=xigou.getQueryString("selectType");1==t&&($(".recvaddress-item-bottom").hide(),$(".recvaddress-item-idnum, .recvaddress-item-top")[xigou.events.click](function(t){var i=$(t.target).parents(".recvaddress-item"),a=$(i).attr("aid");if(-1!=a)for(var s=0;s<e.length;s++)if(e[s].aid==a)return xigou.setSessionStorage("clearing_select_address",e[s],!0),void history.go(-1)}),$(".goBack").attr("href","javascript:history.go(-1);"))}xigou.setLocalStorage("my_address",{},!0),$(function(){xigou.getLoginUserInfo({callback:function(e,t){t!=xigou.dictionary.success&&(window.location.href="logon.html")}})}),$(function(){lists(),$(document).on(xigou.events.click,"a.delete",function(){var e=$(this).attr("n"),t=$.dialog({title:"",content:"确定删除此地址?",button:["取消","确认"]});t.on("dialog:action",function(t){1==t.index&&del(e)})}),$(document).on("change","input.recvadress-set-icon",function(){edit($(this).attr("aid"))}),$("#back").on(xigou.events.click,function(){window.history.back()})});var addressData;