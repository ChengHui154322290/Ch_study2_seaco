function InitSearchEdid(e){if(Key&&Key.length>0)$("#input_search")[0].value=Key,$(".div_clear_input").show(),$(".div_clear_input")[xigou.events.click](function(){$(".div_search_history").show(),$("#input_search_history")[0].value=" ",$("#input_search_history").focus()}),InitSearchHistory(e);else{var r=xigou.getQueryString("name");$("#id_name").text(r),$("#id_name").show()}}function Search(e,r){var s="curpage="+CurPage;Key?s=s+"&key="+Key:categoryid?s=s+"&categoryid="+categoryid:brandid&&(s=s+"&brandid="+brandid),r&&(s=s+"&sort="+r),s+="&salespattern=9",xigou.classify.search({p:s,callback:function(r,s){return!s==xigou.dictionary.success?void $.tips({content:"收索失败,请检测网络连接",stayTime:2e3,type:"warn"}):void InitPage(e,r)}})}function InitPage(e,r){if("index"==fromPage&&$(".goBack").parent("a").attr("href","group_buying.html"),!r)return void $.tips({content:"收索失败,请检测网络连接",stayTime:2e3,type:"warn"});if(0!=r.code)return void $.tips({content:r.msg||"收索失败,请检测网络连接",stayTime:2e3,type:"warn"});if(r.data.curpage&&r.data.totalpagecount&&r.data.curpage!=r.data.totalpagecount||(bMaxPage=!0,e.lock(),$(".dropload-down").hide()),1==r.data.curpage){if($(".ul_search_list").empty(),!r.data.list||0==r.data.list.length)return $(".div_search_list").addClass("div_search_list_none"),bMaxPage=!0,e.lock(),void $(".dropload-down").hide();$(".div_search_list").removeClass("div_search_list_none")}var s=[];for(var t in r.data.list){var i=r.data.list[t],a=i.price.split(".")[0]||"00",o=i.price.split(".")[1]||"00";s.push('<div class="search_result_item">'),s.push('        <a href="group_detail.html?tid='+i.tid+"&amp;sku="+i.sku+'">'),s.push('   <span class="shop_logo"><img src="'+i.imgurl+'"></span>'),s.push('        <div class="search_result_goods">'),s.push(' <div class="search_result_title" style="width: 200px; overflow: hidden">'+i.name+"</div>"),s.push('      <div class="search_result_price">¥'+a+"."+o+'<del class="old_price">¥'+i.oldprice+"</del></div>"),s.push('   <div class="search_result_shop_name">'+i.shopname+'<span class="sale">'+i.salescount+"</span></div>"),s.push("   </div>"),s.push("        </a>"),s.push("</div>")}$(".search_result_list").append(s.join(" "))}function InitSearchHistory(e){"group_buying"==fromPage?($(".div_search_history").show(),$("#input_search_history").focus()):$(".div_search_history").hide();var r=xigou.getLocalStorage("searchHistory"),s=[];if(""!=r&&(s=JSON.parse(r)),0==s.length)$(".div_history_list").hide(),$(".div_noHistory").show();else{$(".div_history_list").show(),$(".div_noHistory").hide();for(var t=0;t<s.length;t++)$("#id_ul_history").append('<li class="li_history_item"></li>'),$("#id_ul_history li").eq(t).text(s[t]);$(".li_history_item")[xigou.events.click](function(){resetKeyAndSearch(this.innerHTML,s,e)})}$(".div_search_input_box").click(function(){$(".div_search_list").hide(),$(".div_search_history").show(),$("#input_search_history")[0].value=$("#input_search")[0].value,$("#input_search_history").focus(),$(".div_clear_input_history").show()}),$(".cancal_search")[xigou.events.click](function(){setTimeout(function(){window.location.href="group_buying.html"},150)}),$("#input_search_history").keyup(function(r){var t=$(this).val();t&&t.length>0?($(".div_clear_input_history").show(),13==r.keyCode&&(t=t.replace(/(^\s*)|(\s*$)/g,""),t.length>0&&resetKeyAndSearch(t,s,e))):$(".div_clear_input_history").hide()}),$("#input_search_history").keydown(function(){$(".div_clear_input_history").show()}),$(".div_clear_input_history")[xigou.events.click](function(){$("#input_search_history")[0].value="",$(".div_clear_input_history").hide()}),$(".div_clear_history").unbind("ontouchend"in document?"tap":"click"),$(".div_clear_history")[xigou.events.click](function(){var e=$.dialog({title:"",content:"确认清空输入的搜索历史吗？ ",button:["取消","确认"]});e.on("dialog:action",function(e){1==e.index&&(s=[],xigou.removelocalStorage("searchHistory"),$("#id_ul_history").empty(),$(".div_history_list").hide(),$(".div_noHistory").show())})})}function resetKeyAndSearch(e,r){if(e&&e.length>0){var s=r.indexOf(e);-1!=s&&r.splice(s,1),r.unshift(e),r.length>10&&r.pop(),xigou.setLocalStorage("searchHistory",JSON.stringify(r)),window.location.href="group_search.html?key="+e}}function selectSortType(e){$(".div_search_sort_item")[xigou.events.click](function(){var r=this.getAttribute("id");if("sortByPrice"==r)$(this).hasClass("current_sort")?$(this).children("u").hasClass("up")?($(this).children("u").removeClass("up"),$(this).children("u").addClass("down"),searchSortType=1):($(this).children("u").removeClass("down"),$(this).children("u").addClass("up"),searchSortType=2):($(".div_search_sort_item").removeClass("current_sort"),$(this).addClass("current_sort"),$(this).children("u").removeClass("down"),$(this).children("u").addClass("up"),searchSortType=2);else{if($(this).hasClass("current_sort"))return;$(".div_search_sort_item").removeClass("current_sort"),$(this).addClass("current_sort");var r=this.getAttribute("id");"sortByDefoule"==r?searchSortType="":"sortBySales"==r?searchSortType=3:"sortByNew"==r&&(searchSortType=5)}research(e)})}function research(e){CurPage=1,bMaxPage=!1,$(".ul_search_list").empty(),e.unlock(),e.resetload(),Search(e,searchSortType),CurPage++}var CurPage=1,bMaxPage=!1,searchSortType=xigou.getQueryString("sort")||"",Key=xigou.getQueryString("key"),categoryid=xigou.getQueryString("categoryid"),brandid=xigou.getQueryString("brandid"),fromPage=xigou.getQueryString("fromPage"),Key=xigou.getQueryString("key"),name=xigou.getQueryString("name");$(function(){$(".dropload-refresh").hide();var e=$(".search_result_list").dropload({scrollArea:window,loadDownFn:function(e){bMaxPage||(e.resetload(),Search(e,searchSortType),CurPage++)}});switch($(".search_names").text(Key),searchSortType){case 1:$(".div_search_sort_item").removeClass("current_sort"),$("#sortBySales").addClass("current_sort"),$("#sortBySales").children("u").addClass("down"),$("#sortBySales").children("u").removeClass("up");break;case 2:$(".div_search_sort_item").removeClass("current_sort"),$("#sortBySales").addClass("current_sort"),$("#sortBySales").children("u").removeClass("down"),$("#sortBySales").children("u").addClass("up");break;case 3:$(".div_search_sort_item").removeClass("current_sort"),$("#sortByPrice").addClass("current_sort");break;case 5:$(".div_search_sort_item").removeClass("current_sort"),$("#sortByNew").addClass("current_sort")}$("#input_search")[xigou.events.click](function(){$(".div_search_history").show()}),window.onbeforeunload=function(){var e=[];searchSortType&&e.push("sort="+searchSortType),Key&&e.push("key="+Key),searchSortType&&e.push("sort="+searchSortType),categoryid&&e.push("categoryid="+categoryid),brandid&&e.push("brandid="+brandid),name&&e.push("name="+name),xigou.setSessionStorage("productdetails_backurl","group_search.html?"+e.join("&"))},onbeforeunload(),$("form").submit(function(){return!1}),$(".dropload-down").hide(),InitSearchEdid(e),selectSortType(e),InitSearchHistory()});