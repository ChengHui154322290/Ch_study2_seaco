function getImgCode(){$("input#name").change(function(){xigou.valiformdata.checkSingleNode($("#name"),valiDataCallBack)&&$("#codeImg").attr("src","../../mobile/init/captchaimage.htm?telephone="+$("input#name").val()+"&typeimage=1&time="+(new Date).getTime())}),$("#codeImg").click(function(){xigou.valiformdata.checkSingleNode($("#name"),valiDataCallBack)&&($("#codeImg").attr("src","../../mobile/init/captchaimage.htm?telephone="+$("input#name").val()+"&typeimage=1&time="+(new Date).getTime()),$("#imgcode").val(""))})}function getTheCode(){$(".forgetpwd-btn,#achieve")[xigou.events.click](function(){})}function setCodeTime(e){var t=$(".forgetpwd-btn");t.text(e);var i=setInterval(function(){return 0>=e?(clearInterval(i),t.text("获取验证码"),void(allowGetTheCode=!0)):void t.text(--e)},1e3)}function modify(){var e=$("body").height(),t=$(window).height();$(".logo").css("top",.92*Math.max(e,t)-42+"px"),$(".forgetpwd-forgetpwd")[xigou.events.click](function(){var e={loginname:$("#input-telnum").val(),captcha:$("#input-code").val(),pwd:$("#input-pwd").val()},t={requestBody:e,callback:function(e,t){if(t==xigou.dictionary.success)if(null==e)$.tips({content:xigou.dictionary.chineseTips.server.value_is_null,stayTime:2e3,type:"warn"});else{var i=e.code;switch(xigou.debugPrint("修改成功返回的code值："+i),i){case"0":{xigou.getSessionStorage("loginjump_url")}xigou.setLocalStorage("login_name",$("#input-telnum").val());var n={token:e.data.token,telephone:e.data.tel,name:e.data.name},a=$.dialog({title:"",content:e.msg||"修改成功",button:["确认"]});a.on("dialog:action",function(t){console.log(t.index),xigou.removeSessionStorage("realname"),xigou.removeSessionStorage("realnum"),xigou.setSessionStorage("userinfo",n,!0),xigou.setLocalStorage("login_name",$("#input-telnum").val()),xigou.setLocalStorage("token",e.data.token),window.location.href="logon.html"});break;case"-2":$.tips({content:e.msg||"验证码错误",stayTime:2e3,type:"warn"});break;default:$.tips({content:e.msg||"修改失败",stayTime:2e3,type:"warn"})}}else xigou.alert("请求失败，详见"+e)}};xigou.activeUser.modifypassword(t)})}function valiDataCallBack(e,t){$.tips({content:e,stayTime:2e3,type:"warn"}),$("#"+t).focus()}function initValiData(){var e={methods:{name:{required:"required",mobile:!0},code:{required:"required"},pwd:{required:"required",password:!0},imgcode:{required:"required"}},errors:{name:{required:"请输入手机号码",mobile:"手机号码不正确，请重新输入"},code:{required:"请输入验证码"},pwd:{required:"请输入密码",password:"请输入6-30位密码，可以为数字、字母和下划线"},imgcode:{required:"请输入验证码"}}};return xigou.valiformdata.initValiData(e)}$(function(){getTheCode(),modify(),initgeetest(),isWeiXin()&&($(".ui-header").hide(),$(".input_info_list").css({"margin-top":"0"}),$("title").html("忘记密码")),""!=$("#input-telnum")[0].value&&$(".div_clear_input1").show(),$("#input-telnum").keyup(function(){var e=$(this).val();e&&e.length>0?$(".div_clear_input1").show():$(".div_clear_input1").hide()}),$(".div_clear_input1")[xigou.events.click](function(){$(".div_clear_input1").hide(),$("#input-telnum")[0].value=""}),""!=$("#input-pwd")[0].value&&$(".div_clear_input2").show(),$("#input-pwd").keyup(function(){var e=$(this).val();e&&e.length>0?$(".div_clear_input2").show():$(".div_clear_input2").hide()}),$(".div_clear_input2")[xigou.events.click](function(){$(".div_clear_input2").hide(),$("#input-pwd")[0].value=""})});var handlerEmbed=function(e){$(".forgetpwd-btn,#achieve")[xigou.events.click](function(){var t=e.getValidate();if(t){var i={geetest_challenge:$("[name=geetest_challenge]").val(),geetest_validate:$("[name=geetest_validate]").val(),geetest_seccode:$("[name=geetest_seccode]").val(),tel:$("#input-telnum").val(),randid:$("#randid").val(),type:"2"},n={requestBody:i,callback:function(e,t){t==xigou.dictionary.success?null==e?$.tips({content:xigou.dictionary.chineseTips.server.value_is_null,stayTime:2e3,type:"warn"}):"0"==e.code?($("#hide-div").show(),$(".forgetpwd-btn").hide(),$.tips({content:e.msg,stayTime:2e3,type:"warn"})):$.tips({content:e.msg||"获取验证码失败",stayTime:2e3,type:"warn"}):xigou.alert("请求失败，详见"+e)}};xigou.activeUser.sendGeeCode(n)}else $.tips({content:"请先完成验证",stayTime:2e3,type:"warn"})}),e.appendTo("#embed-captcha"),e.onReady(function(){})},allowGetTheCode=!0,uuid="",fanli=xigou.getQueryString("fanli");