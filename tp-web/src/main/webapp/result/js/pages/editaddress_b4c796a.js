function initAreaAddress(e){xigou.setLocalStorage("my_address",e,!0),$("#rela_area").val(e.province+" "+e.city+" "+e.district),$("#areaidlist").val(e.provinceid+","+e.cityid+","+e.districtid),$("#rela_area").attr("data-value",$("#areaidlist").val()),$("#rela_street").val(e.street),$("#streetId").val(e.streetid),$("#rela_street").attr("data-value",e.streetid),initArea(),$.ajax({dataType:"json",cache:!0,url:xigou.activeHost+xigou.activeUrl.position.getareatree+"?id="+e.districtid,type:"GET",success:function(e){streetArea.data=e},accepts:{json:"application/json, text/javascript, */*; q=0.01"}})}function initAreaList(){var e={token:xigou.getToken()};xigou.redeemManager.paramskulist({requestBody:e,callback:function(e,t){if(t==xigou.dictionary.success){var a=e||null;if(null==a||0==a.length)return!1;var i=a.code;if(0==i){var o=new MobileSelectArea;o.init({trigger:$(".saleskucodelist"),value:$("#skucode").val(),level:1,data:e.data,position:"bottom"})}else me.lock(),$(".dropload-down").hide()}}})}function submits(){$(".address-edit,.address-save_wx")[xigou.events.click](function(){if(xigou.valiformdata.check(null,valiDataCallBack)){var e=xigou.getLocalStorage("my_address",!0),t=$("#areaidlist").val().split(","),a=$("#rela_area").val().split(" "),i=$("#streetId").val(),o=$("#rela_street").val(),r={token:xigou.getToken(),aid:e.aid,name:$("#name").val(),tel:$("#telephone").val(),provid:t[0],provname:a[0],cityid:t[1],cityname:a[1],districtid:t[2],districtname:a[2],streetid:i,streetname:o,info:$("#addressinfo").val(),isdefault:$("#name").attr("isdefault"),identityCard:$("#identityCard").val(),frontimg:$("#upload_img_itme1").attr("src"),backimg:$("#upload_img_itme2").attr("src")};r.frontimg.split("address/upload.png").length>1&&(r.frontimg=""),r.backimg.split("address/upload.png").length>1&&(r.backimg=""),r&&xigou.activeUser.edit({requestBody:r,callback:function(e,t){if(t==xigou.dictionary.success)if(null==e)$.tips({content:xigou.dictionary.chineseTips.server.value_is_null,stayTime:2e3,type:"warn"});else switch(e.code){case"0":var a=$.dialog({title:"",content:e.msg||"编辑收货地址成功",button:["确认"]});a.on("dialog:action",function(e){console.log(e.index),xigou.removeSessionStorage("add_address"),xigou.removelocalStorage("my_address"),window.location.href="recvaddress.html"});break;case"-100":var a=$.dialog({title:"",content:e.msg||"用户失效，请重新登录。",button:["确认"]});a.on("dialog:action",function(e){console.log(e.index),xigou.removelocalStorage("token"),window.location.href="logon.html"});break;default:$.tips({content:e.msg||"编辑收货地址失败",stayTime:2e3,type:"warn"})}else $.tips({content:"请求失败，详见"+e,stayTime:2e3,type:"warn"})}})}})}function valiDataCallBack(e,t){xigou.toast(e),$("#"+t).focus()}function initValiData(){var e={methods:{name:{required:"required",checkXss:"checkXss"},telephone:{required:"required",mobile:"mobile"},area:{required:"required"},addressinfo:{required:"required"}},errors:{name:{required:"收货人姓名不能为空",checkXss:"请正确填写收货人姓名"},telephone:{required:"手机号不能为空",mobile:"请填写正确的手机号"},area:{required:"请选择所在区域"},addressinfo:{required:"详细地址不能为空"}}};return xigou.valiformdata.initValiData(e)}function InitUpdataphoto(e){e&&e.frontimg&&$("#upload_img_itme1").attr("src",e.frontimg),e&&e.backimg&&$("#upload_img_itme2").attr("src",e.backimg),OnSeletPhoto()}function OnSeletPhoto(){$(".div_updata_photo_item")[xigou.events.click](function(){{var e=$(this).find("input");$(this).find("img")}e[0].click()}),$(".input_photo").change(function(){for(var e=event.target.files,t=0;t<e.length;t++){var a=e[t];if(!a.type.match("image.*"))return void $.tips({content:"请选择图片文件",stayTime:2e3,type:"warn"});var i=new FileReader,o=$(this).parent(".div_updata_photo_item").find("img");i.onload=function(){var e=this.result,t=15,a=function(t){e=t.src,uploadImageUrl(e,o)};e=xigou.compress2(e,t,a)},i.readAsDataURL(a)}})}function uploadImageUrl(e,t){var a={imgstream:e.toString().split(",")[1],token:xigou.getToken()};xigou.activeUser.uploadimage({requestBody:a,callback:function(e,a){if(a==xigou.dictionary.success){if(!e||!e.data||!e.data.path||0!=e.code)return void $.tips({content:e.msg||"上传图片失败,请检查网络连接",stayTime:2e3,type:"warn"});t.attr("src",e.data.path)}else $.tips({content:e.msg||"上传图片失败,请检查网络连接",stayTime:2e3,type:"warn"})}})}var data;$(function(){isWeiXin()&&($(".ui-header").hide(),$(".add_new").show(),$(".ui-form").css({"margin-top":"0"}),$("title").text("编辑收货地址")),data=xigou.getSessionStorage("edit_address",!0),xigou.getLoginUserInfo({callback:function(e,t){if(t==xigou.dictionary.success){submits(),initValiData();var a=xigou.getLocalStorage("my_address",!0);data&&($("#name").val(data.name),$("#name").attr("isdefault",data.isdefault),$("#telephone").val(data.tel),$("#identityCard").val(data.identityCard),"undefined"==typeof a||""==a?initAreaAddress(data):""==a.street?initAreaAddress(data):(a.aid=data.aid,initAreaAddress(data)),$("#addressinfo").val(data.info),InitUpdataphoto(data))}else window.location.href="index.html"}})});