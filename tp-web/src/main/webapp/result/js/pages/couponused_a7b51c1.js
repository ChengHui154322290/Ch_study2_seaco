function usedlookrule(){var e="1.本券可与红包叠加使用<br>2.本券不可与其他优惠券叠加使用<br>3.本券使用后不可找零<br>4.本券不可抵扣运费及税金";$(".list .r>span:last-child")[xigou.events.click](function(){xigou.alert({message:'<p style="text-align:left;margin-left:15px;color: #333;font-size: 1.4rem;">'+e+"</p>",params:{title:"使用规则"}})})}function used(e,i){var n={token:xigou.getToken(),type:"1",status:"1",curpage:e};xigou.activeUser.haved({requestBody:n,callback:function(e,n){if(n==xigou.dictionary.success)if(null==e)$.tips({content:xigou.dictionary.chineseTips.server.value_is_null,stayTime:2e3,type:"warn"});else switch(e.code){case"0":usedsetHtmlView(e);break;case"-100":var o=$.dialog({title:"",content:e.msg||"用户失效，请重新登录。",button:["确认"]});o.on("dialog:action",function(e){console.log(e.index),xigou.removelocalStorage("token"),window.location.href="logon.html"});break;default:$.tips({content:e.msg||"获取优惠券信息失败",stayTime:2e3,type:"warn"}),i.lock(),$(".dropload-down").hide()}else $.tips({content:"请求失败，详见"+e,stayTime:2e3,type:"warn"}),i.lock(),$(".dropload-down").hide()}})}function usedsetHtmlView(e){var i={coupon0:[],coupon1:[],coupon2:[]};if(e&&e.data.list)for(var n in e.data.list){var o=e.data.list[n];i["coupon"+o.status].push(o)}for(var l='<div class="empty_box">没有已使用的优惠券</div>',a='<div class="ui-flex ui-flex-ver ui-flex-pack-center ui-flex-align-start"><div class="coupon-item" ><div class="coupon-used-info"><div class="item_price"><span>¥</span><%=price%></div><div class="coupon-introduce"><div class="coupon-name"><%=name%></div><ul><li><%=validtime%></li><li><%=rule%></li></ul></div></div></div></div>',d='<div class="ui-flex ui-flex-ver ui-flex-pack-center ui-flex-align-start"><div class="card-item" ><div class="card-used-info"><div class="item_price"><span>¥</span><%=price%></div><div class="card-introduce"><div class="card-name"><%=name%></div><ul><li><%=validtime%></li><li>可直接兑换成西客币</li></ul></div></div></div></div>',t=0;t<i.coupon1.length;t++){var s=[],c=i.coupon1[t];if("0"==c.type){var u=$.tpl(a,c);s.push(u),0==s.length?$(".coupon-used").html(l):$(".coupon-used").append(s.join(""))}else if("1"==c.type)if("1"==c.exchangeXgMoney){var u=$.tpl(d,c);s.push(u),0==s.length?$(".card-used").html(l):$(".card-used").append(s.join(""))}else{var u=$.tpl(a,c);s.push(u),0==s.length?$(".card-used").html(l):$(".card-used").append(s.join(""))}}0==i.coupon0.length&&0==$(".card-unused").find(".ui-flex").length&&0==$(".coupon-unused").find(".ui-flex").length?$(".nocard0").show():$(".nocard0").hide(),0==i.coupon1.length&&0==$(".card-unused").find(".ui-flex").length&&0==$(".coupon-unused").find(".ui-flex").length?$(".nocard1").show():$(".nocard1").hide(),0==i.coupon2.length&&0==$(".card-expired").find(".ui-flex").length&&0==$("coupon-expired").find(".ui-flex").length?$(".nocard2").show():$(".nocard2").hide()}$(function(){var e=1;xigou.getLoginUserInfo({callback:function(i,n){n==xigou.dictionary.success?$(".coupon-used").dropload({scrollArea:window,loadDownFn:function(i){used(e,i),i.resetload(),1==e&&$(".dropload-refresh").hide(),e++}}):window.location.href="index.html"}})});