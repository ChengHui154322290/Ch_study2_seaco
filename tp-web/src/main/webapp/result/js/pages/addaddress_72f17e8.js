function newAdd(){$(".address-save,.address-save_wx")[xigou.events.click](function(){if(xigou.valiformdata.check(null,valiDataCallBack)){var e=(xigou.getLocalStorage("my_address",!0),$("#areaidlist").val().split(",")),t=$("#rela_area").val().split(" "),a=$("#streetId").val(),i=$("#rela_street").val(),r={token:xigou.getToken(),name:$("#name").val(),tel:$("#telephone").val(),provid:e[0],provname:t[0],cityid:e[1],cityname:t[1],districtid:e[2],districtname:t[2],streetid:a,streetname:i,info:$("#addressinfo").val(),isdefault:$("#isdefault").prop("checked")?"1":"0",identityCard:$("#identityCard").val(),frontimg:$("#upload_img_itme1").attr("src"),backimg:$("#upload_img_itme2").attr("src")};r.frontimg.split("address/upload.png").length>1&&(r.frontimg=""),r.backimg.split("address/upload.png").length>1&&(r.backimg=""),xigou.activeUser.newAdd({requestBody:r,callback:function(e,t){if(t==xigou.dictionary.success)if(null==e)$.tips({content:xigou.dictionary.chineseTips.server.value_is_null,stayTime:2e3,type:"warn"});else switch(e.code){case"0":var a=$.dialog({title:"",content:e.msg||"新增收货地址成功",button:["确认"]});a.on("dialog:action",function(e){console.log(e.index),xigou.removeSessionStorage("add_address"),xigou.removelocalStorage("my_address"),xigou.getQueryString("selecturl")&&$("#isdefault").is(":checked")&&(xigou.removeSessionStorage("clearing_select_address"),window.location.href="clearing.html"),window.location.href=backpage&&"shippingaddressnull.html"==backpage?"recvaddress.html":backpage?backpage:xigou.getQueryString("selecturl")||"recvaddress.html"});break;case"-100":var a=$.dialog({title:"",content:e.msg||"用户失效，请重新登录。",button:["确认"]});a.on("dialog:action",function(e){console.log(e.index),xigou.removelocalStorage("token"),window.location.href="logon.html"});break;default:$.tips({content:e.msg||"新增收货地址失败",stayTime:2e3,type:"warn"})}else $.tips({content:"请求失败，详见"+e,stayTime:2e3,type:"warn"})}})}})}function valiDataCallBack(e,t){$.tips({content:e,stayTime:2e3,type:"warn"}),$("#"+t).focus()}function initValiData(){var e={methods:{name:{required:"required",checkXss:"checkXss"},telephone:{required:"required",mobile:"mobile"},rela_area:{required:"required"},addressinfo:{required:"required"}},errors:{name:{required:"收货人姓名不能为空",checkXss:"请正确填写收货人姓名"},telephone:{required:"手机号不能为空",mobile:"请填写正确的手机号"},rela_area:{required:"请选择所在区域"},addressinfo:{required:"详细地址不能为空"}}};return xigou.valiformdata.initValiData(e)}function InitUpdataphoto(e){e&&e.frontimg&&$("#upload_img_itme1").attr("src",e.frontimg),e&&e.backimg&&$("#upload_img_itme2").attr("src",e.backimg),OnSeletPhoto()}function OnSeletPhoto(){$(".div_updata_photo_item")[xigou.events.click](function(){{var e=$(this).find("input");$(this).find("img")}e[0].click()}),$(".input_photo").change(function(){for(var e=event.target.files,t=0;t<e.length;t++){var a=e[t];if(!a.type.match("image.*"))return void $.tips({content:"请选择图片文件",stayTime:2e3,type:"warn"});var i=new FileReader,r=$(this).parent(".div_updata_photo_item").find("img");i.onload=function(){var e=this.result,t=15,a=function(t){e=t.src,uploadImageUrl(e,r)};e=xigou.compress2(e,t,a)},i.readAsDataURL(a)}})}function uploadImageUrl(e,t){var a={imgstream:e.toString().split(",")[1],token:xigou.getToken()};xigou.activeUser.uploadimage({requestBody:a,callback:function(e,a){if(a==xigou.dictionary.success){if(!e||!e.data||!e.data.path||0!=e.code)return void $.tips({content:e.msg||"上传图片失败,请检查网络连接",stayTime:2e3,type:"warn"});t.attr("src",e.data.path)}else $.tips({content:e.msg||"上传图片失败,请检查网络连接",stayTime:2e3,type:"warn"})}})}$(function(){initArea(),xigou.getLoginUserInfo({callback:function(e,t){if(t==xigou.dictionary.success){setbackpage(),newAdd(),initValiData();var a=xigou.getSessionStorage("add_address",!0),i=xigou.getLocalStorage("my_address",!0)||{};a&&($("#name").val(a.name),$("#telephone").val(a.telephone),$("#addressinfo").val(a.addressinfo),$("#identityCard").val(a.identityCard)),InitUpdataphoto(a),i.provinceid&&($("#area").text(i.province+" "+i.city+" "+i.district+" "+i.street),$("#rela_area").val(i.province+" "+i.city+" "+i.district+" "+i.street))}else window.location.href="index.html"}});var e="addrlist.html?showChooseArea=false&backurl=addaddress.html&selecturl="+xigou.getQueryString("selecturl")||"addrlist.html?showChooseArea=false&backurl=addaddress.html";$("#provinces").attr("href",e),$("#provinces").length>0&&($("#provinces")[0].onclick=function(){var e={name:$("#name").val(),telephone:$("#telephone").val(),addresscode:{},addressinfo:$("#addressinfo").val(),isdefault:$("#isdefault").prop("checked")?"1":"0",identityCard:$("#identityCard").val(),frontimg:$("#upload_img_itme1").attr("src"),backimg:$("#upload_img_itme2").attr("src")};xigou.setSessionStorage("add_address",e,!0)})});var backpage,setbackpage=function(){backpage=xigou.getQueryString("selecturl")||xigou.getSessionStorage("select_address_backpage",!0),backpage&&$("a.back").attr("href",backpage)};