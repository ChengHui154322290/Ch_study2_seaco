function init(e,t){xigou.activeUser.allorders({requestBody:{token:xigou.getToken(),type:"3",curpage:e},callback:function(o,i){if(i==xigou.dictionary.success)if(null==o)$.tips({content:xigou.dictionary.chineseTips.server.value_is_null,stayTime:2e3,type:"warn"});else switch(o.code){case"0":setHtml(o,e),o.data.curpage>=o.data.totalpagecount&&(t.lock(),$(".dropload-down").hide());break;case"-100":$.tips({content:o.msg||"用户失效，请重新登录。",stayTime:2e3,type:"warn"}),xigou.removelocalStorage("token"),window.location.href="logon.html";break;default:$.tips({content:o.msg||"获取待收货数据失败",stayTime:2e3,type:"warn"}),t.lock(),$(".dropload-down").hide()}else $.tips({content:"请求失败，详见"+o,stayTime:2e3,type:"warn"})}})}function formatDate(e){var t=new Date(e),o=t.getFullYear(),i=t.getMonth()+1,s=t.getDate(),r=t.getHours(),n=t.getMinutes(),a=t.getSeconds();return o+"-"+addtime(i)+"-"+addtime(s)+" "+addtime(r)+":"+addtime(n)+":"+addtime(a)}function addtime(e){return 10>e?"0"+e:e}function setHtml(e,t){$(".ui-refresh-down").remove();for(var o=(e.data.list,e.data.list),i=o.length,s=[],r=0;i>r;r++)if("8"!=o[r].ordertype){s.push('<div class="orders-item" ordercode="'+o[r].ordercode+'">'),s.push('	<div class="order_time_status">'+o[r].ordertime),s.push('		<span class="order_status">'+o[r].statusdesc+"</span></div>");for(var n=0;n<o[r].lines.length;n++){var a=o[r].lines[n];s.push('<div class="order_info" sku="'+a.sku+'" tid = '+a.tid+">"),s.push('	<div class="order_image">'),s.push('		<img src="'+a.imgurl+'">'),s.push("	</div>"),s.push('	<div class="oder_info2">'),s.push('		<div class="order_name_price">'),s.push('			<div class="order_price">¥'+a.price+"</div>"),s.push('			<div class="order_name">'+a.name+"</div>"),s.push("		</div>"),s.push('		<div class="order_size_count">'),s.push('			<div class="order_count">×'+a.count+"</div>"),a.specs.length>0&&s.push('			<div style="width: 185px;">'+a.specs+"</div>"),s.push("		</div>"),s.push("	</div>"),s.push("</div>")}s.push('	<div class="order_totle_count_price">'),s.push('		<span class="float_right ">共 '+o[r].linecount+' 件 实付：<span class="order_lineprice">¥'+o[r].orderprice+"</span></span>"),s.push("	</div>"),s.push('	<div class="order_btns">'),s.push('<a class="bottom_btn ship_btn_pay_look" ordercode="'+o[r].ordercode+'" id="ship_btn_pay_look">订单追踪</a> '),s.push('<a class="bottom_btn ship_btn_pay_sure" ordercode="'+o[r].ordercode+'" id="ship_btn_pay_sure">确认收货</a> '),s.push("	</div>"),s.push("</div>")}var d=!1;if(e.allpage>t&&(d=!0),1==t&&0==s.length){$("#return_list").empty();var c=[];c.push('<div class="order_empty">还木有订单哟~</div>'),$(".orders-ship").append(c.join(""))}else $(".orders-ship").append(s.join(""));setTimeout(function(){var e=xigou.getQueryString("st")||"0";window.scrollTo(0,parseInt(e))},100),$(".order_info").off(xigou.events.click),$(".order_info")[xigou.events.click](function(){var e=$(event.target).parents(".orders-item"),t=e.attr("ordercode");xigou.setSessionStorage("ordercode",t),xigou.setSessionStorage("orderdetails_backurl","orders.html"),window.location.href="orderdetails.html?ordercode="+t}),shipconfirmReceipt(),shippaylook()}function gotoOrderDetails(e,t){t=t||"",xigou.setSessionStorage("orderdetails_backurl","inbound.html?st="+$(window).scrollTop()),window.location.href="orderdetails.html?ordernum="+e}function receiving(e,t){xigou.confirm({text:"您是否确认收货?",callback:function(o){"ok"==o&&xigou.activeUser.confirmshipment({requestBody:{token:xigou.getToken(),ordernum:t},callback:function(t,o){if(o==xigou.dictionary.success)if(null==t)$.tips({content:xigou.dictionary.chineseTips.server.value_is_null,stayTime:2e3,type:"warn"});else switch(t.code){case"0":if(t.ordernum){var i=$(e).parent().parent().parent();i.hide(),i.parent().find(".ready_receiving").text("已完成").addClass("completed"),$.tips({content:t.msg||"确认收货成功",stayTime:2e3,type:"warn"})}else $.tips({content:t.msg||"确认收货失败",stayTime:2e3,type:"warn"});break;case"-100":$.tips({content:t.msg||"用户失效，请重新登录。",stayTime:2e3,type:"warn"}),xigou.removelocalStorage("token"),window.location.href="logon.html";break;default:$.tips({content:t.msg||"确认收货失败",stayTime:2e3,type:"warn"})}else $.tips({content:"请求失败，详见"+t,stayTime:2e3,type:"warn"})}})}})}function shipconfirmReceipt(){$(".ship_btn_pay_sure").off(xigou.events.click),$(".ship_btn_pay_sure")[xigou.events.click](function(){var e=xigou.getToken(),t=$(this).attr("ordercode"),o={token:e,ordercode:t};xigou.activeUser.confirmshipment({requestBody:o,callback:function(e,t){t==xigou.dictionary.success&&(0==e.code?($.tips({content:e.msg||"已确认收货",stayTime:2e3,type:"warn"}),$(this).innerHTML="已收货",window.location.href="orders.html?defaule=2"):$.tips({content:e.msg||"确认订单失败",stayTime:2e3,type:"warn"}))}})})}function shippaylook(){$(".ship_btn_pay_look").off(xigou.events.click),$(".ship_btn_pay_look")[xigou.events.click](function(){var e=$(this).attr("ordercode");xigou.setSessionStorage("logisticordercode",e),window.location.href="ordertracking.html?ordercode="+e})}$(function(){var e=1;xigou.getLoginUserInfo({callback:function(t,o){o==xigou.dictionary.success?$(".orders-ship").dropload({scrollArea:window,loadDownFn:function(t){init(e,t),t.resetload(),1==e&&$(".dropload-refresh").hide(),e++}}):window.location.href="index.html"}})});