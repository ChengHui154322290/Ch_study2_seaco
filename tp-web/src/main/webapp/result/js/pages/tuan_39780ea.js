function InitPage(){var i=document.referrer;if(i){var t=i.split("from").length,e=i.split("isappinstalled").length;t>1||e>1?$(".goBack").attr("href","index.html"):i.split("login.html").length>1?$(".goBack").attr("href","index.html"):$(".goBack").attr("href","javascript:history.go(-1);")}else $(".goBack").attr("href","index.html");var n={gbid:gbid,gid:gid,token:xigou.getToken()};xigou.groupbuy.detail({requestBody:n,callback:function(i,t){if(t==xigou.dictionary.success)if(0==i.code)InitStatus(i.data),InitProductInfo(i.data.product),InitTunInfo(i.data),InitWeiXinShare();else if("-100"==i.code){xigou.setSessionStorage("loginjump_url",window.location.href),window.location.href="logon.html"}else $.tips({content:i.msg||"获取数据失败,请检测网络连接!",stayTime:2e3,type:"warn"});else $.tips(i?{content:i.msg||"获取数据失败,请检测网络连接!",stayTime:2e3,type:"warn"}:{content:"获取数据失败,请检测网络连接!",stayTime:2e3,type:"warn"})}}),window.onbeforeunload=function(){_flag&&(clearInterval(_flag),_flag="")}}function InitProductInfo(i){var t=[];t.push('<div class="ui-slider">'),t.push('<ul class="ui-slider-content">');for(var e=0;e<i.imglist.length;e++)t.push("<li>"),t.push('<a href="javascript:void(0)">'),t.push('	<img src="'+i.imglist[e]+'"/>'),t.push("	</a>"),t.push("</li>");i.imglist&&i.imglist.length>0&&(imgUrl=i.imglist[0]),t.push("</ul>"),t.push('<a href="itemdetail.html" class="more_details"></a>'),t.push("</div>"),$("#slider").empty().html(t.join(""));var n=(new fz.Scroll(".ui-slider",{role:"slider",indicator:!0,autoplay:!0,interval:3e3}),i.price.split(".")[0]||"00"),a=i.price.split(".")[1]||"00";$(".YUAN").text(n),$(".JIAO").text(a),i.oldprice&&$(".old_price").text("¥"+i.oldprice),i.salescountdesc&&$(".div_coun").text(i.salescountdesc),i.name&&$(".div_title").text(i.name),i.feature&&$(".div_desc").text(i.feature),$("#contry-img").attr("src",i.countryimg),i.channel&&($(".warehouse")[0].innerHTML=i.channel),i.countryname&&($(".country-name")[0].innerHTML=i.countryname),xigou.setLocalStorage("itemdetail",i.detail),$(".detail-content").html(i.detail)}function InitTunInfo(i){i.fa||(i.fa=0);var t=parseInt(100*i.fa/i.pa);t+="%",$(".div_progress div").css({width:t}),$(".div_tuan_count").text(i.fa+"/"+i.pa),$(".my-tuan").unbind(xigou.events.click),$(".my-tuan")[xigou.events.click](function(){gid&&xigou.setSessionStorage("tuan_gid",gid),window.location.href="mytuan.html"})}function InitStatus(i){return gbid=i.gbid,gid=i.gid,"1"==i.gstatus?(_flag&&(clearInterval(_flag),_flag=""),Initlsecond(i.lsecond)):($(".title_desc").empty(),$(".title_desc").text("活动商品")),"2"==i.gtype?($("#mulite_tun").hide(),$("#new_tun").show(),$(".tun_introduce")[xigou.events.click](function(){window.location.href="newtuanrule.html"})):$(".tun_introduce")[xigou.events.click](function(){window.location.href="multituanrule.html"}),"5"==i.tstatus?($(".div_join").hide(),$(".div_start").hide(),void $(".div_disable").show().text("活动已结束")):"2"==i.product.status?($(".div_join").hide(),$(".div_start").hide(),void $(".div_disable").show().text("已抢光")):"3"==i.product.status?($(".div_join").hide(),$(".div_start").hide(),void $(".div_disable").show().text("已下架")):(i.gid?("1"==i.gstatus?"1"==i.jstatus?join():"2"==i.jstatus?$(".div_join").text("已参团").addClass("disable"):"3"==i.jstatus?$(".div_join").text("限新人").addClass("disable"):"4"==i.jstatus&&$(".div_join").text("不可参团").addClass("disable"):"2"==i.gstatus?"1"==i.pstatus?($(".div_join").text("立即支付"),payNow(i.product)):"2"==i.pstatus?$(".div_join").text("已支付").addClass("disable"):"3"==i.pstatus?$(".div_join").text("已超时").addClass("disable"):"4"==i.pstatus?$(".div_join").text("该团已满").addClass("disable"):"5"==i.pstatus&&$(".div_join").text("达到限购").addClass("disable"):"3"==i.gstatus&&$(".div_join").text("开团失败").addClass("disable"),$(".div_join").show()):i.gid||$(".div_join").hide(),void("2"==i.lstatus?$(".div_join").hasClass("disable")?$(".div_start").hide():$(".div_start").addClass("disable"):launch()))}function Initlsecond(i){var t=parseInt(i),e=FormatTime(t--);$(".div_ltime").empty(),$(".div_ltime").append(e),_flag&&(clearInterval(_flag),_flag=""),_flag=setInterval(function(){var i=FormatTime(t--);$(".div_ltime").empty(),$(".div_ltime").append(i),0>=t&&location.reload()},1e3)}function FormatTime(i){var t=0,e=0,n=0,a=parseInt(i);a>60&&(n=parseInt(a/60),s=parseInt(a%60),n>60&&(e=parseInt(parseInt(a/60)/60),n=parseInt(parseInt(a/60)%60),e>24&&(t=parseInt(parseInt(parseInt(a/60)/60)/24),e=parseInt(parseInt(parseInt(a/60)/60)%24)))),s=pad(s,2),n=pad(n,2),e=pad(e,2),t=pad(t,2);var o=" ";return o+="<span>"+t+"</span>天",o+="<span>"+e+"</span>时",o+="<span>"+n+"</span>分",o+="<span>"+s+"</span>秒"}function pad(i,t){for(var e=i.toString().length;t>e;)i="0"+i,e++;return i}function launch(){var i=$(".div_start");i.unbind(xigou.events.click),i[xigou.events.click](function(){var i={gbid:gbid,token:xigou.getToken()};xigou.groupbuy.launch({requestBody:i,callback:function(i,t){if(t==xigou.dictionary.success)if(0==i.code){var e="tuan.html?gbid="+i.data.gbid;i.data.gid&&(e+="&gid="+i.data.gid),window.location.href=e}else $.tips({content:i.msg||"发起团购失败,请检测网络连接!",stayTime:2e3,type:"warn"});else $.tips(i?{content:i.msg||"发起团购失败,请检测网络连接!",stayTime:2e3,type:"warn"}:{content:"发起团购失败,请检测网络连接!",stayTime:2e3,type:"warn"})}})})}function payNow(i){var t=$(".div_join");t.unbind(xigou.events.click),t[xigou.events.click](function(){if(!$(this).hasClass("disable")){xigou.removeClearingData();var t=(xigou.getLocalStorage("address",!0)||xigou.defaultAddress,{token:xigou.getLocalStorage("token"),tid:i.tid,sku:i.sku,count:1,gid:gid});xigou.setSessionStorage("buy_now_details_url",window.location.href),xigou.activeProduct.buynow({requestBody:t,callback:function(i,t){if(t==xigou.dictionary.success){var e=i||null;if(null==e||0==e.length)return!1;0==e.code?(xigou.setSessionStorage("buy_now_uuid",e.data.uuid),xigou.setSessionStorage("gid",gid),window.location.href="settle.html?gid="+gid):$.tips({content:e.msg||"立即购买操作失败",stayTime:2e3,type:"info"})}else $.tips({content:"请求失败，详见"+i,stayTime:2e3,type:"info"})}})}})}function join(){var i=$(".div_join");i.unbind(xigou.events.click),i[xigou.events.click](function(){if(!$(this).hasClass("disable")){var i={gbid:gbid,gid:gid,token:xigou.getToken()};xigou.groupbuy.join({requestBody:i,callback:function(i,t){t==xigou.dictionary.success?0==i.code?(InitStatus(i.data),InitProductInfo(i.data.product),InitTunInfo(i.data),$.tips({content:"参团成功!",stayTime:2e3,type:"warn"})):$.tips({content:i.msg||"参团失败,请检测网络连接!",stayTime:2e3,type:"warn"}):$.tips(i?{content:i.msg||"参团失败,请检测网络连接!",stayTime:2e3,type:"warn"}:{content:"参团失败,请检测网络连接!",stayTime:2e3,type:"warn"})}})}})}function InitWeiXinShare(){if(isWeiXin()){var i=[],t=xigou.getQueryString("gbid"),e=xigou.getQueryString("gid"),n=location.href.split("?")[0],a=[];t&&a.push("gbid="+t),e&&a.push("gid="+e),a.length>0&&(n+="?",n+=a.join("&"));var o=n.replace(/&+/g,"%26");i.push("url="+o),xigou.activeUser.config({p:i.join("&"),callback:function(i,t){if(t==xigou.dictionary.success&&i&&0==i.code){var e=i.data;wx.config({appId:e.appid,timestamp:e.timestamp,nonceStr:e.nonceStr,signature:e.signature,jsApiList:["checkJsApi","onMenuShareTimeline","onMenuShareAppMessage","onMenuShareQQ","onMenuShareWeibo","onMenuShareQZone","scanQRCode"]})}}})}}var gbid=xigou.getQueryString("gbid"),gid=xigou.getQueryString("gid")||xigou.getSessionStorage("tuan_gid"),_flag=null,imgUrl="";$(function(){var i=xigou.getQueryString("from"),t=xigou.getQueryString("isappinstalled");if(i||t){var e="tuan.html?gbid="+gbid;return gid&&(e+="&gid="+gid),void(window.location.href=e)}xigou.getLoginUserInfo({callback:function(i,t){if(t!=xigou.dictionary.success){xigou.setSessionStorage("loginjump_url",window.location.href),window.location.href="logon.html"}else InitPage()}}),showItemDetail()}),wx.ready(function(){$(".goShare").show(),$(".goShare")[xigou.events.click](function(){$(".share_friends").show()}),$(".share_friends")[xigou.events.click](function(){$(".share_friends").hide()});var i="帮我一起抢！"+$(".YUAN")[0].innerText+"."+$(".JIAO")[0].innerText+"元的"+$(".div_title")[0].innerText,t="小西超级福利团，你从未见过的任性价，邀请好友一起狂欢！"+$(".div_desc")[0].innerText;wx.onMenuShareAppMessage({title:i,desc:t,link:location.href.split("?")[0]+"?gbid="+gbid+"&gid="+gid,imgUrl:imgUrl,trigger:function(){},success:function(){},cancel:function(){},fail:function(){}}),wx.onMenuShareTimeline({title:i,link:location.href.split("?")[0]+"?gbid="+gbid+"&gid="+gid,imgUrl:imgUrl,trigger:function(){},success:function(){},cancel:function(){},fail:function(){}}),wx.onMenuShareQQ({title:i,desc:t,link:location.href.split("?")[0]+"?gbid="+gbid+"&gid="+gid,imgUrl:imgUrl,trigger:function(){},complete:function(){},success:function(){},cancel:function(){},fail:function(){}}),wx.onMenuShareWeibo({title:i,desc:t,link:location.href.split("?")[0]+"?gbid="+gbid+"&gid="+gid,imgUrl:imgUrl,trigger:function(){},complete:function(){},success:function(){},cancel:function(){},fail:function(){}}),wx.onMenuShareQZone({title:i,desc:t,link:location.href.split("?")[0]+"?gbid="+gbid+"&gid="+gid,imgUrl:imgUrl,trigger:function(){},complete:function(){},success:function(){},cancel:function(){},fail:function(){}})}),wx.error(function(){}),$(window).scroll(function(){var i=document.documentElement.scrollTop||document.body.scrollTop;i>=100?($(".div_show_detail"),$(".detail-content").show(),$(".div_show_detail").hasClass("up")?$(this).removeClass("up").addClass("down"):$(this).removeClass("down").addClass("up")):$(".detail-content").hide(),i>=222?$(".div_show_detail").removeClass("up").addClass("down"):$(".div_show_detail").addClass("up").removeClass("down")});