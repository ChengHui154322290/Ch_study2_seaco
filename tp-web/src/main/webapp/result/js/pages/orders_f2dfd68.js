function allorders(e,o){if("Y"==orders_max)return o.disable("down",!1),$(".ui-refresh-down>span:first-child").removeClass(),!1;if("Y"!=orders_max){var r={token:xigou.getToken(),type:"1",curpage:e};xigou.activeUser.allorders({requestBody:r,callback:function(r,t){if(t==xigou.dictionary.success){var a=r||null;if(null==a||0==a.length)return!1;var s=a.code;0==s?(createList(a,e),r.data.curpage>=r.data.totalpagecount&&(o.lock(),$(".dropload-down").hide())):(o.lock(),$(".dropload-down").hide())}}})}}function ordersconfirmReceipt(){$(".orders_btn_pay_sure").off(xigou.events.click),$(".orders_btn_pay_sure")[xigou.events.click](function(){var e=xigou.getToken(),o=$(this).attr("ordercode"),r={token:e,ordercode:o};xigou.activeUser.confirmshipment({requestBody:r,callback:function(e,o){o==xigou.dictionary.success&&(0==e.code?($.tips({content:e.msg||"已确认收货",stayTime:2e3,type:"warn"}),$(this).innerHTML="已收货"):$.tips({content:e.msg||"确认订单失败",stayTime:2e3,type:"warn"}))}})})}function ordersdel(){$(".orders_btn_del").off(xigou.events.click),$(".orders_btn_del")[xigou.events.click](function(){var e=$(this).attr("ordercode");setTimeout(function(){var o=$.dialog({title:"",content:"是否删除订单？",button:["否","是"]});o.on("dialog:action",function(o){if(1==o.index){var r=xigou.getToken(),t={token:r,ordercode:e,type:"2"};xigou.activeUser.deleteorder({requestBody:t,callback:function(e,o){if(o==xigou.dictionary.success)if(0==e.code){$.tips({content:e.msg||"已删除订单",stayTime:2e3,type:"warn"});var r="orders.html",t=xigou.getQueryString("defaule");t&&(r+="?defaule="+t),window.location.href=r}else $.tips({content:e.msg||"删除订单失败",stayTime:2e3,type:"warn"})}})}})},50)})}function orderscancel(){$(".orders_btn_pay_cancal").off(xigou.events.click),$(".orders_btn_pay_cancal")[xigou.events.click](function(e){e.stopPropagation();var o=$(this).attr("ordercode"),r=this;setTimeout(function(){var e=$.dialog({title:"",content:"是否取消订单？",button:["否","是"]});e.on("dialog:action",function(e){if(1==e.index){var t=xigou.getToken(),a={token:t,ordercode:o,type:"1"};xigou.activeUser.deleteorder({requestBody:a,callback:function(e,o){if(o==xigou.dictionary.success)if(0==e.code){$.tips({content:e.msg||"已取消订单",stayTime:2e3,type:"warn"}),$(r).first().unbind("ontouchend"in document?"tap":"click");var t="orders.html",a=xigou.getQueryString("defaule");a&&(t+="?defaule="+a),window.location.href=t}else $.tips({content:e.msg||"取消订单失败",stayTime:2e3,type:"warn"})}})}})},250)})}function createList(e,o){for(var r=e,t=r.data.list.length,a=(r.allpage,r.count,r.data.list),s=[],i=0;t>i;i++){s.push('<div class="orders-item" ordercode="'+a[i].ordercode+'">'),s.push('	<div class="order_time_status">'+a[i].ordertime),a[i].statusdesc||(a[i].statusdesc=" "),s.push('		<span class="order_status">'+a[i].statusdesc+"</span></div>");for(var d=0;d<a[i].lines.length;d++){var n=a[i].lines[d];s.push('<div class="order_info" sku="'+n.sku+'" tid = '+n.tid+">"),s.push('	<div class="order_image">'),s.push('		<img src="'+n.imgurl+'">'),s.push("	</div>"),s.push('	<div class="oder_info2">'),s.push('		<div class="order_name_price">'),s.push('			<div class="order_price">¥'+n.price+"</div>"),s.push('			<div class="order_name">'+n.name+"</div>"),s.push("		</div>"),s.push('		<div class="order_size_count">'),s.push('			<div class="order_count">×'+n.count+"</div>"),n.specs.length>0&&s.push('			<div style="width: 185px;">'+n.specs+"</div>"),s.push("		</div>"),s.push("	</div>"),s.push("</div>")}switch(s.push('	<div class="order_totle_count_price">'),s.push('		<span class="float_right ">共 '+a[i].linecount+' 件 实付：<span class="order_lineprice">¥'+a[i].orderprice+"</span></span>"),s.push("	</div>"),s.push('	<div class="order_btns">'),a[i].status){case"0":s.push('<a class="bottom_btn orders_btn_del" ordercode="'+a[i].ordercode+'" payway="'+n.payway+'">删除订单</a> ');break;case"2":s.push('<a class="bottom_btn orders_btn_pay" ordercode="'+a[i].ordercode+'">立即支付</a> '),s.push('<a class="bottom_btn orders_btn_pay_cancal" ordercode="'+a[i].ordercode+'">取消订单</a>');break;case"4":a[i].iscancancel&&1==a[i].iscancancel&&s.push('<a class="bottom_btn orders_btn_pay_cancal" ordercode="'+a[i].ordercode+'">取消订单</a>');break;case"5":8!=a[i].ordertype?(s.push('<a class="bottom_btn orders_btn_pay_look" ordercode="'+a[i].ordercode+'">订单追踪</a> '),s.push('<a class="bottom_btn orders_btn_pay_sure" ordercode="'+a[i].ordercode+'">确认收货</a> ')):s.push('<a class="bottom_btn orders_btn_pay_immediatelyuse" ordercode="'+a[i].ordercode+'">立即使用</a>');break;case"6":8!=a[i].ordertype?(s.push('<a class="bottom_btn orders_btn_del" ordercode="'+a[i].ordercode+'" payway="'+n.payway+'">删除订单</a> '),s.push('<a class="bottom_btn orders_btn_pay_look" ordercode="'+a[i].ordercode+'">订单追踪</a> ')):s.push('<a class="bottom_btn orders_btn_del" ordercode="'+a[i].ordercode+'" payway="'+n.payway+'">删除订单</a> ')}s.push("	</div>"),s.push("</div>")}if((""==e.data.pagesize||0==e.data.pagesize||"0"==e.data.pagesize||e.data.curpage==e.data.totalcount)&&(orders_max="Y"),1==o&&0==s.length){$("#return_list").empty();var c=[];c.push('<div class="order_empty">还木有订单哟~</div>'),$(".orders-list").append(c.join(""))}else $(".orders-list").append(s.join(""));$(".order_info").off(xigou.events.click),$(".order_info")[xigou.events.click](function(){var e=$(event.target).parents(".orders-item"),o=e.attr("ordercode");xigou.setSessionStorage("ordercode",o),xigou.setSessionStorage("orderdetails_backurl","orders.html"),window.location.href="orderdetails.html?ordercode="+o}),orderscancel(a),ordersdel(),ordersconfirmReceipt(),ordersgotoPay(),orderpaylook(),orderImmediatelyuse()}function ordersgotoPay(){$(".orders_btn_pay").off(xigou.events.click),$(".orders_btn_pay")[xigou.events.click](function(){var e=xigou.getToken(),o=$(this).attr("ordercode"),r=$(this).attr("payid"),t=$(this).attr("payway"),a=xigou.getLocalStorage("openid"),t="weixin";isWeiXin()||(t="mergeAlipay");var s="";isWeiXin()&&(s=xigou.getQueryString("pay_openid"),""==s||null==s?(s=xigou.getLocalStorage("pay_openid"),(""==s||null==s)&&(callURL=getXgOpenIdUrl+"&redictBackUrl="+encodeURIComponent(location.href),window.location.href=callURL)):xigou.setLocalStorage("pay_openid",s),a=s);var i={token:e,ordercode:o,payid:r,payway:t,openid:a};xigou.activeHtClearing.payNow({requestBody:i,callback:function(e,a){if(a==xigou.dictionary.success)if(null==e)$.tips({content:xigou.dictionary.chineseTips.server.value_is_null,stayTime:2e3,type:"warn"});else switch(e.code){case"0":if(isWeiXin())onBridgeReady(e.data,r,o);else{var s=$("#submit_pay"),i=xigou.getPaymentForm({el:s,datas:e.data,payway:t});i&&s.submit()}break;case"-1003":window.location.href="payresult.html?pid="+r+"&ordercode="+o;break;default:$.tips({content:e.msg||"支付提交失败",stayTime:2e3,type:"warn"})}else $.tips({content:"请求失败，详见"+e,stayTime:2e3,type:"warn"})}})})}function setdefaulesel(e){order_tab._autoplay(1,e)}function orderpaylook(){$(".orders_btn_pay_look").off(xigou.events.click),$(".orders_btn_pay_look")[xigou.events.click](function(){var e=$(this).attr("ordercode");xigou.setSessionStorage("logisticordercode",e),window.location.href="ordertracking.html?ordercode="+e})}function orderImmediatelyuse(){$(".orders_btn_pay_immediatelyuse").off(xigou.events.click),$(".orders_btn_pay_immediatelyuse")[xigou.events.click](function(){var e=$(event.target).parents(".orders-item"),o=e.attr("ordercode");xigou.setSessionStorage("ordercode",o),xigou.setSessionStorage("orderdetails_backurl","orders.html"),window.location.href="orderdetails.html?ordercode="+o})}$(function(){isWeiXin()&&($("header").hide(),$(".top_nav_list").css({top:"0"}),$(".ui-tab").css({"margin-top":"36px"}),$("title").html("我的订单"));var e=1;xigou.getLoginUserInfo({callback:function(o,r){if(r==xigou.dictionary.success){$(".orders-list").dropload({scrollArea:window,loadDownFn:function(o){allorders(e,o),o.resetload(),1==e&&$(".dropload-refresh").hide(),e++}});var t=xigou.getQueryString("defaule");t&&setdefaulesel(t)}else window.location.href="index.html"}})});var orders_max="N";