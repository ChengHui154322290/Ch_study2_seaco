function getorderdata(){var e=new Object;return e.orderprice=price,e.ordercode=ordercode,e.payid=payid,e}function setHtml(e){for(var a=[],i=0;i<e.length;i++){var t=e[i],r=!0;if((0==parseFloat(t.orderprice)||"0.0"==t.orderprice.toString())&&(r=!1),a.push('<ul class="ui-list ui-list-text ui-border-tb item">'),a.push("<li>"),a.push('<h4 class="ordernum" name="'+t.ordercode+'">订单编号：</h4>'),a.push('<div class="ui-list-text">'+t.ordercode+"</div>"),a.push("</li>"),a.push("<li>"),a.push('<h4 class="list_next">应付金额：</h4>'),a.push('<div class="price'+i+'" data="'+t.orderprice+'">¥'+t.orderprice+"</div>"),a.push("</li>"),r){a.push('<li class="">'),a.push('<h4 class="select_pay" id="'+t.payid+'">支付方式：</h4>');var s,o;isWeiXin()?(TmpPayWayId=0,s="weixin",o="微信支付"):(TmpPayWayId=1,s="alipayDirect",o="支付宝支付"),a.push('<div class="ui-list-text">'+o+"</div>"),a.push("</li>"),a.push('<div class="btn"><a href="javascript:void(0);" class="go_payment" name="'+i+'" data="'+s+'">立即支付</a></div></ul>')}else a.push('<div class="ui-border-t btn haspay">已付款</div></ul>');a.push('<input type="hidden" name="payid'+i+'" value="'+t.payid+'" />')}$(".success-block").after(a.join(""))}function gotoPay(e){var a=$(e.target).attr("name"),i=$('input[name="payid'+a+'"]').val(),t=$(e.target).attr("data"),r=($(".price"+a).attr("data"),$(".item").eq(a).find(".ordernum").attr("name")),s=xigou.getSessionStorage("openid"),o={token:token,ordercode:r,payid:i,payway:t,openid:s,channelcode:channelCode};xigou.activeHtClearing.payNow({requestBody:o,callback:function(e,a){if(a==xigou.dictionary.success)if(null==e)$.tips({content:xigou.dictionary.chineseTips.server.value_is_null,stayTime:2e3,type:"warn"});else switch(e.code){case"0":if(isWeiXin())onUnionBridgeReady(e.data,i,r,channelCode,tarhost,backurl);else if(e.data.actionurl){var t=$("#submit_pay"),s=xigou.getPaymentForm({el:t,datas:e.data,payway:TmpPayWayId});s&&t.submit()}break;case"-1003":window.location.href="payresult.html?pid="+i+"&ordercode="+r;break;default:$.tips({content:e.msg||"支付提交失败",stayTime:2e3,type:"warn"})}else $.tips({content:"请求失败，详见"+e,stayTime:2e3,type:"warn"})}})}function gotoPay(){var e=xigou.getSessionStorage("openid"),a={token:token,ordercode:ordercode,payid:payid,payway:"weixin",openid:e,channelcode:channelCode};xigou.activeHtClearing.payNow({requestBody:a,callback:function(e,a){if(a==xigou.dictionary.success)if(null==e)$.tips({content:xigou.dictionary.chineseTips.server.value_is_null,stayTime:2e3,type:"warn"});else switch(e.code){case"0":if(isWeiXin())onUnionBridgeReady(e.data,payid,ordercode,channelCode,tarhost,backurl);else if(e.data.actionurl){var i=$("#submit_pay"),t=xigou.getPaymentForm({el:i,datas:e.data,payway:TmpPayWayId});t&&i.submit()}break;case"-1003":window.location.href="payresult.html?pid="+payid+"&ordercode="+ordercode;break;default:$.tips({content:e.msg||"支付提交失败",stayTime:2e3,type:"warn"})}else $.tips({content:"请求失败，详见"+e,stayTime:2e3,type:"warn"})}})}function InitPage(){var e=getorderdata();if(e){$(".ordercount").html("1");var a=[],i=!0;if((0==parseFloat(e.price)||"0.0"==e.price.toString())&&(i=!1),a.push('<ul class="ui-list ui-list-text ui-border-tb item">'),a.push("<li>"),a.push('<h4 class="ordernum" name="'+e.ordercode+'">订单编号：</h4>'),a.push('<div class="ui-list-text">'+e.ordercode+"</div>"),a.push("</li>"),a.push("<li>"),a.push('<h4 class="list_next">应付金额：</h4>'),a.push('<div class="price" data="'+e.price+'">¥'+e.price+"</div>"),a.push("</li>"),i){a.push('<li class="">'),a.push('<h4 class="select_pay" id="'+e.payid+'">支付方式：</h4>');var t,r;isWeiXin()?(TmpPayWayId=0,t="weixin",r="微信支付"):(TmpPayWayId=1,t="mergeAlipay",r="支付宝支付"),a.push('<div class="ui-list-text">'+r+"</div>"),a.push("</li>"),a.push('<div class="btn"><a href="javascript:void(0);" class="go_payment" data="'+t+'">立即支付</a></div></ul>')}else a.push('<div class="ui-border-t btn haspay">已付款</div></ul>');return a.push('<input type="hidden" value="'+e.payid+'" />'),$(".success-block").after(a.join("")),void gotopaymerge(e)}$.tips({content:"您还没有提交订单，请先回到购物车页面提交订单",stayTime:2e3,type:"warn"})}function gotopaymerge(e){$(".go_payment")[xigou.events.click](function(){var a=$("#submit_pay"),i=xigou.getPaymentForm({el:a,datas:e,payway:"mergeAlipay"});i&&a.submit()})}var UserToken=xigou.getToken(),param=xigou.getQueryString("param"),arr=param.split(","),payid=arr[0],ordercode=arr[1],price=arr[2],token=arr[3],channelCode=arr[4],tarhost=decodeURIComponent(arr[5]),backurl=arr[6],TmpPayWayId=0;$(function(){if(isWeiXin()){var e=xigou.getSessionStorage("openid");null!=e&&e||(xigou.getwxOpenidUnion(1),e=xigou.getQueryString("openid"),xigou.setSessionStorage("openid",e)),$("header").hide(),$("title").html("支付中心")}isWeiXin()?(getOrderlist(),$(".go_payment")[xigou.events.click](function(e){gotoPay(e)}),$(".go_payment").click()):InitPage(),tarhost&&($(".goBack").attr("href",tarhost+"orders.html"),$(".goIndex").attr("href",tarhost+"index.html")),void 0!=backurl&&null!=backurl&&$(".goBack").attr("href",backurl),gotoPay()});var getOrderlist=function(){var e=getorderdata();if(e){var a=1;$(".ordercount").html(a);var i=new Array;return i.push(e),void setHtml(i)}$.tips({content:"您还没有提交订单，请先回到购物车页面提交订单",stayTime:2e3,type:"warn"})};